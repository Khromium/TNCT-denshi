<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0104)https://xythos.tokyo-ct.ac.jp/web/j/usr/kosaka/for_students/H8/H8-MB-Pro/H8-MB-Pro2013fone_h8v2TNCT.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    

    
<title>H8 mother board programing</title>
    
<meta name="GENERATOR" content="MSHTML 8.00.6001.19046">
    
<meta content="text/css" http-equiv="Content-Style-Type">
  <style id="style-1-cropbar-clipper">/* Copyright 2014 Evernote Corporation. All rights reserved. */
.en-markup-crop-options {
    top: 18px !important;
    left: 50% !important;
    margin-left: -100px !important;
    width: 200px !important;
    border: 2px rgba(255,255,255,.38) solid !important;
    border-radius: 4px !important;
}

.en-markup-crop-options div div:first-of-type {
    margin-left: 0px !important;
}
</style></head>
  <body alink="#ff0000" bgcolor="#ffffff" link="#0000ff" text="#000000" vlink="#800080">
    
<p align="center"><font color="#000080" size="5"><strong>AKI-
          H８（HitachiH8/3048F-ONE）の使い方<br>
          マザーボードSWとLEDによるプログラミング</strong></font></p>
    
<p align="right">Copyright(C) 31Jan2015<br>
      Copyright(C) 15Dec2001</p>
    
<p align="right">coskx</p>
    
<p><strong><font color="#000080">１．　はじめに</font></strong></p>
    
<p><font color="#000080"><strong>１．１　この文書の構成<br>
        </strong></font>この文書はH8/3048F-ONEのCプログラムをコンパイルする方法，AKI-H8
      /3048foneにフラッシュメモリ書き込み（転送）する方法を修得した学習者が，AKI-H8/3048F-ONEのマザーボードを用いてLEDをつけたりスイッチを取り込んだりするプログラムを学習するための文書である。</p>
    
<p align="center">
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td><img src="./H8 mother board programing_files/TNCT_H83052.jpg"></td>
          </tr>
          <tr>
            <td>
              <p align="center">TNCTマザーボード上のH8/3048FONE</p>
            </td>
          </tr>
        </tbody>
      </table>
    </p>
    
<p align="center">テンプレートフォルダなどのダウンロード</p>
    
<p align="center">
      <table cellpadding="1" cellspacing="0" bgcolor="beige" border="3">
        <tbody>
          <tr>
            <td><font color="#0000ff" face="MS Sans Serif" size="4"><a href="https://xythos.tokyo-ct.ac.jp/web/j/usr/kosaka/for_students/H8_3048fone/samples2013.zip">DownLoad</a></font></td>
          </tr>
        </tbody>
      </table>
    </p>
    
<p><strong><font color="#000080">１．２&nbsp;AKI-H８（HitachiH8/3048F-ONE）<br>
        </font></strong>&nbsp;AKI-H8/3048F-ONE（図１）は日立製作所の製品であるマイクロコンピュータ
      H8製品群のH8/3048foneを用いて，秋月電子通商がCPUボード，マザーボードを製作販売している製品の商品名である。<br>
      マザーボードはTNCT特製基板である。<br>
      <br>
      マザーボード上には次の要素が搭載されている<br>
      （１）&nbsp;&nbsp; フラッシュメモリ(ROM)書き込み回路（CPUカードの裏側に隠れているので見えない）<br>
      （２）&nbsp;&nbsp; LCD<br>
      （３）&nbsp;&nbsp; 8ビットスイッチ<br>
      （４）&nbsp;&nbsp; プッシュスイッチ<br>
      （５）&nbsp;&nbsp; LED（発光ダイオード） </p>
    
<p>AKI-H8/3048foneでのプログラミングはパソコン上で次のように行なう。<br>
      （１）PC上でプログラムを作成する。<br>
      （２）PC上でコンパイルして，実行形式プログラムをH8マイコンに転送する。<br>
      （３）H8マイコンを起動する。<br>
      <br>
      もう少し丁寧に説明すると次のようになる。<br>
      （１）&nbsp;&nbsp; PC上でC言語またはアッセンブリ言語でプログラムを開発する<br>
      （２）&nbsp;&nbsp; PC上でコンパイル・リンクを行ない実行プログラムファイルを作る<br>
      （３）&nbsp;&nbsp; PC上でロードモジュールに変換する<br>
      （４）&nbsp;&nbsp; RS232C通信でロードモジュールをH８マイコンに転送（フラッシュメモリに書き込む）する。<br>
      （５）&nbsp;&nbsp; H８マイコン上でプログラムを実行する。</p>
    
<p align="center">
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td>
              <p><br>
                <img alt="H8-MB.JPG" src="./H8 mother board programing_files/TNCT_H83052_E.jpg"></p>
            </td>
          </tr>
          <tr>
            <td>
              <p align="center">図１　AKI-H8　TNCTマザーボード</p>
            </td>
          </tr>
        </tbody>
      </table>
    </p>
    
<p align="center">
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td>
              <p><img alt="H8-MB.JPG" src="./H8 mother board programing_files/TNCTboardMag.jpg"></p>
            </td>
          </tr>
          <tr>
            <td>
              <p align="center">図２　AKI-H8　TNCTマザーボード下部拡大<br>
LEDの実装は2個だけの場合もある<br>
</p>
            </td>
          </tr>
        </tbody>
      </table>
    </p>
    
<p><font color="#000080"><strong>２．PCとマイコンのシリアル通信とビット演算</strong></font></p>
    <font face="ＭＳ ゴシック">
      <p><font color="#000080"><strong>２．１　マイコンの足し算プログラム</strong></font></p>
    </font>
    
<p><font face="ＭＳ ゴシック">プログラム書き込み用通信回線（シリアル通信ケーブル）はそのままプログラム実行時にも使える。<br>
        <img alt="" src="./H8 mother board programing_files/teratarmicon.gif" height="69" width="263"><br>
        
マイコンにはPCのような大きなディスプレイがついていないため，表示出力は，通信を使ってPCにあるターミナルに対して行う。<br>
シリアル通信ユニットを使うと，マイコンが文字列を送信すると，PC側のターミナル上に表示され，PCのキーボードから与えた<br>
文字列がマイコンに送られる。ターミナルソフトとしてTeraTerm（テラターム）を使用する。<br>
        <font size="2">（テラタームでは，通信の設定は，Async, 8bit, NoParity, stop1
          ,38400baud, (Backspace:Ctrl+H, Space, Ctrl+H)で設定されている。）</font><br>
        <br>
        <br>
        <img alt="" src="./H8 mother board programing_files/terminal_tt.gif" height="156" width="348"></font></p>
    
<p><font face="ＭＳ ゴシック">テラタームを見ている限りは，PCのみで動作しているように感ずるが，実際の作業はマイコンが行っており，PCはデータの出入り口にすぎない。最初のプログラムは，2つの整数値を与えて，その和を計算させるものである。</font></p>
    
<p><font face="ＭＳ ゴシック">手順で気を付けるのは，コンパイル＋プログラム転送が終ってからテラタームを立ち上げ，マイコ
ンをRUNモードにして電源を入れることである。再び，プログラムを転送する際は，テラタームは通信しないようにしてからプログラムの転送を行
う。（テラタームを起動したままでは，新しいプログラムの書き込みができない）<br>
        どうして，排他的に作業をするかというと，通信線は1本しかなく，プログラム転送プログラムとテラタームが1本の通信線を奪い合うからである。</font></p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p>
        <table cellpadding="1" cellspacing="1" border="1">
          <tbody>
            <tr>
              <td>
                <p align="center"><font face="ＭＳ ゴシック">addition.c
                    加算プログラム</font></p>
              </td>
            </tr>
            <tr>
              <td>
                <p><font face="ＭＳ ゴシック">/**********************************************************<br>
                    SCI1へ出力，WINDOWSのHyperTerminalなどで受信できる。<br>
                    ただし，設定は<br>
                    38400baud, Async, 8bit , NoParity, stop1<br>
**********************************************************/<br>
                    #include &lt;3048fone.h&gt;<br>
                    #include "h8_3048fone.h"<br>
                    <br>
                    main()<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; int x,y,z;<br>
                    &nbsp;&nbsp;&nbsp; initSCI1();
                    /*シリアル通信ユニット　SCI-ch1の初期化(SCI1_printfを使うために必要)*/<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("Hello. How are
                    you?\n"); /*printfと同様*/<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("Let's make an
                    arithmetic addition\n");<br>
                    &nbsp;&nbsp;&nbsp; while (1) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    x=SCI1_getInt("the first&nbsp; number = ");<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    y=SCI1_getInt("the second number = ");<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; z=x+y;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("x=%d y=%d z=x+y=%d\n",x,y,z);<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</font></p>
              </td>
            </tr>
            <tr>
              <td><font face="ＭＳ ゴシック">実行結果（</font><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック">テラタームのターミナル画面</font>）</font></td>
            </tr>
            <tr>
              <td><font face="ＭＳ ゴシック">Hello. How are you?<br>
                  Let's make an arithmetic addition<br>
                  the first&nbsp; number = <b><font color="#3333ff">12</font></b><br>
                  the second number = <b><font color="#3333ff">56</font></b><br>
                  x=12 y=56 z=x+y=68<br>
                  the first&nbsp; number = <b><font color="#3333ff">100</font></b><br>
                  the second number = <b><font color="#3333ff">-50</font></b><br>
                  x=100 y=-50 z=x+y=50<br>
                  the first&nbsp; number =</font></td>
            </tr>
          </tbody>
        </table>
      </p>
      <p><font face="ＭＳ ゴシック">SCI通信の時PC側の「Enterキー」入力では，テンキー部ではなく，文字キーの右側にある大きなenter-keyを使うこと。<br>
テンキーのすべてが使えるわけではないことに注意。<br>
</font></p>
    </blockquote>
    
<p><font face="ＭＳ ゴシック">マイコンプログラムの説明</font></p>
    
<p><font face="ＭＳ ゴシック">・シリアル通信を行う際は，マイコンプログラムの先頭で，シリアル通信ユニットを初期化しな<br>
        　</font><font face="ＭＳ ゴシック">ければならない。<br>
        ・SCI1_printfはシリアル通信ユニットch1に対するprintfである。PCと通信ができるようになっていて，<br>
　PC上でターミナルソフトが動いていれば文字列がPCのターミナル上に表示される。<br>
        　通常のCプログラムで使うprintfと異なる仕様が2つある。<br>
        （１）浮動小数点数の表示はできない（ソフトの軽量化のため）<br>
        （２）２進法表示ができる（書式で，%dではなく%bにすると2進法表示になる。）<br>
        ・「while(1) {」というのは無限ループを表わす。<br>
        　while文やif文でかっこの中の条件を書くところに，数値がある場合<br>
        　0は偽，それ以外は真を表わす。よって，「while(2) {」でも「while(100) {」でも無限ルー<br>
        &nbsp;プになる。<br>
        ・SCI1_getIntはScanfをint型専用にしたもので，シリアル通信から数値を表わす文字列を受け取り，<br>
        　整数型変数に保存する。<br>
        　その際，引数として与えた文字列をターミナルに送信する。<br>
        ・詳細はh8_3048fone.hの最初の部分をエディタで開いて調べておくこと。<br>
        　また，この中にSCI1_printfの関数本体も入っているので，興味があったら見ておくこと。</font><font face="ＭＳ ゴシック"><br>
        ・#include+ファイル名というのは，#include文の位置に，ファイル名で指定されたファイルの<br>
        　中身が書いてあるものとしてコンパイルせよという意味である。</font></p>
    <font face="ＭＳ ゴシック">
      <p><font color="#000080"><strong>２．２　ビット演算</strong></font></p>
    </font>
    
<p>マイコン特有のビット演算に慣れておこう。後にビット入出力ではよく使うことになる。<br>
ビット演算は小坂の「Ｃプログラミング入門」の「Ｂ．演算子」の「Ｂ．２　Ｃ言語におけるビット演算子」に解説されている。<br>
　<a href="https://xythos.tokyo-ct.ac.jp/web/j/usr/kosaka/for_students/CIntro/operator.html">リンク</a><br>
SCI_printfは２進法で表示することができるので助かる。</p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p>
        <table cellpadding="1" cellspacing="1" border="1">
          <tbody>
            <tr>
              <td>
                <p align="center"><font face="ＭＳ ゴシック">bitoperation.c
                    bit演算プログラム</font></p>
              </td>
            </tr>
            <tr>
              <td>
                <p><font face="ＭＳ ゴシック">/**********************************************************<br>
                    ビット演算<br>
                    SCI1へ出力，WINDOWSのHyperTerminalなどで受信できる。<br>
                    ただし，設定は<br>
                    38400baud, Async, 8bit , NoParity, stop1<br>
**********************************************************/<br>
                    #include &lt;3048fone.h&gt;<br>
                    #include "h8_3048fone.h"</font></p>
                <p><font face="ＭＳ ゴシック">main()<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; short int x,y,z;<br>
                    &nbsp;&nbsp;&nbsp; initSCI1();
                    /*シリアル通信ユニット　SCI-ch1の初期化*/<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("Hello. How are
                    you?\n"); /*printfと同様*/<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("Let's make an bit
                    operation\n");<br>
                    &nbsp;&nbsp;&nbsp; while (1) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    x=SCI1_getInt("the first&nbsp; number = ");<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    y=SCI1_getInt("the second number = ");<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    z=x&amp;y;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("x=%b y=%b z=x&amp;y=%b\n",x,y,z);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; z=x|y;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("x=%b y=%b z=x|y=%b\n",x,y,z);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; z=x^y;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("x=%b y=%b z=x^y=%b\n",x,y,z);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    z=x&gt;&gt;3;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("x=%b z=x&gt;&gt;3=%b\n",x,z);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    z=y&lt;&lt;3;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("y=%b z=y&lt;&lt;3=%b\n",y,z);<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</font></p>
              </td>
            </tr>
            <tr>
              <td><font face="ＭＳ ゴシック">実行結果（テラタームのターミナル画面）</font></td>
            </tr>
            <tr>
              <td><font face="ＭＳ ゴシック">Hello. How are you?<br>
                  Let's make an bit operation<br>
                  the first&nbsp; number = <b><font color="#3333ff">12</font></b><br>
                  the second number = <b><font color="#3333ff">65</font></b><br>
                  x=1100 y=1000001 z=x&amp;y=0<br>
                  x=1100 y=1000001 z=x|y=1001101<br>
                  x=1100 y=1000001 z=x^y=1001101<br>
                  x=1100 z=x&gt;&gt;3=1<br>
                  y=1000001 z=y&lt;&lt;3=1000001000<br>
                  the first&nbsp; number = <b><font color="#3333ff">54</font></b><br>
                  the second number = <b><font color="#3333ff">29</font></b><br>
                  x=110110 y=11101 z=x&amp;y=10100<br>
                  x=110110 y=11101 z=x|y=111111<br>
                  x=110110 y=11101 z=x^y=101011<br>
                  x=110110 z=x&gt;&gt;3=110<br>
                  y=11101 z=y&lt;&lt;3=11101000<br>
                  the first&nbsp; number =</font></td>
            </tr>
          </tbody>
        </table>
      </p>
    </blockquote>
    
<p>次のプログラムは，与えられたshort int型の値を２進法表示した時に，有効な0の数を数える関数のテストである。<br>
      ただし，１６ビット変数の上位に埋められている0は数えない。</p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p>
        <table cellpadding="1" cellspacing="1" border="1">
          <tbody>
            <tr>
              <td>
                <p align="center"><font face="ＭＳ ゴシック">countzeros.c
                    bit演算プログラム例</font></p>
              </td>
            </tr>
            <tr>
              <td>
                <p><font face="ＭＳ ゴシック">/**********************************************************<br>
                    short int 型の変数を２進法表現で見たとき，有効桁数内にある0<br>
                    の個数を数える関数int countZeros(short int value)のテスト<br>
                    SCI1へ出力，WINDOWSのHyperTerminalなどで受信できる。<br>
                    ただし，設定は<br>
                    38400baud, Async, 8bit , NoParity, stop1<br>
**********************************************************/<br>
                    #include &lt;3048fone.h&gt;<br>
                    #include "h8_3048fone.h"</font></p>
                <p><font face="ＭＳ ゴシック">/* short int 型の変数を２進法表現で見たとき，/<br>
                    /&nbsp;
                    有効桁数内にある0の個数を数える関数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */<br>
                    int countZeros(short int value)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; int count=0;<br>
                    &nbsp;&nbsp;&nbsp; while (value!=0) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    count+=1-(value&amp;1);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    value=((unsigned short int)value)&gt;&gt;1;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    /*unsignedにみなさないと，valueが負の数のとき，<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    最上位ビットが保たれてしまい，ループから抜け出<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; せなくなる*/<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; return count;<br>
                    }</font></p>
                <p><font face="ＭＳ ゴシック">main()<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; short int x,y;<br>
                    &nbsp;&nbsp;&nbsp; initSCI1();
                    /*シリアル通信ユニット　SCI-ch1の初期化*/<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("Hello. How are
                    you?\n"); /*printfと同様*/<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("Let's count
                    zeros\n");<br>
                    &nbsp;&nbsp;&nbsp; while (1) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    x=SCI1_getInt("the number = ");<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    y=countZeros(x);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("x=%b y=%d\n",x,y);<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</font></p>
              </td>
            </tr>
            <tr>
              <td><font face="ＭＳ ゴシック">実行結果（テラタームのターミナル画面）</font></td>
            </tr>
            <tr>
              <td><font face="ＭＳ ゴシック">Hello. How are you?<br>
                  Let's count zeros<br>
                  the number = <b><font color="#3333ff">100</font></b><br>
                  x=1100100 y=4<br>
                  the number = <b><font color="#3333ff">1000</font></b><br>
                  x=1111101000 y=4<br>
                  the number = <b><font color="#3333ff">10000</font></b><br>
                  x=10011100010000 y=9<br>
                  the number = <b><font color="#3333ff">-10000</font></b><br>
                  x=1101100011110000 y=8<br>
                  the number =</font></td>
            </tr>
          </tbody>
        </table>
      </p>
    </blockquote>
    
<p dir="ltr">
      <table cellpadding="1" cellspacing="0" bgcolor="#ffff80" border="0">
        <tbody>
          <tr>
            <td>
              <p><font face="ＭＳ ゴシック">練習問題　次の作業を行ないなさい。<br>
                  （実行の様子を検察して，その結果，気付いた事を含め，別途指定された書式で括弧の中ファイル名で提出しなさい）<br>
                  <br>
                  （１）「bitoperation.c」で演算結果は２進法表現だけであるが，同じ変数について2進法表現と10進法表現が<br>
                  　　</font><font face="ＭＳ ゴシック">同時に見えるように改造しなさい。<br>
                  　　負の整数を右シフトした時（例えばxの値を-1024などにしてz=x&gt;&gt;3;），どうなるか試して考察しなさい。<br>
                  　　また，unsigned short int
                  u;を導入するように改造し，uに無理やり-1024などを代入してz=u&gt;&gt;3にした時，<br>
                  　　どうなるか試して考察しなさい。</font><font face="ＭＳ ゴシック"><br>
                  　　(mp1ex01.txt)<br>
                </font><font face="ＭＳ ゴシック"><br>
                  （２）short int 型の変数を２進法表現で見たとき，1の個数を数える関数int
                  countOnes(short int value)<br>
                  　　を作りなさい。<br>
　　例えばこの関数に10進法表現の10を与えると，2進法表現では1010なので，2を返す。<br>
　　例えばこの関数に10進法表現の13を与えると，2進法表現では1101なので，3を返す。<br>
　　テストするmainもつくり，十分にテストしてから提出しなさい。どのように考えて十分なテストだと<br>
                  　　考えたのか，考察に書きなさい。<br>
                  　　(mp1ex02.txt)</font><font face="ＭＳ ゴシック"><br>
                </font></p>
            </td>
          </tr>
        </tbody>
      </table>
    </p>
    
<p>&nbsp;</p>
    
<p><strong><font color="#000080">３．
          マイクロコンピュータのプログラムと，デジタルの0V，5Vの世界をつなぐ</font></strong></p>
    
<p><strong>マイクロコンピュータプログラムと入出力</strong></p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p>　<font face="ＭＳ ゴシック">PCでのCプログラムではメモリ上での操作が主であり，画面への表示やキーボードからの
入力においてはprintfやscanfなどの関数を呼び出して作業をしていた。原始的なマイクロコンピュータの実用プログラミングでは，関数を用いて
IOポート入出力を簡単に記述できるような環境を用いる。しかし原始的なマイクロコンピュータの最初のプログラムでは，LEDを点滅させたり，ON-
OFFスイッチの状態を取り込むのもすべて自分でbit操作プログラムを記述しなければならない。</font></p>
    </blockquote>
    
<p><strong><font face="ＭＳ ゴシック">マイクロコンピュータマザーボードのピン</font></strong></p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p><font face="ＭＳ ゴシック">　図２に示すようにマイクロコンピュータ（CPU）はLSIと呼ばれるディジタル回路の部品の１つである，１００本もの脚が付いており，それらの大部分はCPUカードからマザーボード上のピンに接続が伸びている。マザーボー
          ドとCPUカードをつないでいるのは，複数のコネクタであり，それぞれCN1，CN2，CN3のように名前が付いている。例えば図２ではCN3（コネクタ２）でピン番号が1から40まで付いている。 →</font><a href="https://xythos.tokyo-ct.ac.jp/web/j/usr/kosaka/for_students/H8/H8-MB-Pro/H8-MB-Pro2013fone_h8v2TNCT.html#ref_h8_pins"><font color="#0066cc" face="ＭＳ ゴシック">参考１(こ
            のページ下部)</font></a><br>
        <font face="ＭＳ ゴシック">　この表では，マザーボード上のCN3の31番ピンは，CPUの52番ピンに繋がっており，
その名前はP5-0であることを示している。P5-0というのはポート５の第0ビットという意味である。CPU内部から見るとポート５というのは８ビット
あり，P5-0,P5-1,P5-2,・・・,P5-7まである。<br>
（P5はちょっと特別でCPUの外には４ビットしか見えていないのでP5-0～P5-3ま
でしかこの表に出てこない）。またポートというのは出入り口のことである。</font></p>
    </blockquote>
    
<p><strong><font face="ＭＳ ゴシック">プログラムから見たポート操作</font></strong></p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p><font face="ＭＳ ゴシック">・ポートとは1バイトのメモリ<br>
          　ポートはプログラム側から見ると，１つのアドレスをもつ８ビットのように扱える。H8CPUのハードウェアマ
          ニュアルによれば，P5は「0xfffca番地に置かれた1バイト」として扱える。これまでのCプログラムでは，あるアドレスに直接値を書き込んだり，あるアドレスのデータを読み取ったりすることはなかったが，C言語にはそのような記述ができる。<br>
          <br>
          ・あるアドレス（1バイト）への読み書き<br>
          　例えば0xfffca番地に0x03を書き込むときには，「*(unsigned char
          
*)0xfffca=0x03;」のように書く。これはポインタ表記を用いた記述である。キャストで変数の型を一時的に変更する方法を知っているだろう。例え
ば，int型の変数xなどに対して(double)x,(double)100と記述すると，一時的にdouble型のxや100.0になる。だから，
(unsigned char *)0xfffcaは，unsigned char
          を指すポインタとしての0xfffcaを意味し，*(unsigned char
          
*)0xfffcaはそのポインタの指す値ということになるので，0xfffca番地に0x03を書き込むことになる。また例えば，0xfffca番地の値をunsigned char 型変数xxxに受け取るには，「xx=*(unsigned char
          *)0xfffca;」と書くことになる。</font></p>
      <p><font face="ＭＳ ゴシック">・ポートへの読み書き<br>
          　それでは，「*(unsigned char
          *)0xfffca=0x03;」が実行されるとどうなるかというと，0x03は2進法で表すと00000011であり第0ビット（一番右側のビット）は
          1，第1ビットも1，第2ビットは0，第3ビットも0なので，それらはP5の各ビットに対応するCN3のピンに出力される。この時0
          は0Vで，1は5Vで出力される。（P5-bit0:5V, P5-bit1:5V, P5-bit2:0V,
          P5-bit3:0V）プログラムの実行は一瞬で終わるが，これらの出力はそのまま出力され続け，別の値が出力されるまで変化しない。すなわちラッチ出力という
          ことになる。<br>
          　また，「xx=*(unsigned char
          *)0xfffca;」が実行されると，どうなるかというと，P5の各ビットに対応するCN3のピンへの入力状態が変数xxに取得される。0Vが与えられ
          たピンは内部では0に，5Vが与えられたピンは内部では1に変換される。例えば，P5-0:5V, P5-1:5V,
          P5-2:0V, P5-3:0Vが与えられればxxの下位4ビットは0011となる。</font></p>
      <p><font face="ＭＳ ゴシック">PC上のCプログラミングで，「printf("%02x\n", *(unsigned
          char
          *)12300);」のような記述は可能であり，コンパイルもできる。しかし，実行時にエラーを発生することがある。これはOSがメモリを管理しており，
          そのプログラムでアクセスできるメモリのアドレス範囲を制限しているからである。<br>
        </font></p>
    </blockquote>
    
<p><strong><font face="ＭＳ ゴシック">ポートの初期化</font></strong></p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      
<p><font face="ＭＳ ゴシック">・ポートは初期化設定しないと使えない<br>
　H8CPUでは各ポートを初期化することで入力にも出力にも使えるようになっている。<br>
しかし，実際のプログラムでは，P5を入力に使ったり，出力に使ったりというようにはできない。<br>
マザーボー
          ドを作った段階でP5を入力に使うか出力に使うか決まっている。例えばLEDを接続するように設計すれば出力として使うことになるし，スイッチを繋げば入力として使うことになる。<br>
<br>
プログラム起動時に，P5をどちらで使うかをソフトウェア上で設定しなければならない。<br>
その設定はハードウェアマニュアルによれば，アドレス0xfffc8の1バイトを使う。0xfffc8の各ビットごとに0,1を設定
          するが，0を設定すると，対応する0xfffcaのビットは入力になり，1を設定すると，対応する0xfffcaのビットは出力とし
          て使得ることになる。例えば，0xfffc8に0x0a(二進表記で00001010)を書き込むと，0xfffcaの第1，第3
          ビットが出力で，残りは入力として使うように設定したことになる。<br>
          （なぜ初期化しないと使えないような設計になっているんだろう。CPUは製造段階ではポートを入出力どちらかに決めておかない方が汎用性が高くなる。同じCPUでは多くのニーズに合わせることができるため，このような設計になっている）</font></p>

      <p><font face="ＭＳ ゴシック">H8/3048foneハードウェアマニュアルの「９．６ ポート5，モード7」参照<br>
          　　</font><a href="http://tnct20/~kosaka/for_students/H8/j602093_h83048.pdf"><font color="#0066cc" face="ＭＳ ゴシック">http://tnct20.tokyo-ct.ac.jp/~kosaka/for_students/H8/j602093_h83048.pdf</font></a><br>
        <font face="ＭＳ ゴシック">　　</font></p>
      <p><font face="ＭＳ ゴシック">図３のマザーボードではP5の第0ビットと第１ビット（下位２ビットとも言う）にLEDが接続されている。<br>
          そうすると次のようなプログラムで，LEDの点滅ができることになる。</font></p>
      <p>
        <table cellpadding="1" cellspacing="1" border="1">
          <tbody>
            <tr>
              <td>
                <p align="center"><font face="ＭＳ ゴシック">primitiveLED.c</font></p>
              </td>
            </tr>
            <tr>
              <td>
                <p><font face="ＭＳ ゴシック">void waitmsec(int msec)<br>
                    /*msec間なにもしない時間稼ぎ関数*/<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; int i,j;<br>
                    &nbsp;&nbsp;&nbsp; for (i=0;i&lt;msec;i++) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for
                    (j=0;j&lt;4190;j++); /*4190は実測によって求めた値 25MHz駆動*/<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</font></p>
                <p><font face="ＭＳ ゴシック">main()<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; /* P5の下位2ビットを出力に設定 */<br>
                    &nbsp;&nbsp;&nbsp; /*
                    P5の入出力設定部の下位2ビットに1を与えるとこの設定になる*/<br>
                    &nbsp;&nbsp;&nbsp; *(unsigned char *)0xfffc8 = 0x3;
                    /*0x3 は 00000011(二進法表記)*/</font></p>
                <p><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; while(1)
                    {/*これは無限ループ*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    /*P5の下位２ビットに01(二進法表記)を出力する*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    *(unsigned char *)0xfffca = 0x01; /*0x01 は
                    00000001(二進法表記)*/</font></p>
                <p><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    waitmsec(1000);/*1000msecの間なにもしない*/</font></p>
                <p><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    /*P5の下位２ビットに10(二進法表記)を出力する*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    *(unsigned char *)0xfffca = 0x02; /*0x02 は
                    00000010(二進法表記)*/</font></p>
                <p><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    waitmsec(1000);<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</font></p>
              </td>
            </tr>
          </tbody>
        </table>
      </p>
    </blockquote>
    
<p>　このプログラムは直接変更したいポートのアドレスを使って，値を書き込んで操作している。しかしポート操作に関しては。これから学ぶプロ
      グラムでは便利な関数群を与えるため，このようなプログラムは書かず，ポートのアドレスのことは意識しないことが多い。しかしこの部分はポー
      ト操作の本質であるため，課題の一部や試験では，ここで述べたことが必要になることがある。<br>
      ポート５を表わすのに，具体的な番地を記述すると，読みにくいしわかりにくいプログラムになってしまうため，記述方法に工夫をして，次の節で
      とりあげるような記述をするが，コンパイラにより機械語に翻訳されるとほぼ同じになる。</p>
    
<p>
      <table cellpadding="1" cellspacing="0" bgcolor="#ffff80" border="0">
        <tbody>
          <tr>
            <td>
              <p><font face="ＭＳ ゴシック">練習問題　次の作業を行ないなさい。<br>
                  （実行の様子を検察して，その結果，気付いた事を含め，別途指定された書式で括弧の中ファイル名で提出しなさい）<br>
                  <br>
                  （１）「<font face="ＭＳ ゴシック">primitiveLED.c</font>」を実行して，その動作を記述しなさい。<br>
                  　　その際，点滅周期と</font><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック">デ</font>ューティ比を求めなさい。<br>
                  　　また，プログラムのどこでその点滅周期とデューティ比が作られているのか考察しなさい。<br>
                  　　ただし，周期とは点灯開始時刻から次の点灯開始時刻までの時間のことであり，<br>
                  　　デューティ比とは1周期中の点灯時間の割合のことである。例えば周期8秒の点滅で，<br>
                  　　点灯時間が2秒だった場合はデューティ比25%である。<br>
                </font><font face="ＭＳ ゴシック">　　(mp2ex01.txt)</font><font face="ＭＳ ゴシック"><br>
                </font></p>
            </td>
          </tr>
        </tbody>
      </table>
    </p>
    
<p>&nbsp;</p>
    
<p><strong><font color="#000080">４． LEDの点滅のプログラム</font></strong></p>
    
<p>図３のLEDが対象となるLEDである。</p>
    
<p align="center">
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td><br>
              <br>
              <br>
              <img alt="H8-LEDD.JPG - 9,332BYTES" src="./H8 mother board programing_files/H8-LEDD.jpg"><br>
              <br>
              <font size="2">（図１，２の写真では，LEDが４つついているが，<br>
                右側の２つが，P5-0，P5-1につながっている。<br>
                左側の２つはP5-2，P5-3につながっており，<br>
                ここでは使わない。<br>
                左側の２つは実装されていなくても問題ない。）<br>
              </font></td>
            <td>
              <p align="center"><img src="./H8 mother board programing_files/Pin_numbers.jpg"></p>
            </td>
          </tr>
          <tr>
            <td>
              <p align="center">図３　2つのLED</p>
            </td>
            <td>
              <p align="center">CN3-31,32を探そう<br>
                CN3の両側には「1,2」と「39,40」が書いてある。<br>
                2&nbsp;4 6&nbsp;...... 38 40<br>
                1 3 5 ....... 37 39<br>
                のように並んでいる。31，32を探しなさい。</p>
            </td>
          </tr>
        </tbody>
      </table>
    </p>
    
<p><strong><font color="#000080">４．１&nbsp;&nbsp;&nbsp; LED点滅プログラム</font></strong></p>
    
<p>マザーボード上の２つのLEDを点滅させるプログラムを作る。直接アドレスを指定するのではなく，もうすこし洗練された表現でプログラムす
      る。<br>
      ２つのLEDはH8/3048foneCPUのポート5の第0ビット，第1ビットの端子につけられている。<br>
      H8/3048foneCPUでポートというのは8ビットの出入り口のことである。ポート5には第０ビットから第７ビットまでの８ビットがあ
      る。<br>
      ポートがCPUのどのピンに接続されているかはCPU設計者によって決められ，CPUのマニュアルに書いてある。<br>
      またCPUのピンがCPUカードのどのピンに接続されているかは，CPUカードの設計者によって決められ，CPUカードのマニュアルに書いて
      ある。<br>
      このWebページの「参考１」に接続一覧が書いてある。</p>
    
<p>通常ポートは入出力兼用なので，この例のようにポート5の第0ビット，第1ビットの端子の先にLEDがついている場合は，CPUに対し，こ
      の２つのビットは出力に使用することを教える必要がある。（CPU起動後１回だけ設定しなければなりません。）</p>
    
<p>参考　電流制限</p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p>CPUの出力端子はレベルHの時5V，レベルLの時0Vであり，LED単体の電圧降下が1.5V程度であるため，保護抵抗1.5ｋΩに
        は3.5Vがかかっていることになる。この抵抗に流れる電流は3.5[V]/1500[Ω] = 0.0023[A] =
        2.3[mA]となる。LEDは10mA駆動が標準であるが，1mA駆動でも光らないないわけではない。一方CPUの端子出力電流は最大
        2.0mAとされている（H8/3048foneの仕様）ので，AKI-H8はわずかに仕様違反となっている。</p>
    </blockquote>
    
<p><br>
      <br>
      <font color="#000080"><strong>４．２&nbsp;&nbsp;&nbsp; LED点滅プログラム</strong><font size="3"><span style="FONT-FAMILY: &#39;ＭＳ Ｐゴシック&#39;; FONT-SIZE:
            10.5pt; mso-bidi-font-size: 22.0pt; mso-bidi-font-family:
            &#39;Times New Roman&#39;; mso-ascii-font-family: Tahoma;
            mso-hansi-font-family: &#39;Times New Roman&#39;; mso-font-kerning:
            1.0pt; mso-ansi-language: EN-US; mso-fareast-language: JA;
            mso-bidi-language: AR-SA"><strong>の考え方</strong></span><br>
        </font></font><font color="#000000"><br>
      </font></p>
    
<p dir="ltr" align="left">（１）マイコン上での駆動の手順</p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p dir="ltr">(1)　ポート5の下位2ビットを出力に設定<br>
        　　　　　　　0：入力　　1：出力<br>
        　　　　　　　下位２ビット（第０ビットと第１ビット）を出力に設定するには<br>
        　　　　　　　２進法表現で00000011，１０進法表現（16進表現でも同じ）で3を与えればよい。<br>
        (2)　ポート5の下位2ビットに0または1を出力してLED点滅を行なう。<br>
        　　　　　　　0：OFF　　1：ON<br>
        (3)　時間調整して1秒ごとに２つのLEDが交互に点滅するようにする。</p>
    </blockquote>
    
<p>（２）具体的なプログラミングの考え方</p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p>ポート5の下位2ビットを出力に設定<br>
        以下を無限ループ<br>
        　　ポート5の第0ビットに1を出力<br>
        　　ポート5の第1ビットに0を出力<br>
        　　1秒間時間待ち<br>
        　　ポート5の第0ビットに0を出力<br>
        　　ポート5の第1ビットに1を出力<br>
        　　1秒間時間待ち</p>
    </blockquote>
    <font color="#000080"><strong>４．３　LED点滅プログラム</strong></font>
    
<p><br>
      <font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; /*P5の下位2ビットを出力に設定*/<br>
        &nbsp;&nbsp;&nbsp; P5.DDR =&nbsp; 0x3;<br>
        &nbsp;&nbsp;&nbsp; while(1) {/*これは無限ループ*/<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*LED0をONにする*/<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; P5.DR.BIT.B0=1;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*LED1をOFFにする*/<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; P5.DR.BIT.B1=0;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        msecwait(1000);/*1000msecの間なにもしない*/<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*LED0をOFFにする*/<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; P5.DR.BIT.B0=0;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*LED1をONにする*/<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; P5.DR.BIT.B1=1;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; msecwait(1000);<br>
        &nbsp;&nbsp;&nbsp; }</font></p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      
<p><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック">参考<br>
            （１）ポート５はP5という構造体（構造体学習前なら，家の名前と考えればよい）で表されていると考えられる。<br>
（２）P5の各ビットを入出力のどちらに使うかの設定はP5.DDRという8ビットのレジスタ（P5家のDDR部屋と考えればよ
            い）に設定する。ここでは下位2ビットのみを出力にするので2進数00000011に設定したいのでP5.DDRには3を設定す
            る。もし，第2，第3ビットのみを出力にしたいのなら，2進数00001100を設定すればよいので，P5.DDRには16進数
            で0xc（10進数では8+4=12）を設定する。またもし第0ビットと第3ビットのみを出力にしたいのなら，2進数
            00001001を設定すればよいので，P5.DDRには9を設定する。別のポートも同様な記述を行なうことができる。例えば
            ポート1の8ビットすべてを出力に設定したいのなら，2進数11111111に設定すればよいのでP1.DDR=0xffのよう
            に設定する。</font><font face="ＭＳ ゴシック"><br>
            （３）ポート5に出力する値はP5.DR（P5家のDR部屋）に出力する。P5.DRはさらに細かい小部屋に分かれてお
            り，P5.DR.BIT.B0はポート５の第0ビットを表す。同様にP5.DR.BIT.B1はポート５の第1ビット
            を，P5.DR.BIT.B2はポート５の第2ビットを，....のように使う。ポート５の第2ビットに0を出力したけれ
            ば，P5.DR.BIT.B2=0，ポート５の第2ビットに1を出力したければ，P5.DR.BIT.B2=1のように使う。こ
            の表現は1ビットのみを表すため，代入できる値は0または1のみである。またP5.DR.BYTEの表現では8ビットまとめて出
            力が可能である。例えばポート５の第2ビットに1を，その他のビットには0を出力したければ，00000100を出力することに
            なるので，P5.DR.BYTE=4のように表現できる。（ポート1の第0から第3ビットに1を，その他のビットには0を出力し
            たければ，00001111を出力することになるので，P1.DR.BYTE=0xf）<br>
（４）この構造体の定義はファイル「3048fone.h」にあるが，このファイルはH8CPU用コンパイラフォルダ中にある。<br>
PCのファイル検索で見つけることができる。<br>
</font></font><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック"></font></font></p>

      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td><font face="ＭＳ ゴシック"><img src="./H8 mother board programing_files/p5.gif"></font></td>
          </tr>
          <tr>
            <td>
              <p><font face="ＭＳ ゴシック">P5はDDRとDRの２つの8ビットのレジスタで構成されている<br>
                  さらにDRはBYTEとBITの２つの方法で書き込みが可能である。</font></p>
              <p align="center"><font face="ＭＳ ゴシック">参考図　レジスタP5の構造</font></p>
            </td>
          </tr>
        </tbody>
      </table>
      <p>
        <table cellpadding="1" cellspacing="0" border="3">
          <tbody>
            <tr>
              <td bgcolor="#ffff80"><a href="https://xythos.tokyo-ct.ac.jp/web/j/usr/kosaka/for_students/H8/3048/ioport/IOport.html">構造体に関するさ                  らに詳細な説明&nbsp;</a></td>
            </tr>
          </tbody>
        </table>
      </p>
      <p>
        <table cellpadding="1" cellspacing="1" bgcolor="#ff0000" border="1">
          <tbody>
            <tr>
              <td>
                <p align="center"><font color="#ffffff">勘どころ</font></p>
              </td>
            </tr>
            <tr>
              <td>
                <p><font color="#ffffff" face="ＭＳ ゴシック">ポート５のbit0とbit1にLEDをつけたのはマザーボードの
                    設計者が決めたことなので，<br>
                  </font><font color="#ffffff" face="ＭＳ ゴシック">回路がそのようにできている。<br>
                    すでに取り付けられているLEDを別のポートを介して</font><font color="#ffffff" face="ＭＳ ゴシック">点滅させることは，ソフトウェア<br>
                    の変更だけではできない。<br>
                    別のポートを介してLEDを点滅させるには，そのポートがどの端子とつながっている<br>
                    のか調べて，マザーボードの設計変更が必要になる。</font></p>
              </td>
            </tr>
          </tbody>
        </table>
      </p>
    </blockquote>
    
<p>&nbsp;<br>
</p>
<blockquote>
  <table cellpadding="2" cellspacing="2" border="1">
    <tbody>
      <tr align="center">
        <td valign="top">ミニ知識<br>
        </td>
      </tr>
      <tr>
        <td valign="top"><font face="ＭＳ ゴシック">msec(ミリセカンド)はミリ秒のことである。ミリとは1/1000のことで，1mm(ミリメートル)は1/1000m(メートル)，<br>
1mg(ミリグラム)は1/1000g，1ml(ミリリットル)は1/1000l(リットル)のように使われている。<br>
本来ミリセカンドはmsと表記すべきものであるが，わかりやすさのため，msecと表記している。</font><br>
        </td>
      </tr>
    </tbody>
  </table>
  <br>
</blockquote>
    
<p><strong><font color="#000080">４．４　実際のプログラム</font></strong></p>
    <strong></strong>
    
<div>
      <blockquote>
        <table cellpadding="1" cellspacing="1" border="1">
          <tbody>
            <tr>
              <td>
                <p align="center">led1st.c</p>
              </td>
            </tr>
            <tr>
              <td><font color="#800080" face="ＭＳ ゴシック">/*&nbsp;
                  waitmsec関数で1秒ごとのLEDのON-OFFを行う&nbsp; */<br>
                  #include &lt;3048fone.h&gt;<br>
                  <br>
                  void waitmsec(int msec)<br>
                  /*msec間なにもしない時間稼ぎ関数*/<br>
                  {<br>
                  &nbsp;&nbsp;&nbsp; int i,j;<br>
                  &nbsp;&nbsp;&nbsp; for (i=0;i&lt;msec;i++) {<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for
                  (j=0;j&lt;4190;j++);&nbsp;&nbsp;&nbsp;
                  /*4190は実測によって求めた値 25MHz駆動*/<br>
                  &nbsp;&nbsp;&nbsp; }<br>
                  }<br>
                  <br>
                  main()<br>
                  {<br>
                  &nbsp;&nbsp;&nbsp; /*P5の下位2ビットを出力に設定*/<br>
                  &nbsp;&nbsp;&nbsp; /* P5のDDRの下位2ビットに1を与えるとこの設定になる*/<br>
                  &nbsp;&nbsp;&nbsp;
                  /*DDRとはDataDirectionRegister(データ方向設定レジスタ)*/<br>
                  &nbsp;&nbsp;&nbsp; P5.DDR =&nbsp;
                  0x3;&nbsp;&nbsp;&nbsp;&nbsp; /*0x3 = 00000011(二進数)*/<br>
                  &nbsp;&nbsp;&nbsp; while(1) {/*これは無限ループ*/<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  /*LED0をONにする&nbsp; P5のDRの第0ビットを1にする*/<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  /*DRとはDataRegister(データレジスタ)*/<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  P5.DR.BIT.B0=1;<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  /*LED1をOFFにする&nbsp; P5のDRの第1ビットを0にする*/<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  P5.DR.BIT.B1=0;<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  waitmsec(1000);/*1000msecの間なにもしない*/<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  /*LED0をOFFにする&nbsp; P5のDRの第0ビットを0にする*/<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  P5.DR.BIT.B0=0;<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  /*LED1をONにする&nbsp; P5のDRの第1ビットを1にする*/<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  P5.DR.BIT.B1=1;<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  waitmsec(1000);<br>
                  &nbsp;&nbsp;&nbsp; }<br>
                  }</font></td>
            </tr>
          </tbody>
        </table>
      </blockquote>
      <br>
      <br>
      <strong><font color="#000080">４．５　実際のプログラム(「h8_3048fone.h」の利用)</font></strong></div>
    
<p><font face="ＭＳ ゴシック">　実用プログラムでは，ポートの記述はできるだけ隠すようにしている。h8_3048fone.hはマザーボード上のハードウェア操作のプログラミングを関数呼び出しで行なえるようにしたものである。関数呼び
        出しを利用すると，どこのポートのどのビットをどうするということを考えずに済み，専用コマンドを使うような感覚でプログラミングでき，
        便利である。<br>
        
　もう１つ重要なことがある。将来別のCPUを使うことになって，このプログラムを移植することになった場合を想定しよう。全体の動作を記述するプロ
グラムと，CPUのハードウェアを操作するプログラムを分離することにより，移植性が高くなることが想像できる。<br>
        関数の定義はh8_3048fone.h中にある。本Webページの末尾に「h8_3048fone.h」があるが，その先頭部分には関数の説明がある。</font></p>
    
<blockquote>
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td>
              <p align="center">led2nd.c</p>
            </td>
          </tr>
          <tr>
            <td><font color="#800080" face="ＭＳ ゴシック">#include
                &lt;3048fone.h&gt;<br>
                #include "h8_3048fone.h"<br>
                <br>
                void waitmsec(int msec)<br>
                {<br>
                &nbsp;&nbsp;&nbsp; int i,j;<br>
                &nbsp;&nbsp;&nbsp; for (i=0;i&lt;msec;i++) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for
                (j=0;j&lt;4190;j++);&nbsp;&nbsp;&nbsp; /*4190は実測によって求めた値
                25MHz駆動*/<br>
                &nbsp;&nbsp;&nbsp; }<br>
                }<br>
                <br>
                main()<br>
                {<br>
                &nbsp;&nbsp;&nbsp; initLed();&nbsp; /*LED初期化*/<br>
                &nbsp;&nbsp;&nbsp; while(1) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; turnOnLed(0);
                /*LED0のON*/<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                turnOffLed(1); /*LED1のOFF*/<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                waitmsec(1000);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                turnOffLed(0); /*LED0のOFF*/<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; turnOnLed(1);
                /*LED1のON*/<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                waitmsec(1000);<br>
                &nbsp;&nbsp;&nbsp; }<br>
                }</font></td>
          </tr>
        </tbody>
      </table>
    </blockquote>
    
<div>
      <table cellpadding="1" cellspacing="0" bgcolor="#ffff80" border="0">
        <tbody>
          <tr>
            <td>
              <p><font face="ＭＳ ゴシック">練習問題　led2nd.cを元にして次のプログラムを作りなさい。<br>
                  （実行の様子を検察して，その結果，気付いた事を含め，別途指定された書式で括弧<br>
                  の中ファイル名で提出しなさい）</font></p>
              
<p><font face="ＭＳ ゴシック">（１）周期1秒，デューティ比50%で両方のLEDが同時に点滅するプログラム（mp3ex01.txt）<br>
                  　　ただし，周期とは点灯開始時刻から次の点灯開始時刻までの時間のことであり，<br>
                  　　デューティ比とは1周期中の点灯時間の割合のことである。例えば周期8秒の点滅で，<br>
                  　　点灯時間が2秒だった場合はデューティ比25%である。<br>
                  （２）周期0.5秒，デューティ比50%で左右のLEDが交互に点滅するプログラム<br>
                  　　（0.5秒ごとにではないことに注意）　　(mp3ex02.txt)<br>
                  （３）0.5秒ごとに点灯状態が変化し，次の点滅パターンを繰り返すプログラム<br>
                  　　左側2回点滅→右側2回点滅→左側1回点滅→右側1回点滅<br>
                  　　(mp3ex03.txt)<br>
                  （４）10秒周期で両方のLEDが同時に点滅するプログラムをつくり動作させなさい。<br>
                  　　動作中にアナログテスタを使って，CN3の31，32の電圧を測定しなさい。<br>
                  　　測定に当たっては本文書参考１のピン配置よりGNDを基準としなさい。<br>
　　（実はシリアルケーブル・コネクタの金属部分もGNDである。ここが触りやすい。）<br>
　　（CN3の1,2がGND（グランド））<br>
                  　　(mp3ex04.txt)</font></p>

            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
<div>&nbsp;
      <div><a href="https://xythos.tokyo-ct.ac.jp/web/j/usr/kosaka/for_students/H8/H8-MB-Pro/voltagecheck.pdf">
          <div>電圧計の使い方</div>
        </a></div>
      <div>&nbsp;</div>
    </div>
    
<div>
      <table cellpadding="1" cellspacing="0" bgcolor="#ffff80" border="0">
        <tbody>
          <tr>
            <td>
              <p><font face="ＭＳ ゴシック">練習問題　次の作業を行ないなさい。<br>
                  （実行の様子を検察して，その結果，気付いた事を含め，別途指定された書式で括弧の中ファイル名で提出しなさい）<br>
                  <br>
                  （１）「led2nd.c」で「#include
                  "h8_3048fone.h"」を消去し，h8_3048fone.h中にある関数initLed()，turnOnLed()，<br>
                  　　turnOffLed()を自分のプログラム中にコピー＆ペーストし，他にも必要なものを記述して動作を確認し，<br>
　　提出しなさい。<br>
                  　　#include
                  "ファイル名"とは，#includeが記述された位置に，そのファイルの内容が書かれていると解釈して<br>
                  　　コンパイルしなさいという意味である。<br>
                  　　考察に次のことを記述しなさい。<br>
                  　　「３． マイクロコンピュータのプログラムと，デジタルの0V，5Vの世界をつなぐ」を読み直して<br>
                  　　h8_3048fone.h中にある関数
                  initLed()，turnOnLed()，turnOffLed()について説明しなさい。<br>
                  　　なおH8/3048foneハードウェアマニュアルの関連する説明を抜き出しなさい。（９．６
                  ポート5，モード７参照）<br>
                  　　</font><a href="http://tnct20/~kosaka/for_students/H8/j602093_h83048.pdf"><font face="ＭＳ ゴシック">http://tnct20.tokyo-ct.ac.jp/~kosaka/for_students/H8/j602093_h83048.pdf</font></a><br>
                <font face="ＭＳ ゴシック">　　(mp3ex05.txt)<br>
                  （２）ポート1のbit0,bit1,bit2,bit3に保護抵抗付きのLEDが接続されているとする。<br>
                  　　次のような設計仕様の場合のLED初期化関数initLed_P1()と
                  turnOnLed_P1()，turnOffLed_P1()を作りなさい。<br>
                  　　void initLed_P1(void)　LED初期化関数<br>
                  　　void turnOnLed_P1(int number) LEDを点灯させる関数。<br>
                  　　&nbsp; ただし，引数は0,1,2,3を取り，LED0,1,2,3をそれぞれ個別に点灯させる。<br>
                  　　void turnOffLed_P1(int number) LEDを消灯させる関数。<br>
                  　　&nbsp; ただし，引数は0,1,2,3を取り，LED0,1,2,3をそれぞれ個別に消灯させる。<br>
                  　　mainプログラムではこれらの関数を用いて，４つのLEDについて2秒ごとに0,1,2,3番LEDが順に点灯し消灯する<br>
　　ようにプログラム全体を作りなさい。LEDの点滅は見えないけれど，</font><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック">ポート1のbit0,bit1,bit2,bit3がどこのピン<br>
　　に見えるか調べて，</font>テスタにてチェックしなさい。<br>
                  </font><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック">　　（ヒントP1-B0からP1-B3をこのページ後ろの「参考１ H8ピン配置」で探す）<br>
                  </font>　　(mp3ex06.txt)</font><br>
</p></td></tr></tbody></table></div><div>
      <strong></strong>&nbsp;</div>
    
<div><strong></strong>&nbsp;</div>
    
<div><strong><font color="#000080">４．６　 LEDのPWM駆動</font></strong></div>
    
<p style="TEXT-ALIGN: left; mso-pagination: widow-orphan" class="MsoNormal" align="left"><font face="ＭＳ ゴシック">LEDを高速にON-OFFを繰返し，ONになっている時間と周期との比
      （デューティ比）を変化させると，人間の目には点滅は見えず，デューティ比に応じて明るさが変化しているように見える。<br>
      このような高速ON-OFFスイッチングで出力を制御する方法は「パルス幅変調（ＰＷＭ）」「Pulse Width
      Modulation」と呼ばれる。<br>
      次のプログラムはＬＥＤ０を点灯状態に保ち，ＬＥＤ１をＰＷＭ駆動する。3秒ごとに，デューティ比を９０％，５０％，１０％と変化させている。</font></p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p style="TEXT-ALIGN: left; mso-pagination: widow-orphan" class="MsoNormal" align="left">
        <table cellpadding="1" cellspacing="1" border="1">
          <tbody>
            <tr>
              <td>
                <p align="center"><font face="ＭＳ ゴシック">ledpwm.c</font></p>
              </td>
            </tr>
            <tr>
              <td>
                <p><font color="#800080" face="ＭＳ ゴシック">/**********************************************************<br>
                    LEDのPWM(PulseWidthModulation)駆動<br>
**********************************************************/<br>
                    #include &lt;3048fone.h&gt;<br>
                    #include "h8_3048fone.h"</font></p>
                <p><font color="#800080" face="ＭＳ ゴシック">void
                    waitmsec(int msec)<br>
                    /*msec間なにもしない時間稼ぎ関数*/<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; int i,j;<br>
                    &nbsp;&nbsp;&nbsp; for (i=0;i&lt;msec;i++) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for
                    (j=0;j&lt;4190;j++);&nbsp;&nbsp;&nbsp;
                    /*4190は実測によって求めた値 25MHz駆動*/<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</font></p>
                <p><font color="#800080" face="ＭＳ ゴシック">main()<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; int i;<br>
                    &nbsp;&nbsp;&nbsp; initLed();&nbsp; /*LED初期化*/<br>
                    &nbsp;&nbsp;&nbsp; turnOnLed(0); /*LED0のON*/<br>
                    &nbsp;&nbsp;&nbsp; while(1) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for
                    (i=0;i&lt;300;i++) { /*ループ3秒間ループ　デューティ比90%*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    turnOnLed(1); /*LED1のON*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    waitmsec(9);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    turnOffLed(1); /*LED1のOFF*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    waitmsec(1);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for
                    (i=0;i&lt;300;i++) { /*ループ3秒間ループ　デューティ比50%*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    turnOnLed(1); /*LED1のON*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    waitmsec(5);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    turnOffLed(1); /*LED1のOFF*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    waitmsec(5);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for
                    (i=0;i&lt;300;i++) { /*ループ3秒間ループ　デューティ比10%*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    turnOnLed(1); /*LED1のON*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    waitmsec(1);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    turnOffLed(1); /*LED1のOFF*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    waitmsec(9);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</font></p>
              </td>
            </tr>
          </tbody>
        </table>
      </p>
    </blockquote>
    
<p style="TEXT-ALIGN: left; mso-pagination: widow-orphan" class="MsoNormal" align="left">&nbsp;</p>
    
<p style="TEXT-ALIGN: left; mso-pagination: widow-orphan" class="MsoNormal" align="left"><font face="ＭＳ ゴシック">次のプログラムは約1秒間隔でLED2が徐々に明るくなる動作を繰り返すプ
      ログラムである。<br>
      ｐは0から999まで変化するが，各ｐの値に対してｉの値が0から999まで変化する。<br>
      ｐが10の時は，ｉが0から9の時ＬＥＤ１はＯＮで10から999まではＯＦＦとなる。すなわちｐが10の時ＬＥＤ１がＯＮになっている
      時間割合は1％程度である。<br>
      ｐが100の時は，ｉが0から99の時ＬＥＤ１はＯＮで100から999まではＯＦＦとなる。すなわちｐが100の時ＬＥＤ１がＯＮに
      なっている時間割合は10％程度である。<br>
      ｐが900の時は，ｉが0から899の時ＬＥＤ１はＯＮで900から999まではＯＦＦとなる。すなわちｐが900の時ＬＥＤ１がＯＮに
      なっている時間割合は90％程度である。<br>
      このように時間経過を考えると，LED1がONになっている時間とOFFになっている時間比が変化している。しかし大変高速にＬＥＤ１が点滅しているため，人間の目にはＬＥＤ１の明るさが変化しているように見える。</font><br>
    </p>
    
<div style="TEXT-ALIGN: left; mso-pagination: widow-orphan" class="MsoNormal" align="left">
      <blockquote>
        <table cellpadding="1" cellspacing="1" border="1">
          <tbody>
            <tr>
              <td>
                <p align="center">ledpwm1.c</p>
              </td>
            </tr>
            <tr>
              <td><font color="#800080" face="ＭＳ ゴシック">/**********************************************************<br>
                  LEDのPWM(PulseWidthModulation)駆動<br>
**********************************************************/<br>
                  #include &lt;3048fone.h&gt;<br>
                  #include "h8_3048fone.h"<br>
                  <br>
                  main()<br>
                  {<br>
                  &nbsp;&nbsp;&nbsp; int p,i;<br>
                  &nbsp;&nbsp;&nbsp; initLed();&nbsp; /*LED初期化*/<br>
                  &nbsp;&nbsp;&nbsp; turnOnLed(0); /*LED0のON*/<br>
                  &nbsp;&nbsp;&nbsp; while(1) {<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for
                  (p=0;p&lt;1000;p++) {<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  for (i=0;i&lt;1000;i++) {<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  if (i&lt;p) turnOnLed(1); /*LED1のON*/<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  else turnOffLed(1); /*LED1のOFF*/<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  }<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                  &nbsp;&nbsp;&nbsp; }<br>
                  }</font></td>
            </tr>
          </tbody>
        </table>
      </blockquote>
      <table cellpadding="1" cellspacing="0" bgcolor="#ffff80" border="0">
        <tbody>
          <tr>
            <td>
              <p><font face="ＭＳ ゴシック">練習問題　次の作業を行ないなさい。<br>
                  （実行の様子を検察して，その結果，気付いた事を含め，別途指定された書式で括弧の中ファイル名で提出しなさい）<br>
                  <br>
                  （１）「ledpwm.c」を参考にして，ＬＥＤ１をＰＷＭ駆動する。<br>
                  　　PWM周期を10msecに「保ったまま，４秒ごとに，デューティ比を２％，４％，８％，１６％，３２％，６４％と<br>
　　変化させるプログムを作りなさい。<br>
                  &nbsp;&nbsp;&nbsp; ヒント　次の関数の使用を検討する</font></p>
              <blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
                <p><font face="ＭＳ ゴシック">void wait_m4sec(int m4_sec)<br>
                    /*10^-4secで指示する間なにもしない時間稼ぎ関数*/<br>
                    /*たとえば　wait_m4sec(15);を呼ぶと1.5msec後にこの関数から戻る*/<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; int i,j;<br>
                    &nbsp;&nbsp;&nbsp; for (i=0;i&lt;m4_sec;i++) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for
                    (j=0;j&lt;419;j++); /*419の根拠を考えてみよう<font face="ＭＳ
                      ゴシック">*/</font><br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</font></p>
              </blockquote>
              <p dir="ltr"><font face="ＭＳ ゴシック">　　(mp3ex07.txt)<br>
                  <br>
                  （２）「ledpwm.c」では高速点滅を眼で確認できなかったと思う。<br>
                  　　LEDをデューティ比50％で駆動し，1周期をどれくらいにすると点滅を眼で確認できてしまうのか，<br>
                  　　境界のを実験により求めなさい。そのためのプログラムを作って確認しなさい。<br>
                  　　（mp3ex08.txt）　</font>　</p>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      <br>
      <br>
      <strong><font color="#000080">５．　8ビットスイッチ</font></strong></div>
    
<p align="left">図３の８ビットスイッチの読み取りを行い，ＬＥＤを制御する。<br>
      8ビットスイッチはＰ２の８つのビットすべてにつながっている。</p>
    
<p align="center">
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td><br>
              <img alt="H8-8BITSWD.JPG - 12,938BYTES" src="./H8 mother board programing_files/H8-8BitSWD.jpg"></td>
          </tr>
          <tr>
            <td>
              <p align="center">図３　８ビットスイッチ</p>
            </td>
          </tr>
        </tbody>
      </table>
    </p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
        <p align="left">参考<br>
          通常用いられるのは，図３．１の回路である。スイッチがOFFの時CPUの入力ピンには5Vが与えられ，スイッチがONの時CPUの
          入力ピンには0Vが与えられる。この用途で用いられている抵抗のことをプルアップ抵抗と呼んでいる。通常この抵抗値は10kΩから
          100kΩが用いられる。図3.2左はスイッチがOFFであるため，電流は流れず，抵抗で電圧降下が起こらないため，5Vが出力され
          ているところを示している。図3.2右はスイッチがONであるため，電流が流れ，抵抗で電圧降下が起こり，0Vが出力されているとこ
          ろを示している。<br>
          H8CPUのポート2，4，5では，スイッチのON-OFF状態の取得等に都合の良い仕掛けがある。図３．３に示すように，図３．１
          のプルアップ抵抗をCPUユニットが内蔵しており，プルアップ抵抗を有効にするかどうかをソフトウェアで決めることができるように
          なっている。このプルアップ抵抗の有効無効を設定するのが，プルアップコントロールレジスタ（PCR）である。<br>
          AKI-H8のマザーボードでは，ディップスイッチ（８ビットスイッチ）がポート２の8つのビットに，プッシュスイッチ（４つ）が
          ポート4の上位４ビットにつながっており，P2.PCRとP4.PCRの対応するビットに1を書き込むことで，プルアップ抵抗を有効
          にして使用することができる。そのため，マザーボード上のこれらのスイッチにはプルアップ抵抗がついていない。<br>
          <table cellpadding="1" cellspacing="1" border="1">
            <tbody>
              <tr>
                <td><img src="./H8 mother board programing_files/sw_R.gif"></td>
                <td><img src="./H8 mother board programing_files/SW_R_exp.gif"></td>
                <td><img src="./H8 mother board programing_files/pullup.gif"></td>
              </tr>
              <tr>
                <td>図３．１　スイッチ状態のCPUへの入力</td>
                <td>図３．２　プルアップ抵抗の役割</td>
                <td>図３．３　H8のプルアップコントロール</td>
              </tr>
            </tbody>
          </table>
        </p>
        <p align="left">外部からのポートのビット入力が5Vの時，CPU内部では1としてとらえ，0Vの時は0としてとらえ
          る。<br>
          その結果，ハードウェアの構成に依存して，<font color="#ff0000">スイッチの状態ONを0，状態OFFを１と
            して</font>，レジスタに取り込まれることになる。</p>
        <p align="left">
          <table cellpadding="1" cellspacing="1" border="1">
            <tbody>
              <tr>
                <td>スイッチの状態</td>
                <td>ポートのビット入力端子の電圧</td>
                <td>レジスタに取り込まれるビット状態</td>
              </tr>
              <tr>
                <td>
                  <p align="center">ON</p>
                </td>
                <td>
                  <p align="center">0V</p>
                </td>
                <td>
                  <p align="center">0</p>
                </td>
              </tr>
              <tr>
                <td>
                  <p align="center">OFF</p>
                </td>
                <td>
                  <p align="center">5V</p>
                </td>
                <td>
                  <p align="center">1</p>
                </td>
              </tr>
            </tbody>
          </table>
        </p>
      </blockquote>
    </blockquote>
    
<p align="left">&nbsp;</p>
    
<p><strong><font color="#000080">５．１　8ビットSWでLED駆動</font></strong></p>
    <strong></strong>
    
<p class="MsoNormal"><font face="ＭＳ ゴシック">８ビットスイッチのON-OFFの状態によってLEDの
        ON-OFFを制御するプログラムを作成する。<br>
        ＬＥＤ駆動部のみh8_3048fone.hを用いてプログラムを作る。<br>
        ８ビットスイッチの各端子はH8内部でプルアップされる設定なので，スイッチがONになるとポート２の対応するビットは0になる。
        OFFになると１になる。<br>
        「8bitSWの０（ポート2の第0ビット）が<font color="#ff0000">ON</font>の時では」というのは
        「if (P2.DR.BIT.B0==<font color="#ff0000">0</font>) {」のようになり，<br>
        「8bitSWの１</font><font face="ＭＳ ゴシック">（ポート2の第0ビット）が<font color="#ff0000">OFF</font>の時では」というのは「if (P2.DR.BIT.B0==<font color="#ff0000">1</font>) {」のようになり，<br>
        通常の感覚と逆なので注意が必要である。</font></p>
    
<blockquote class="MsoNormal">
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td>
              <p align="center"><font color="#993399" face="ＭＳ ゴシック">eightsw.c</font></p>
            </td>
          </tr>
          <tr>
            <td><font face="ＭＳ Ｐゴシック"><font color="#800080"><font color="#000000"><font color="#800080" face="ＭＳ ゴシック">/**********************************************************<br>
                      8ビットスイッチによってLEDのON-OFFを行う<br>
**********************************************************/<br>
                      #include &lt;3048fone.h&gt;<br>
                      #include "h8_3048fone.h"<br>
                      <br>
                      main()<br>
                      {<br>
                      &nbsp;&nbsp;&nbsp; initLed();<br>
                      &nbsp;&nbsp;&nbsp; P2.DDR =
                      0x00;/*8bitSWのポートを入力に設定*/<br>
                      &nbsp;&nbsp;&nbsp; P2.PCR.BYTE =
                      0xff;/*8bitSWのプルアップ設定*/<br>
                      &nbsp;&nbsp;&nbsp; while(1) {<br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                      (P2.DR.BIT.B0==0) { /*8bitSWの0がONの時*/<br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      turnOnLed(0);<br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      turnOnLed(1);<br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else
                      if (P2.DR.BIT.B1==0) { /*8bitSWの1がONの時*/<br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      turnOnLed(0);<br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      turnOffLed(1);<br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else
                      if (P2.DR.BIT.B2==0) { /*8bitSWの2がONの時*/<br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      turnOffLed(0);<br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      turnOnLed(1);<br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else
                      {<br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      turnOffLed(0);<br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      turnOffLed(1);<br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                      &nbsp;&nbsp;&nbsp; }<br>
                      }</font></font></font></font></td>
          </tr>
        </tbody>
      </table>
    </blockquote>
    <font face="ＭＳ Ｐゴシック"><font color="#800080"><font color="#000000">
          <p><font face="ＭＳ Ｐゴシック"><font color="#800080"><font color="#000000">参考　<font face="ＭＳ ゴシック">「P2.DDR」は「P2の
                    DDR」，「P2.PCR.BYTE」は「P2のPCRをバイト単位で見た時のバイトデータ」，
                    「P2.DR.BIT.B0」は「P2のDRをビットごと指定した時の第0ビット」と読めばよい。
                    「P2.DDR」に指定できる値は0から255（0xff），「P2.PCR.BYTE」に入る値は0から
                    255（0xff），「P2.DR.BIT.B0」に入る値は0または1である。<br>
                    この例ではでてこないが，P2.PCR.BIT.B0」は「P2のPCRをビットごと指定した時の第0ビット」
                    と読み，この場合は入る値は0または1となる。</font></font></font></font></p>
          <p><font face="ＭＳ ゴシック">参考　P2をアドレスでみると，P2.DDRは0xfffc1，P2.DRは
              0xfffc3，P2.PCRは0xfffd8の1バイトということになる。<br>
              よって，P2表記との対応を見ると次のようになる。<br>
              <table cellpadding="1" cellspacing="1" border="1">
                <tbody>
                  <tr>
                    <td>意味</td>
                    <td>P2表記</td>
                    <td>アドレス直接表記</td>
                  </tr>
                  <tr>
                    <td>P2.DRを入力設定</td>
                    <td>P2.DDR=0;</td>
                    <td>*(unsigned char *)0xfffc1=0;</td>
                  </tr>
                  <tr>
                    <td>P2.DRの全ビットプルアップ設定</td>
                    <td>P2.RCR=0xff;</td>
                    <td>*(unsigned char *)0xfffd8=0xff;</td>
                  </tr>
                  <tr>
                    <td>
                      <p>P2.DR.BIT.B2のチェック</p>
                    </td>
                    <td>if (P2.DR.BIT.B2==0) {</td>
                    <td>if ((*(unsigned char *)0xfffc3 &amp; 4)==0) {</td>
                  </tr>
                </tbody>
              </table>
            </font><font face="ＭＳ ゴシック"><br>
            </font><font face="ＭＳ ゴシック"><br>
            </font></p>
        </font></font></font>
    
<p><br>
      <font color="#000080"><strong>５．２　
          8ビットSWでLED駆動(「h8_3048fone.h」の利用)</strong></font> </p>
    
<div class="MsoNormal"><strong></strong>&nbsp;</div>
    
<div class="MsoNormal">
      <div class="MsoNormal"><font face="ＭＳ ゴシック">8ビットSWの操作も
          「h8_3048fone.h」を利用すると都合がよい。<br>
          ５．１のようなプログラムでは，スイッチのON-OFFの表現が直観とは異なる（ONが0，OFFが1）ので，</font></div>
      <div class="MsoNormal"><font face="ＭＳ ゴシック">関数check8BitSW()を使うのがよ
          い。<br>
          <br>
          プログラム中でcheck8BitSWはh8_3048fone.h中に<br>
          short int check8BitSW(short int number)<br>
          で定義されている8bitsw
          0,1,2,3,4,5,6,7の状態を調べる関数で，引数numberは0,1,2,3,4,5,6,or 7をとり，<br>
          numberで示されたスイッチがONなら1、そうでなかったら0を関数の戻り値として返してくる。<br>
          （ポートへの入力を0-1反転して考えている）<br>
          この関数のおかげで，「0:OFF，1:ON」という普通の感覚でプログラミングできる。</font></div>
    </div>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td align="center"><font color="#800080"><font face="ＭＳ ゴシック" size="3">
              eightswh.c</font></font>
            </td>
          </tr>
          <tr>
            <td align="left"><font color="#800080"><font face="ＭＳ ゴシック" size="3">
/**********************************************************<br>
                        8ビットスイッチによってLEDのON-OFFを行う<br>
**********************************************************/<br>
                        #include &lt;3048fone.h&gt;<br>
                        #include "h8_3048fone.h"<br>
                        <br>
                        main()<br>
                        {<br>
                        &nbsp;&nbsp;&nbsp; initLed();<br>
                        &nbsp;&nbsp;&nbsp; init8BitSW();/*8bitSWの初期化*/<br>
                        &nbsp;&nbsp;&nbsp; while(1) {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                        (check8BitSW(0)) { /*8bitSWの0がONの時*/<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        turnOnLed(0);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        turnOnLed(1);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
                        else if (check8BitSW(1)) { /*8bitSWの1がONの時*/<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        turnOnLed(0);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        turnOffLed(1);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
                        else if (check8BitSW(2)) { /*8bitSWの2がONの時*/<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        turnOffLed(0);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        turnOnLed(1);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
                        else {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        turnOffLed(0);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        turnOffLed(1);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                        &nbsp;&nbsp;&nbsp; }<br>
                        }</font></font></td>
          </tr>
        </tbody>
      </table>
      <p><font face="ＭＳ ゴシック">C言語では，if文のかっこの中に値があるときは，0なら偽，それ以外の値なら真と判断される。<br>
          check8BitSW()は対象のスイッチがONのとき1，OFFのとき0なので，その値で真偽判断すればよい。<br>
          当然　if(check8BitSW(0)==1)と
          if(check8BitSW(0)!=0)，if(check8BitSW(0))は同じ働きとなる。<br>
        </font></p>
    </blockquote>
    
<p dir="ltr"><strong><font color="#000080">５．３　
          8ビットSWが入力されているポートの各ビットを見てみよう(「h8_3048fone.h」の利用)</font></strong>
    </p>
    
<p dir="ltr"><font face="ＭＳ ゴシック">直接P2の各ビットを見てみよう。またh8_3048fone.hに定義されているget8BitSW()では，ビッ
      トパタンでスイッチの様子を<br>
      見ることができるが，ONのスイッチは1，OFFのスイッチは0になるように工夫されている。</font></p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td>
              <p align="center"><font face="ＭＳ Ｐゴシック"><font size="3"><span style="FONT-FAMILY: Tahoma; FONT-SIZE: 10.5pt;
                      mso-bidi-font-size: 22.0pt; mso-hansi-font-family:
                      &#39;Times New Roman&#39;; mso-fareast-font-family: &#39;ＭＳ ゴシック&#39;" lang="EN-US"><font color="#800080" face="ＭＳ ゴシック" size="3">print8bitswstatus.c</font></span></font></font></p>
            </td>
          </tr>
          <tr>
            <td>
              <p><font face="ＭＳ ゴシック"><font size="3"><span style="FONT-FAMILY: Tahoma; FONT-SIZE: 10.5pt;
                      mso-bidi-font-size: 22.0pt; mso-hansi-font-family:
                      &#39;Times New Roman&#39;; mso-fareast-font-family: &#39;ＭＳ
                      Ｐゴシック&#39;" lang="EN-US"><font color="#800080" face="ＭＳ ゴシック" size="3"><font color="#800080" face="ＭＳ ゴシック">/**********************************************************<br>
                          マザーボードの8ビットスイッチがつながっているP2の各ビットを<br>
                          直接見てみよう。<br>
                          また，関数get8BitSW()が得る値を見てみよう。<br>
**********************************************************/<br>
                          #include &lt;3048fone.h&gt;<br>
                          #include "h8_3048fone.h"</font></font></span></font></font></p>
              <p><font face="ＭＳ ゴシック"><font size="3"><span style="FONT-FAMILY: Tahoma; FONT-SIZE: 10.5pt;
                      mso-bidi-font-size: 22.0pt; mso-hansi-font-family:
                      &#39;Times New Roman&#39;; mso-fareast-font-family: &#39;ＭＳ
                      Ｐゴシック&#39;" lang="EN-US"><font color="#800080" face="ＭＳ Ｐゴシック" size="3"><font color="#800080" face="ＭＳ ゴシック">main()<br>
                          {<br>
                          &nbsp;&nbsp;&nbsp; unsigned char sw1,sw2;<br>
                          &nbsp;&nbsp;&nbsp; initLed();<br>
                          &nbsp;&nbsp;&nbsp; initSCI1();<br>
                          &nbsp;&nbsp;&nbsp; init8BitSW();/*8bitSWの初期化*/<br>
                          &nbsp;&nbsp;&nbsp; while(1) {<br>
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                          sw1=P2.DR.BYTE;<br>
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                          sw2=get8BitSW();<br>
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                          SCI1_printf("P2.DR.BYTE=%08b
                          get8BitSW()=%08b\n",sw1,sw2);<br>
                          &nbsp;&nbsp;&nbsp; }<br>
                          }</font></font></span></font></font></p>
            </td>
          </tr>
        </tbody>
      </table>
    </blockquote>
    
<div class="MsoNormal">
      <table cellpadding="1" cellspacing="0" bgcolor="#ffff80" border="0">
        <tbody>
          <tr>
            <td>
              
<p><font size="3"><span style="FONT-FAMILY: Tahoma;
                    FONT-SIZE: 10.5pt; mso-bidi-font-size: 22.0pt;
                    mso-hansi-font-family: &#39;Times New Roman&#39;;
                    mso-fareast-font-family: &#39;ＭＳ Ｐゴシック&#39;" lang="EN-US"><font face="ＭＳ ゴシック" size="3">練習問題　eightsw.cを元にして次のプログラム
                      を作りなさい。<br>
                      （実行の様子を検察して，その結果，気付いた事を含め，別途指定された書式で括弧の中ファイル名で提出しな
                      さい）<br>
                      <br>
                      （１）8bitSWの1がOFFの時，0.5秒周期で２つのLEDを同時点滅，<br>
                      　　8bitSWの1がONの時，1秒周期で２つのLEDを同時点滅<br>
                      　　(mp<font size="3">4</font>ex01.txt)<br>
                      （２）8bitSWの0がONのとき，0.5秒周期で２つのLEDを同時点滅，<br>
                      　　8bitSWの0がOFFで，8bitSWの1がONのとき，1秒周期で２つのLEDを同時点滅，<br>
                      　　8bitSWの0と1がOFFで，8bitSWの2がONのとき，２秒周期で２つのLEDを同時点滅<br>
                      　　(mp<font size="3">4</font>ex02.txt)</font></span></font></p>

            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
<div class="MsoNormal"><font face="ＭＳ Ｐゴシック"><font size="3"><span style="FONT-FAMILY: Tahoma; FONT-SIZE: 10.5pt;
            mso-bidi-font-size: 22.0pt; mso-hansi-font-family: &#39;Times
            New Roman&#39;; mso-fareast-font-family: &#39;ＭＳ Ｐゴシック&#39;" lang="EN-US"></span></font></font>&nbsp;</div>
    
<div class="MsoNormal">
      <table cellpadding="1" cellspacing="0" bgcolor="#ffff80" border="0">
        <tbody>
          <tr>
            <td>
              <p><font size="3"><span style="FONT-FAMILY: Tahoma;
                    FONT-SIZE: 10.5pt; mso-bidi-font-size: 22.0pt;
                    mso-hansi-font-family: &#39;Times New Roman&#39;;
                    mso-fareast-font-family: &#39;ＭＳ Ｐゴシック&#39;" lang="EN-US"><font face="ＭＳ ゴシック" size="3">練習問題<br>
                      <br>
                      （１）8bitスイッチの回路図を見ると，CPUの端子からスイッチを経てGNDに接続されているだけである。<br>
                      　　通常はこの回路ではスイッチの状態を読み取ることができない。<br>
                      　　スイッチを読み取るプログラムの初期化部分の意味（8bitSWのプルアップ設定）とあわせてどうし<br>
                      　　</font></span></font><font size="3"><span style="FONT-FAMILY: Tahoma; FONT-SIZE: 10.5pt;
                    mso-bidi-font-size: 22.0pt; mso-hansi-font-family:
                    &#39;Times New Roman&#39;; mso-fareast-font-family: &#39;ＭＳ
                    Ｐゴシック&#39;" lang="EN-US"><font face="ＭＳ Ｐゴシック" size="3"><font face="ＭＳ ゴシック">て可能なのか検討し，説明しなさい。<br>
                        　　なおH8/3048foneハードウェアマニュアルの関連する説明を抜き出しなさい。（９．３
                        ポート2参照）<br>
                        　　また小坂のweb文書「h8CPU_Input.html」も参考にしなさい。<br>
                        　　(mp<font size="3">4</font>ex03.txt)<br>
                        （２）8bitスイッチで，4つのスイッチをON，残りの４つのスイッチをOFFにしなさい。<br>
                        　　5.3のプログラムを動かして，テスタとターミナルの画面を使って，<br>
                        　　8ビットスイッチのON-OFFの状態が電圧として見え，マイコン内部ではどのように見えているか<br>
                        　　調べなさい。<br>
                        　　（ヒントCN3のどこか）<br>
                        　　本ページ下部の「参考１ H8ピン配置」を参照しなさい。<br>
                        　　どのように検証したか（テスタの赤黒を何処に触れたのかを含む），どのような結果が得られたか<br>
                        　　表にして報告しなさい。<br>
                        　　(mp<font size="3">4</font>ex04.txt)</font></font></span></font></p>
              <blockquote style="MARGIN-RIGHT: 0px" dir="ltr"><font face="ＭＳ ゴシック" size="3"><span style="FONT-FAMILY:
                    Tahoma; FONT-SIZE: 10.5pt; mso-bidi-font-size:
                    22.0pt; mso-hansi-font-family: &#39;Times New Roman&#39;;
                    mso-fareast-font-family: &#39;ＭＳ Ｐゴシック&#39;" lang="EN-US">
                    <p>
                      <table cellpadding="2" cellspacing="2" border="1">
                        <tbody>
                          <tr>
                            <td>8bit<br>
                              SW</td>
                            <td>ON/OFF</td>
                            <td>赤ピンで<br>
                              触れたところ</td>
                            <td>黒ピンで<br>
                              ふれたところ</td>
                            <td>電圧</td>
                            <td>port番号</td>
                            <td>bit番号</td>
                            <td>ポートを直接見ると<br>
                              0，1のどちらが見えるか</td>
                            <td>関数get8BitSW()<br>
                              では0，1のどちらに見えるか</td>
                          </tr>
                        </tbody><tbody>
                          <tr>
                            <td align="center">0</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;CN3-</td>
                            <td>　CN3-</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td><br>
                            </td>
                          </tr>
                          <tr>
                            <td align="center">1</td>
                            <td>&nbsp;</td>
                            <td>　</td>
                            <td>　</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td><br>
                            </td>
                          </tr>
                          <tr>
                            <td align="center">2</td>
                            <td>&nbsp;</td>
                            <td>　</td>
                            <td>　</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td><br>
                            </td>
                          </tr>
                          <tr>
                            <td align="center">3</td>
                            <td>&nbsp;</td>
                            <td>　</td>
                            <td>　</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td><br>
                            </td>
                          </tr>
                          <tr>
                            <td align="center">4</td>
                            <td>&nbsp;</td>
                            <td>　</td>
                            <td>　</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td><br>
                            </td>
                          </tr>
                          <tr>
                            <td align="center">5</td>
                            <td>&nbsp;</td>
                            <td>　</td>
                            <td>　</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td><br>
                            </td>
                          </tr>
                          <tr>
                            <td align="center">6</td>
                            <td>&nbsp;</td>
                            <td>　</td>
                            <td>　</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td><br>
                            </td>
                          </tr>
                          <tr>
                            <td align="center">7</td>
                            <td>&nbsp;</td>
                            <td>　</td>
                            <td>　</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td><br>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </p>
                  </span></font></blockquote>
              <font face="ＭＳ ゴシック" size="3"> </font>
              <p dir="ltr"><font size="3"><span style="FONT-FAMILY:
                    Tahoma; FONT-SIZE: 10.5pt; mso-bidi-font-size:
                    22.0pt; mso-hansi-font-family: &#39;Times New Roman&#39;;
                    mso-fareast-font-family: &#39;ＭＳ Ｐゴシック&#39;" lang="EN-US"><font face="ＭＳ Ｐゴシック" size="3"><font face="ＭＳ ゴシック"><br>
                        （３）次のポートのビットがCN1,CN2,CN3のどこのピンに見えるのかを表にして答えなさい。<br>
                        　　後述「参考１ H8ピン配置」を参照しなさい。<br>
                        　　１）ポート5のbit0からbit3<br>
                        　　２）ポート2のbit0からbit7<br>
                        　　３）ポート1のbit0からbit7<br>
                        　　４）ポート3のbit0からbit7<br>
                        　　５）ポートAのbit0からbit7<br>
                        　　６）ポートBのbit0からbit7<br>
                        　　(mp<font size="3">4</font>ex05.txt)</font></font></span></font></p>
              <blockquote style="MARGIN-RIGHT: 0px" dir="ltr"><font size="3"><span style="FONT-FAMILY: Tahoma; FONT-SIZE:
                    10.5pt; mso-bidi-font-size: 22.0pt;
                    mso-hansi-font-family: &#39;Times New Roman&#39;;
                    mso-fareast-font-family: &#39;ＭＳ Ｐゴシック&#39;" lang="EN-US"></span></font><font size="3"><span style="FONT-FAMILY: Tahoma; FONT-SIZE:
                    10.5pt; mso-bidi-font-size: 22.0pt;
                    mso-hansi-font-family: &#39;Times New Roman&#39;;
                    mso-fareast-font-family: &#39;ＭＳ Ｐゴシック&#39;" lang="EN-US"><font face="ＭＳ Ｐゴシック" size="3"><font face="ＭＳ Ｐゴシック">
                        <p><br>
                        </p>
                      </font></font></span></font></blockquote>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <font face="ＭＳ Ｐゴシック"><font size="3"><span style="FONT-FAMILY:
          Tahoma; FONT-SIZE: 10.5pt; mso-bidi-font-size: 22.0pt;
          mso-hansi-font-family: &#39;Times New Roman&#39;;
          mso-fareast-font-family: &#39;ＭＳ Ｐゴシック&#39;" lang="EN-US"><font color="#800080" face="ＭＳ Ｐゴシック" size="3">
            <div class="MsoNormal"><br>
            </div>
          </font></span></font></font>&nbsp;
    
<p style="TEXT-ALIGN: left; mso-pagination: widow-orphan" class="MsoNormal" align="left"><strong><font color="#000080">６．　プッ
          シュスイッチ</font></strong></p>
    <font face="ＭＳ Ｐゴシック"><font size="3"><span style="FONT-FAMILY: &#39;ＭＳ
          Ｐゴシック&#39;; FONT-SIZE: 10.5pt; mso-bidi-font-size: 22.0pt;
          mso-bidi-font-family: &#39;Times New Roman&#39;;
          mso-ascii-font-family: Tahoma; mso-hansi-font-family: &#39;Times
          New Roman&#39;; mso-font-kerning: 1.0pt; mso-ansi-language: EN-US;
          mso-fareast-language: JA; mso-bidi-language: AR-SA"></span></font></font>
    
<table cellpadding="1" cellspacing="1" border="1">
      <tbody>
        <tr>
          <td><font face="ＭＳ Ｐゴシック"><font size="3"><span style="FONT-FAMILY: &#39;ＭＳ Ｐゴシック&#39;; FONT-SIZE: 10.5pt;
                  mso-bidi-font-size: 22.0pt; mso-bidi-font-family:
                  &#39;Times New Roman&#39;; mso-ascii-font-family: Tahoma;
                  mso-hansi-font-family: &#39;Times New Roman&#39;;
                  mso-font-kerning: 1.0pt; mso-ansi-language: EN-US;
                  mso-fareast-language: JA; mso-bidi-language: AR-SA"><br>
                  <img alt="H8-PUSHSWD.JPG - 14,425BYTES" src="./H8 mother board programing_files/H8-PushSWD.jpg"></span></font></font></td>
        </tr>
        <tr>
          <td>
            <p align="center"><font face="ＭＳ Ｐゴシック"><font size="3"><span style="FONT-FAMILY: &#39;ＭＳ Ｐゴシック&#39;; FONT-SIZE: 10.5pt;
                    mso-bidi-font-size: 22.0pt; mso-bidi-font-family:
                    &#39;Times New Roman&#39;; mso-ascii-font-family: Tahoma;
                    mso-hansi-font-family: &#39;Times New Roman&#39;;
                    mso-font-kerning: 1.0pt; mso-ansi-language: EN-US;
                    mso-fareast-language: JA; mso-bidi-language: AR-SA">図
                    ４　プッシュスイッチ</span></font></font></p>
            <p align="left"><font face="ＭＳ Ｐゴシック"><font size="3"><span style="FONT-FAMILY: &#39;ＭＳ Ｐゴシック&#39;; FONT-SIZE: 10.5pt;
                    mso-bidi-font-size: 22.0pt; mso-bidi-font-family:
                    &#39;Times New Roman&#39;; mso-ascii-font-family: Tahoma;
                    mso-hansi-font-family: &#39;Times New Roman&#39;;
                    mso-font-kerning: 1.0pt; mso-ansi-language: EN-US;
                    mso-fareast-language: JA; mso-bidi-language: AR-SA">プッ
                    シュスイッチはポート４の第4ビットから第7ビットにつながってい<font face="ＭＳ Ｐゴシック">る</font>。</span></font></font></p>
          </td>
        </tr>
      </tbody>
    
</table>
    <font face="ＭＳ Ｐゴシック"><font size="3"><span style="FONT-FAMILY: &#39;ＭＳ
          Ｐゴシック&#39;; FONT-SIZE: 10.5pt; mso-bidi-font-size: 22.0pt;
          mso-bidi-font-family: &#39;Times New Roman&#39;;
          mso-ascii-font-family: Tahoma; mso-hansi-font-family: &#39;Times
          New Roman&#39;; mso-font-kerning: 1.0pt; mso-ansi-language: EN-US;
          mso-fareast-language: JA; mso-bidi-language: AR-SA"></span></font></font>
    
<p align="center"><font face="ＭＳ Ｐゴシック"><font size="3"><span style="FONT-FAMILY: &#39;ＭＳ Ｐゴシック&#39;; FONT-SIZE: 10.5pt;
            mso-bidi-font-size: 22.0pt; mso-bidi-font-family: &#39;Times New
            Roman&#39;; mso-ascii-font-family: Tahoma;
            mso-hansi-font-family: &#39;Times New Roman&#39;; mso-font-kerning:
            1.0pt; mso-ansi-language: EN-US; mso-fareast-language: JA;
            mso-bidi-language: AR-SA"></span></font></font>&nbsp;</p>
    
<p><strong><font color="#000080">　 PushSWでLED駆動(「h8_3048fone</font></strong><strong><font color="#000080">.h」の利用)</font></strong></p>
    <strong></strong>
    
<blockquote>
      <p><font face="ＭＳ ゴシック"><span style="font-size: 10.5pt;">図４の
          プッシュスイッチの読み取りを行い，ＬＥＤを制御する。 <br>
          プッシュスイッチ0を押すとＬＥＤ0</span><span style="font-size: 10.5pt;">が点灯し，プッシュスイッチ1を押すとＬＥＤ1が点灯するプログラムとする。</span></font></p>
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td>
              <p align="center"><font face="ＭＳ ゴシック">pushsw.c</font></p>
            </td>
          </tr>
          <tr>
            <td><font color="#800080" face="ＭＳ ゴシック">/**********************************************************<br>
                プッシュスイッチによってLEDのON-OFFを行う<br>
**********************************************************/<br>
                #include &lt;3048fone.h&gt;<br>
                #include "h8_3048fone.h"<br>
                <br>
                main()<br>
                {<br>
                &nbsp;&nbsp;&nbsp; initLed();<br>
                &nbsp;&nbsp;&nbsp; initPushSW();/*PushSWの初期化*/<br>
                &nbsp;&nbsp;&nbsp; while(1) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                (checkPushSW(0)==1) { /*PushSWの0がONの時*/<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                turnOnLed(0);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                turnOffLed(1);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if
                (checkPushSW(1)==1) { /*PushSWの1がONの時*/<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                turnOffLed(0);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                turnOnLed(1);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                turnOffLed(0);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                turnOffLed(1);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                &nbsp;&nbsp;&nbsp; }<br>
                }</font></td>
          </tr>
        </tbody>
      </table>
    </blockquote>
    
<div>
      <table cellpadding="1" cellspacing="0" bgcolor="#ffff80" border="0">
        <tbody>
          <tr>
            <td>
              <p><font face="ＭＳ ゴシック">練習問題　pushsw.cを元にして次のプログラムを作りなさい。<br>
                  （実行の様子を検察して，その結果，気付いた事を含め，別途指定された書式で括弧の中ファイル名で提出しなさい）<br>
                  <br>
                  （１）５．３のプログラムを参考に，4つのpushSWの状態を取得してターミナル画面<br>
                  　　に表示するプログラムを作成しなさい。(mp5ex01.txt)</font></p>
              <p><font face="ＭＳ ゴシック">（２）プッシュスイッチの0のみがONの時，0.5秒周期で２つのLED
                  を同時点滅，<br>
                  　　プッシュスイッチの1のみがONの時，1秒周期で２つのLEDを交互点滅，<br>
                  　　プッシュスイッチの2のみがONの時，２秒周期で２つのLEDを交互点滅<br>
                  　　それ以外の状態ではすべて消灯<br>
                  　　(mp5ex02.txt)</font></p>
              <p><font face="ＭＳ ゴシック">（３）プッシュスイッチ０を1回押すごとに，LEDの点灯，消灯の切り替えが起こり，<br>
                  　　何回でも繰り返すことができるプログラム。<br>
                  　　正確に言うとプッシュスイッチを押したときには現在の点灯状態はまだ変化せず<br>
                  　　プッシュスイッチから指を離した瞬間に点灯状態が反転するように作りなさい。<br>
                  <br>
                  　　プッシュ　　離す　━┓　　┏━━━━┓　　┏━┓　　┏━<br>
                  　　スイッチ　　押す　　┗━━┛　　　　┗━━┛　┗━━┛　<br>
                  <br>
                  　　ＬＥＤ　　　点灯　━━━━┓　　　　　　　┏━━━━┓<br>
                  　　　　　　　　消灯　　　　　┗━━━━━━━┛　　　　┗━</font></p>
              <blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
                <p><font face="ＭＳ ゴシック">void pushreleaseSW(void)<br>
                    /*プッシュスイッチが押されるまで待って，*/<br>
                    /*その後離されるまで待つ関数　　　　　　*/<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; while (checkPushSW(0)==0);<br>
                    &nbsp;&nbsp;&nbsp; while (checkPushSW(0)==1);<br>
                    }<br>
</font></p>
<p><font face="ＭＳ ゴシック">void pushreleaseSW(void)<br>
/*プッシュスイッチが押されるまで待って，*/<br>
/*その後完全に離されるまで待つ関数　　　*/<br>
{<br>
&nbsp;&nbsp;&nbsp; int status=1;<br>
&nbsp;&nbsp;&nbsp; const int Nantichatter=5000;<br>
&nbsp;&nbsp;&nbsp; int statuscnt=0;<br>
&nbsp;&nbsp;&nbsp; while (checkPushSW(0)==0);<br>
&nbsp;&nbsp;&nbsp; while (status==1) {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (checkPushSW(0)==1) {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; statuscnt=0;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } else {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; statuscnt++;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (Nantichatter&lt;statuscnt) {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; status=0;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; }<br>
}<br>
  </font></p>

              </blockquote>
              
<p dir="ltr"><font face="ＭＳ ゴシック"><br>
                  　　注意深く100回ほどプッシュスイッチを押して動作を観察しなさい。<br>
                  　　点灯消灯の交互リズムが崩れ，不安定な動作が起こるかもしれない。「チャタリング」について調べること。<br>
　　２つのvoid pushreleaseSW(void)の性能を比較しなさい。<br>
　　(mp5ex03.txt)</font></p>

            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
<div><br>
      <strong></strong>&nbsp;</div>
    
<div><strong><font color="#000080">７．　インターバルタイマ割り込み</font></strong></div>
    
<p><font face="ＭＳ ゴシック">　通常の関数は，関数がプログラム中の他の関数から呼び出されたときに作業を行なう。これに対して，割り込み関数は何らかの割り込み要因に
      よって呼び出される関数である。<br>
      　インターバルタイマ割り込み関数は，タイマ割り込み初期設定によって設定された時間間隔で起動する割り込み関数である。<br>
      「７．１」のプログラムでは，500μs（1秒の1/1000の1/1000）のタイマ割り込み初期設定が行なわれ，CPUの割り込み許可がなされ，タイマがスタートした後，プロ
      グラムの流れは<br>
      while(1);<br>
      となり，何もしない無限ループに突入する。しかし，500ms（0.5秒）ごとにタイマ割り込み関数
      
「interrupt_cfunc()」が起動し，LEDのON-OFFが継続して行なわれる。変数tickはstatic修飾されているので，関数が呼
び出されたときに，前回呼び出しの時の値が残っている。かつ0が代入されるのははじめの1回だけである。tick=1-
      tickの演算により，tickの値は0，1を繰り返す。<br>
      ロボットの制御には一定時間ごとに起動する定時間割り込み（タイマー割り込み）が良く用いられる。またPWMの生成にもこの定時間割り込み
      が用いられる場合がある。<br>
      関数void msecwait(int msec)を用いた時間管理よりはるかに<font color="#ff0000">正確な時間管理</font>ができる。（CPUクロックの精度依存）</font></p>
    
<p><strong><font color="#000080">７．１　
          割り込みでLED駆動（インターバルタイマによるタイマ割り込み）</font></strong></p>
    
<p><font face="ＭＳ ゴシック">プログラム中main()側で10000μsec（0.01秒）間隔でタイマ割り込みを設定する。<br>
      main()関数内でなにもしないループ動作をしている最中に，割り込み関数interrupt_cfunc()は0.01秒ごとに起動
      し，<br>
割り込み関数が起動して，100回に99回は何もせず，残りの1回はLEDのON-OFFを行なう。<br>
      このタイマ割り込みはITUのch1が使われている。</font></p>
<font face="ＭＳ ゴシック">
    
</font>
<p><font face="ＭＳ ゴシック">割り込みを実現するには次のことが必要になる。<br>
      （１）割り込みベクトルの設定（割り込みが発生した時に起動すべき関数のアドレスを所定の領域に書いておく）<br>
      （２）割り込み要因となる機能の初期化<br>
      （３）CPUの割り込み許可<br>
      （４）割り込み関数は割り込み関数として定義され，レジスタの退避復帰，割り込みリターンなどの特殊な作り方が必要<br>
</font>
      <font face="ＭＳ ゴシック"><br>
      これらの必要事項は次のように記述される。<br>
      （１）アセンブラでしか書くことが出来ないのでインラインアセンブリで記述<br>
      　　（インラインアセンブリ　：　C言語プログラム中にアセンブリ言語を記述すること）<br>
</font>
      <font face="ＭＳ ゴシック"><br>
      　　タイマ割り込みの関数のアドレスは0x70に書くことになっている。（割り込みベクタテーブル領域）<br>
      　　アセンブラから見るとCの関数「TimerIntFunc」の名前は「_TimerIntFunc」に見える。<br>
      　　関数の名前は関数の先頭アドレスを意味する。</font></p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p style="MARGIN-RIGHT: 0px" dir="ltr"><font color="#800080" face="ＭＳ ゴシック">#pragma asm<br>
          &nbsp;&nbsp;&nbsp; .SECTION&nbsp;&nbsp;&nbsp; MYVEC, DATA,
          LOCATE=H'000070<br>
          &nbsp;&nbsp;&nbsp;
          .ORG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; H'000070&nbsp;
          ;IMIA1<br>
          &nbsp;&nbsp;&nbsp; .DATA.L&nbsp;&nbsp;&nbsp;&nbsp;
          _TimerIntFunc<br>
          &nbsp;&nbsp;&nbsp; .SECTION&nbsp;&nbsp;&nbsp; P,CODE,ALIGN=2
          ;これを忘れてはいけない<br>
          #pragma endasm</font></p>
    </blockquote>
    
<p style="MARGIN-RIGHT: 0px" dir="ltr">　　　　ハードウェアマニュアル<br>
      　　　　<a href="http://tnct20/~kosaka/for_students/H8/j602093_h83048.pdf"><font color="#810081">http://tnct20.tokyo-ct.ac.jp/~kosaka/for_students/H8/j602093_h83048.pdf</font></a><br>
      　　　　<font face="ＭＳ ゴシック">において，割り込みベクタテーブルについての記述は4.1.3に記述されている。<br>
      　　　　ここで用いているのは，ITUｃｈ1を使用したIMIA1という割り込み要因である。</font><br>
      <br>
      <font face="ＭＳ ゴシック">（２）main関数内で記述 （関数の定義はh8_3048fone.hにある）</font></p>
    <font color="#800080" face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp;
      initTimer1Int(10000); /*</font><font color="#800080" face="ＭＳ ゴシック"><font color="#800080" face="ＭＳ ゴシック">時間割り込み10000μsec=10msec ITUch1使用</font>*/<br>
      &nbsp;&nbsp;&nbsp; startTimer1();&nbsp; /*時間割り込みタイマスタートch1*/</font><br>
    
<p style="MARGIN-RIGHT: 0px" dir="ltr"><font face="ＭＳ ゴシック">（３）main関数内で記述</font></p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p style="MARGIN-RIGHT: 0px" dir="ltr"><font color="#800080" face="ＭＳ ゴシック">E_INT();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          /*CPU割り込み許可*/</font></p>
    </blockquote>
    
<p style="MARGIN-RIGHT: 0px" dir="ltr">　<font face="ＭＳ ゴシック">　　この関数の本体はアセンブリ言語でないと書けないので，
      スタートアップルーチンのソースの後ろに<br>
      　　　ついている。次の説明を参照のこと<br>
      　　　<a href="https://xythos.tokyo-ct.ac.jp/web/j/usr/kosaka/for_students/H8/3048/h8startup2.html">h8startup2.html</a><br>
      　　　</font><br>
      <br>
      <font face="ＭＳ ゴシック">（４）割り込み関数独特の宣言を行なう　TimerIntFuncは割り込み関数名</font></p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p style="MARGIN-RIGHT: 0px" dir="ltr"><font color="#800080" face="ＭＳ ゴシック">#pragma interrupt (TimerIntFunc)</font></p>
    </blockquote>
    
<p style="MARGIN-RIGHT: 0px" dir="ltr">　　　この宣言が行われた関数は，プログラム内から関数呼び出
      ししてはいけない。</p>
    
<blockquote>
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td align="center"><font face="ＭＳ ゴシック">int1st.c</font></td>
          </tr>
          <tr>
            <td>
              <p><font color="#800080" face="ＭＳ ゴシック">/**********************************************************<br>
時間割り込みによってLEDのON-OFFを行う<br>
**********************************************************/<br>
#include &lt;3048fone.h&gt;<br>
#include "h8_3048fone.h"<br>
<br>
main()<br>
{<br>
&nbsp;&nbsp;&nbsp; initLed();<br>
&nbsp;&nbsp;&nbsp; initTimer1Int(10000); /*時間割り込み10000μsec=10msec ITUch1使用*/<br>
&nbsp;&nbsp;&nbsp; E_INT();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*CPU割り込み許可*/<br>
&nbsp;&nbsp;&nbsp; startTimer1();&nbsp; /*時間割り込みタイマスタートch1*/<br>
&nbsp;&nbsp;&nbsp; while(1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*なにもしないループ*/<br>
}<br>
<br>
#pragma asm<br>
&nbsp;&nbsp;&nbsp; .SECTION&nbsp;&nbsp;&nbsp; MYVEC, DATA, LOCATE=H'000070<br>
&nbsp;&nbsp;&nbsp; .ORG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; H'000070&nbsp; ;IMIA1<br>
&nbsp;&nbsp;&nbsp; .DATA.L&nbsp;&nbsp;&nbsp;&nbsp; _TimerIntFunc<br>
&nbsp;&nbsp;&nbsp; .SECTION&nbsp;&nbsp;&nbsp; P,CODE,ALIGN=2 ;これを忘れてはいけない<br>
#pragma endasm<br>
<br>
#pragma interrupt (TimerIntFunc)<br>
void TimerIntFunc() /*タイマ割り込みルーチン*/<br>
{<br>
&nbsp;&nbsp;&nbsp; static int tick=0;<br>
&nbsp;&nbsp;&nbsp; static int count=0;<br>
&nbsp;&nbsp;&nbsp; clearTimer1Flag();&nbsp; /*タイマステータスフラグのクリア 忘れないこと*/<br>
&nbsp;&nbsp;&nbsp; count++;<br>
&nbsp;&nbsp;&nbsp; if (count==100) {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; count=0;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (tick==1) {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; turnOnLed(0);<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; turnOffLed(1);<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } else {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; turnOffLed(0);<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; turnOnLed(1);<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; tick=1-tick;<br>
&nbsp;&nbsp;&nbsp; }<br>
}<br>
</font><font color="#800080" face="ＭＳ ゴシック">
                  </font></p>
            </td>
          </tr>
          <tr>
            <td>
              <p><font face="ＭＳ ゴシック" size="2">ここではアセンブリ言語には踏み込まないが簡単に解説<br>
                  （深入りはしない。後にアセンブリ言語を学んだ後に読み返せばよい）<br>
                  <br>
                  #pragma asm<br>
                  　　ここの間はアセンブリ言語による記述ですという意味<br>
                  #pragma endasm<br>
                  <br>
                  .SECTION&nbsp;&nbsp;&nbsp; MYVEC, DATA,
                  LOCATE=H'000070<br>
                  　　　MYVECという名前のセクションを0ｘ70番地から始める<br>
                  <br>
                  .ORG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  H'000070&nbsp; ;IMIA1<br>
                  　　　0x70からこれ以降の内容を配置<br>
                  <br>
                  .DATA.L&nbsp;&nbsp;&nbsp;&nbsp; _TimerIntFunc<br>
                  　　　関数TimerIntFuncの先頭アドレスをここに書く<br>
                  　　　DATA.L　というのは，32ビット幅のデータの意味<br>
                  <br>
                  .SECTION&nbsp;&nbsp;&nbsp; P,CODE,ALIGN=2 ;これを忘れてはいけない<br>
                  　　　これ以降はCODEというセクションの続きになるの意味<br>
                  <br>
                  アセンブリ言語の記述スタイルについて<br>
                  プログラムの内容は行の先頭にいくつかのスペースまたはタブの後ろに書く。<br>
                  「;」以降はコメントとみなされる。</font></p>
            </td>
          </tr>
        </tbody>
      </table>
    </blockquote>
    
<p>
      <table cellpadding="1" cellspacing="1" bgcolor="#ff0000" border="1">
        <tbody>
          <tr>
            <td>
              <p align="center"><font color="#ffffff">勘どころ</font></p>
            </td>
          </tr>
          <tr>
            <td><font color="#ffffff">ITU1の割り込みベクタ（割り込み関数の先頭番地）が0ｘ70であるこ
                とは，CPUの設計者が決めたことなので，<br>
                プログラム作成者が変更することはできない。<br>
                割り込み関数の名前は，プログラム作成者が決めることができる。</font></td>
          </tr>
        </tbody>
      </table>
    </p>
    
<div>
      <table cellpadding="1" cellspacing="0" bgcolor="#ffff80" border="0">
        <tbody>
          <tr>
            <td>
              <p><font face="ＭＳ ゴシック">練習問題　int1st.cを元にして次のプログラムを作りなさい。<br>
                  （実行の様子を検察して，その結果，気付いた事を含め，別途指定された書式で括弧の中ファイル名で提出しなさい）<br>
                  <br>
                  （１）</font><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック">int1st.cは2秒周期のLED点滅であった。<br>
　　　</font>int1st.cを元にして割り込み周期を変更せずに，</font><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック">１秒周期のLED点滅を行なう</font>プログラムに変更しなさい。<br>
　　　initTimer1Int(10000);は変更しない。<br>
                  </font><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック">　　ヒント：間引き（割り込み関数が起動しても何回かに一回しかLEDを操作しない）間隔を変更する。<br>
                  </font></font><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック">　　　　initTimer1Int()関数の定義はh8_3048fone.hにある。<br>
                  　　　　initTimer1Int()，startTimer1()はμsec単位の割り込み間隔動作，最長でも約29msecのタイマ割り込みしかできない。<br>
                  </font>　　(mp6ex01.txt)<br>
                  （２）</font><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック">int1st.cにおいて</font>initTimer1Int(1000);に変更して１秒周期のLED点滅を行なうプログラムを作りなさい。<br>
                  　　（引数がマイクロ秒であること，</font><font face="ＭＳ ゴシック">引数にはshort
                  int型が用いられていることに注意）<br>
                  　　ヒント：間引き（割り込み関数が起動しても何回かに一回しかLEDを操作しないようにすればよい）<br>
                  　　　　initTimer1Int()関数の定義はh8_3048fone.hにある。<br>
                  　　　　initTimer1Int()，startTimer1()はμsec単位の割り込み間隔動作，最長でも約29msecのタイマ割り込みしかできない。<br>
                  　　(mp6ex02.txt)</font></p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
<div><br>
      <strong><font color="#000080">７．２　 割り込みでLED駆動</font></strong></div>
    
<p class="MsoNormal"><font face="ＭＳ ゴシック"><span style="color: black; font-size: 10.5pt;"><span style="font-size: 10.5pt;"><font size="3"><font size="3">割り込みを用いたPWM駆動でLEDの制御を行なう。<br>
              このプログラムではITUのch1のみを用いる。<br>
              PushSW&nbsp;0 → LED 0 明るく点灯（10/10）<br>
              PushSW&nbsp;1 → LED 0 暗く点灯（1/10）<br>
              PushSW&nbsp;2 → LED 1 明るく点灯（10/10）<br>
              PushSW&nbsp;3 → LED 1 暗く点灯（1/10）</font></font></span></span></font></p>
<font face="ＭＳ ゴシック">
    
</font>
<p class="MsoNormal"><font face="ＭＳ ゴシック"><span style="color: black; font-size: 10.5pt;"><span style="font-size: 10.5pt;"><font size="3"><font size="3">volatile修飾子は，割り込み関数と通常の関数とで同じグローバル
              変数を用いるときに使う。<br>
              
コンパイラは通常コードの最適化を行なう。例えば，変数は通常はメモリ上にある。ある変数を一度レジスタに読み込んで，その変数の値を変化させていない場
合は，次にその変数の値が必要になったときには，メモリをもう一度読みに行くようなことはせず，レジスタの値を用いる。しかし，その間に割り込み
関数がその変数の値を変化させることもある。そこでvolatile修飾子をつけた変数にしておくと必ずメモリにある変数を使うコードになる。この例の場
合は，特に必要ないが，おまじないとしてつけておくようにする。</font></font></span></span></font></p>
<font face="ＭＳ ゴシック">
    
</font>
<p class="MsoNormal"><font face="ＭＳ ゴシック"><span style="color: black; font-size: 10.5pt;"><span style="font-size: 10.5pt;"><font size="3"><font size="3">このプログラムではLEDの暗い点灯時では1/10の時間割合で点灯している。LEDの暗い点灯時に5
                  /10の時間割合で点灯するように変更しなさい。この点灯時間の割合は「デューティ比」と呼ばれる。<br>
                  <br>
                  「h8_3048fone.h」にある関数initTimer1Int()，startTimer1()はITU1
                  を使ったタイマ割り込みを可能にしている。<br>
                  ハードウェアマニュアルのITUの基本動作（TCNT（カウンタ）がカウントアップ）を見なさい。<br>
                  カウンタ（TCNT）がカウントアップしてあらかじめ設定した値（GRA）とコンペアマッチ（比較して一致）で割り
                  込みが起こり，カウンタがクリアされ，この動作が継続される。カウンタは内部クロック（25MHｚ）の1/8で動作
                  している。<br>
                  このことにより，タイマ割り込みが行われている。</font></font></span></span></font></p>
<font face="ＭＳ ゴシック">
    
</font>
<p class="MsoNormal"><span style="FONT-FAMILY: &#39;ＭＳ Ｐゴシック&#39;; COLOR:
        black; FONT-SIZE: 10.5pt; mso-bidi-font-size: 12.0pt;
        mso-bidi-font-family: &#39;Times New Roman&#39;; mso-ascii-font-family:
        Tahoma; mso-hansi-font-family: &#39;Times New Roman&#39;;
        mso-font-kerning: 1.0pt; mso-ansi-language: EN-US;
        mso-fareast-language: JA; mso-bidi-language: AR-SA"><span style="FONT-FAMILY: &#39;ＭＳ Ｐゴシック&#39;; FONT-SIZE: 10.5pt;
          mso-bidi-font-size: 22.0pt; mso-ascii-font-family: Tahoma;
          mso-hansi-font-family: &#39;Times New Roman&#39;"><font face="ＭＳ Ｐ明朝" size="3"><font size="3"><font face="ＭＳ Ｐゴシック"><font color="#ff0000" face="ＭＳ ゴシック">「１」で取り上げた関数msecwait()を使
                  う方法と割り込みを使う方法とでは，時間精度が違う。高精度な時間管理には関数msecwait()を使うべきでは
                  ない。タイマユニットが使えない場合に使用を検討するのがよい。</font><font face="ＭＳ ゴシック"><br>
                </font><br>
              </font></font></font></span></span></p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td>
              <p align="center"><font color="#800080" face="ＭＳ ゴシック">int2nd.c</font></p>
            </td>
          </tr>
          <tr>
            <td>
              <p><font color="#800080"><font color="#800080" face="ＭＳ ゴシック">
/**********************************************************<br>
プッシュスイッチと時間割り込みによってLEDのPWM制御を行う<br>
**********************************************************/<br>
#include &lt;3048fone.h&gt;<br>
#include "h8_3048fone.h"<br>
<br>
volatile int led0,led1;<br>
const int period=10; /*周期10msec*/<br>
const int low=1;<br>
<br>
main()<br>
{<br>
&nbsp;&nbsp;&nbsp; initLed();<br>
&nbsp;&nbsp;&nbsp; initPushSW();<br>
&nbsp;&nbsp;&nbsp; led0=led1=0;<br>
&nbsp;&nbsp;&nbsp; initTimer1Int(1000); /*タイマ割り込み1msec */<br>
&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 /*単位はμsec ITUch1のみ使用*/<br>
&nbsp;&nbsp;&nbsp; E_INT();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*CPU割り込み許可*/<br>
&nbsp;&nbsp;&nbsp; startTimer1();&nbsp; /*時間割り込みタイマスタート*/<br>
&nbsp;&nbsp;&nbsp; while(1){<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (checkPushSW(0)==1) { /*PushSWの0がONの時*/<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; led0=period;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } else if (checkPushSW(1)==1) { /*PushSWの1がONの時*/<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; led0=low;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } else {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; led0=0;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (checkPushSW(2)==1) { /*PushSWの2がONの時*/<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; led1=period;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } else if (checkPushSW(3)==1) { /*PushSWの3がONの時*/<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; led1=low;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } else {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; led1=0;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; }<br>
}<br>
<br>
#pragma asm<br>
&nbsp;&nbsp;&nbsp; .SECTION&nbsp;&nbsp;&nbsp; MYVEC, DATA, LOCATE=H'000070<br>
&nbsp;&nbsp;&nbsp; .ORG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; H'000070&nbsp; ;IMIA1<br>
&nbsp;&nbsp;&nbsp; .DATA.L&nbsp;&nbsp;&nbsp;&nbsp; _TimerIntFunc<br>
&nbsp;&nbsp;&nbsp; .SECTION&nbsp;&nbsp;&nbsp; P,CODE,ALIGN=2 ;これを忘れてはいけない<br>
#pragma endasm<br>
<br>
#pragma interrupt (TimerIntFunc)<br>
void TimerIntFunc() /*タイマ割り込みルーチン*/<br>
{<br>
&nbsp;&nbsp;&nbsp; static int tick=0;<br>
&nbsp;&nbsp;&nbsp; clearTimer1Flag();&nbsp; /*タイマステータスフラグのクリア 忘れないこと*/<br>
&nbsp;&nbsp;&nbsp; if (tick&lt;led0) {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; turnOnLed(0);<br>
&nbsp;&nbsp;&nbsp; } else {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; turnOffLed(0);<br>
&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; if (tick&lt;led1) {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; turnOnLed(1);<br>
&nbsp;&nbsp;&nbsp; } else {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; turnOffLed(1);<br>
&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; tick++;<br>
&nbsp;&nbsp;&nbsp; if (tick==period) tick=0;<br>
}<br>
</font></font></p>
            </td>
          </tr>
        </tbody>
      </table>
    </blockquote>
    
<p dir="ltr">
      <table cellpadding="1" cellspacing="0" bgcolor="#ffff80" border="0">
        <tbody>
          <tr>
            <td>
              <p><font face="ＭＳ ゴシック">練習問題　int2nd.cを元にして次のプログラムを作りなさい。<br>
                  （実行の様子を検察して，その結果，気付いた事を含め，別途指定された書式で括弧の中ファイル名で提出しなさい）<br>
                  <br>
                  　　PushSWはどれも押されていない　→　2つのLEDは暗く点灯（1/10）<br>
                  　　PushSW&nbsp;0 を押す&nbsp;→ LED 0 中間点灯（2/10）　　LED 1消灯<br>
                  　　PushSW&nbsp;1 を押す → LED 0 中間点灯（5/10）　　LED 1消灯<br>
                  　　PushSW 0とPushSW&nbsp;1 を押す → LED 0 明るく点灯（10/10）　　LED
                  1消灯<br>
                  　　PushSW&nbsp;2 を押す → LED 1 中間点灯（2/10）　　LED 0消灯<br>
                  　　PushSW&nbsp;3 を押す → LED 1 中間点灯（5/10）　　LED 0消灯<br>
                  　　PushSW 2とPushSW&nbsp;3 を押す → LED 1 明るく点灯（10/10）　　LED
                  0消灯<br>
                  　　それ以外の状態ではすべて消灯<br>
                  　　点灯周期は10msとする。<br>
                  <br>
                  　　unsigned char getPushSW(void)　を使うと便利<br>
                  　　　押しボタンスイッチの取得　ビット反転し，ONは1，OFFは0で取得される。<br>
                  　　　押しボタンスイッチの状況は第0-第3ビットに現れる。</font><font face="ＭＳ
                  ゴシック"><br>
                  　　(mp6ex03.txt)<br>
                </font></p>
            </td>
          </tr>
        </tbody>
      </table>
    </p>
    
<p><strong><font color="#000080"><br>
８．　パソコンとのシリアル通信</font></strong></p>
    
<p><font face="ＭＳ ゴシック">シリアル通信ユニットSCIを使って，マイコンの状態を表示するプログラムで，SCI関連の関数を使ってみよう。</font></p>
    
<blockquote>
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td>
              <p align="center"><strong><font color="#000080">sciout.c</font></strong></p>
            </td>
          </tr>
          <tr>
            <td>
              <p><font color="#000080"><font color="#800080" face="ＭＳ ゴシック">
/**********************************************************<br>
                    SCI1へ出力，WINDOWSのHyperTerminalなどで受信できる。<br>
                    ただし，設定は　38400baud, Async, 8bit , NoParity, stop1<br>
**********************************************************/<br>
                    #include &lt;3048fone.h&gt;<br>
                    #include "h8_3048fone.h"</font></font></p>
              <p><font color="#000080"><font color="#800080" face="ＭＳ ゴシック">void func1(void)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; unsigned char sw,previous;<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("Printing 8-bitSW
                    status...\n");<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("Change 8-bitSW and
                    new status will appear.\n");<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("If any key on the
                    keyboard, this test will quit.\n");<br>
                    &nbsp;&nbsp;&nbsp; previous=sw=get8BitSW();<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("8-bitSW status=
                    %2x[%08b]\n",sw,sw);<br>
                    &nbsp;&nbsp;&nbsp; do {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    sw=get8BitSW();<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (sw!=previous) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("8-bitSW status= %2x[%08b]\n",sw,sw);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    previous=sw;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; } while (SCI1_chkgetChar()&lt;0);<br>
                    }</font></font></p>
              <p><font color="#000080"><font color="#800080" face="ＭＳ ゴシック">void func2(void)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; unsigned char sw,previous;<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("Printing PushSW
                    status...\n");<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("Change PushSW and
                    new status will appear.\n");<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("If any key on the
                    keyboard, this test will quit.\n");<br>
                    &nbsp;&nbsp;&nbsp; previous=sw=getPushSW();<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("PushSW status=
                    %2x[%08b]\n",sw,sw);<br>
                    &nbsp;&nbsp;&nbsp; do {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    sw=getPushSW();<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (sw!=previous) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("PushSW status= %2x[%08b]\n",sw,sw);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    previous=sw;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; } while (SCI1_chkgetChar()&lt;0);<br>
                    }</font></font></p>
              <p><font color="#000080"><font color="#800080" face="ＭＳ ゴシック">void func3(void)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; short int x;<br>
                    &nbsp;&nbsp;&nbsp; long int y;<br>
                    &nbsp;&nbsp;&nbsp; x=SCI1_getInt("Key in a decimal
                    number &gt;&gt;&gt;");<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("The number you keyed
                    in is %d %x\n",x,x);<br>
                    &nbsp;&nbsp;&nbsp; x=SCI1_getInt("Key in a
                    hexdecimal number (ex. 0x23ff) &gt;&gt;&gt;");<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("The number you keyed
                    in is %d %x\n",x,x);<br>
                    &nbsp;&nbsp;&nbsp; y=SCI1_getInt4("Key in a decimal
                    big number (ex. 12345678)&gt;&gt;&gt;");<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("The number you keyed
                    in is %ld %lx\n",y,y);<br>
                    &nbsp;&nbsp;&nbsp; y=SCI1_getInt4("Key in a
                    hexdecimal big number (ex. 0x23ff0000)
                    &gt;&gt;&gt;");<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("The number you keyed
                    in is %ld %lx\n",y,y);<br>
                    }</font></font></p>
              <p><font color="#000080"><font color="#800080" face="ＭＳ ゴシック">main()<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; int menu;<br>
                    &nbsp;&nbsp;&nbsp; initSCI1(); /*SCI-ch1の初期化*/<br>
                    &nbsp;&nbsp;&nbsp; initPushSW(); /*押しボタンスイッチの初期化*/<br>
                    &nbsp;&nbsp;&nbsp; init8BitSW(); /*8ビットスイッチの初期化*/<br>
                    &nbsp;&nbsp;&nbsp; SCI1_printf("Hello. How are
                    you?\n");<br>
                    &nbsp;&nbsp;&nbsp; while (1) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("***************menu**********\n");<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("1:&nbsp;&nbsp; get 8-bit SW and print
                    \n");<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("2:&nbsp;&nbsp; get Push SW and print
                    \n");<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("3:&nbsp;&nbsp; get integer from SCI1
                    and print \n");<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; do {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    menu=SCI1_getChar(); /*menuには'1','2','3'が入るはず*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } while
                    (menu&lt;'1'||'3'&lt;menu);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("\n");<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch
                    (menu) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case '1':<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    func1();<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    break;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case '2':<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    func2();<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    break;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case '3':<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    func3();<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    break;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default:<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    break;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</font></font></p>
            </td>
          </tr>
        </tbody>
      </table>
      <p>特別な関数の説明 これらの関数はh8_3048fone.h中に定義されている。<br>
        <font face="ＭＳ ゴシック"><strong>short int SCI1_getChar()<br>
          </strong>&nbsp;SCI-ch1から1byte入力コードを得て関数の値として返す関数。通信エラーがあると-2が戻
          る。<br>
          &nbsp;SIC-ch1入力バッファを検査し，データがあれば持ち帰るが，データがない場合はデータが来るまで待ち続け，<br>
          &nbsp;データが来たら，それを持ち帰ってくる<br>
          &nbsp;PCのキーボードが押され，SCI-ch1経由で<font color="#ff0000">データが転送されてくる
            まで，永久に待つ</font>関数である。<br>
          &nbsp;ANSIの関数getchar()と同じ動作をする</font></p>
      <p><font face="ＭＳ ゴシック"><strong>short int SCI1_chkgetChar()</strong><br>
          &nbsp;SCI-ch1入力バッファを検査し，受信データがあれば1byte入力コードを得て関数の値として返す関数。<br>
          &nbsp;受信データガなければ-1が，通信エラーがあると-2が戻る。<br>
          &nbsp;SICバッファを検査し，データがあれば持ち帰るが，<font color="#ff0000">データがなくても
            -1をもってすぐに帰ってくる</font>関数である。</font></p>
      <p><font face="ＭＳ ゴシック"><strong>int get8BitSW()<br>
          </strong>&nbsp;8bitスイッチの状態をそのまま1バイトの値として読み込む関数。状態（00～ff）を関数の値として返す。<br>
          &nbsp;ただし，値は反転しており，スイッチの状態がONのビットは1，OFFのビットは0で読み込む。<br>
<br>
<b>int getPushSW()</b><br>
&nbsp;プッシュスイッチの状態をそのまま1バイトの値として読み込む関数。4つのプッシュスイッチは<br>
&nbsp;1バイト中で下位4ビットとして取り込まれ，状態（00～0f）を関数の値として返す。<br>
&nbsp;ただし，値は反転しており，スイッチの状態がONのビットは1，OFFのビットは0で読み込む。<br>
</font></p>
      <p><font face="ＭＳ ゴシック"><strong>short int SCI1_getInt(char
            prompt[])<br>
          </strong>SCI-ch1からプロンプト付で，short intの値を受け取り，関数の値として返す。<br>
          　（引数で与えた文字列を表示してから，short intの値を受け取る。）<br>
          正負の10進数または16進数を受け付ける。「0x」で始めまる文字列は16進数として受け取る。<br>
        </font></p>
      <font face="ＭＳ ゴシック"> </font>
      <p><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック"><strong>long int
              SCI1_getInt4(char prompt[])<br>
            </strong>&nbsp;SCI-ch1からプロンプト付で，long intの値を受け取り，関数の値として返す。<br>
            　（引数で与えた文字列を表示してから，long intの値を受け取る。）<br>
            &nbsp;正負の10進数または16進数を受け付ける。「0x」で始めまる文字列は16進数として受け取る。</font></font><font face="ＭＳ ゴシック"><br>
        </font></p>
    </blockquote>
    
<blockquote>
      <p><strong><font color="#000080">&nbsp;</font></strong>●TeraTermの画面への表示をそのままファイル化する方法(テキストキャプチャ）<br>
　　TeraTermのファイルメニューから「ログ」コマンドで，ファイル名を指定すると，その後では<br>
　　TeraTermの画面への表示がそのままファイルに書きだされる。レポート作成に便利！<br>
</p>
      <p><font face="ＭＳ ゴシック">SCI通信の時PC側の「Enterキー」入力では，テンキー部ではなく，文字キーの右側
          にある大きなenter-keyを使うこと。</font></p>
      <blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
        <p><font size="2"><font face="ＭＳ ゴシック">enter-keyについて<br>
              キーボードには２つのenter-keyがあるが，実は文字コードが異なる。<br>
              　　　文字キーの右側にある大きなenter-key　　　\r\n （0x0d,0x0a）<br>
              　　　数字キーの右側にある小さなenter-key　　　\r (0x0d)<br>
              である。<br>
              \r(0x0d) はコンソール上で文字ポインタを左端に戻すコード</font><br>
            <font face="ＭＳ ゴシック">\n(0x0a) はコンソール上で文字ポインタを次の行に進めるコード<br>
</font></font></p></blockquote></blockquote>
<p><font size="2"><font face="ＭＳ ゴシック"><br>

      
    
    
    </font></font></p>
<table cellpadding="1" cellspacing="0" bgcolor="#ffff80" border="0">

      <tbody>
        <tr>
          <td>
            <p><font color="#000080"><strong>練習課題<br>
                </strong><font color="#000000"><font face="ＭＳ ゴシック">（実行の
                    様子を検察して，その結果，気付いた事を含め，別途指定された書式で括弧の中ファイル名で提出しなさい）</font><br>
                </font></font><font color="#000080"><br>
                <font face="ＭＳ ゴシック">（１）sciout.cを実行してキーボードから1を入力したところ次のような画面になった。<br>
止まっているように見えるが，マイコンの内部ではプログラムが動作している。<br>
どうして止まっているようにみえるのか説明しなさい。<br>
(mp7ex01.txt)<br>
</font></font></p>
  <table cellpadding="2" cellspacing="2" bgcolor="#3333ff" border="1" width="500">
    <tbody>
      <tr>
        <td valign="top"><font face="ＭＳ ゴシック"><font color="#ffffff">Hello. How are you?<br>
***************menu**********<br>
1:&nbsp;&nbsp; get 8-bit SW and print<br>
2:&nbsp;&nbsp; get Push SW and print<br>
3:&nbsp;&nbsp; get integer from SCI1 and print<br>
1<br>
Printing 8-bitSW status...<br>
Change 8-bitSW and new status will appear.<br>
If any key on the keyboard, this test will quit.<br>
8-bitSW status=&nbsp; 0[00000000]<br>
              <br>
              <br>
              <br>
            </font><br>
          </font><br>
        </td>
      </tr>
    </tbody>
  </table>
</td>
        </tr>
      </tbody>
    
</table>

    <br>

    <font color="#000080"><strong></strong></font><br>
<blockquote>
  <blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      </blockquote>

    </blockquote>

    
<table cellpadding="1" cellspacing="0" bgcolor="#ffff80" border="0">
      <tbody>
        <tr>
          <td>
            
<p><font color="#000080"><strong>練習問題　次のプログラムを作りなさい。<br>
                </strong><font color="#000000"><font face="ＭＳ ゴシック">（実行の
                    様子を検察して，その結果，気付いた事を含め，別途指定された書式で括弧の中ファイル名で提出しなさい）</font><br>
                </font></font><font color="#000080"><br>
                <font face="ＭＳ ゴシック">（１）マイコンのプログラム実行開始後，４つのプッシュスイッチがそれぞれ
                  何回押されたかを<br>
                  　　表示するプログラムを作成しなさい。<br>
                  　　このプログラムは電源がOFFされるまでカウントを続け，絶えず最新のカウントを表示し続<br>
                  　　けるものとする。<br>
　　通信して文字を表示するのはマイコンにとっては遅い作業である。（1msec間に3文字しか送れない）<br>
　　そこで，SCI1_printはmainがわで行い，スイッチの状態観測は1/1000秒間隔の割り込み関数内で<br>
　　行うものとする。カウント値はグローバル変数に格納すると良い。<font color="#000000"><br>
　　(mp7ex02.txt)<br>
</font></font></font></p>
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
              <p><font color="#000080">参考　SW0のみを数えるプログラム（チャタリング対策有り）　要点のみ
<input type="button" value="表示" onclick="document.getElementById(&#39;mp7ex02&#39;).style.display=&#39;block&#39;">
<input type="button" value="隠す" onclick="document.getElementById(&#39;mp7ex02&#39;).style.display=&#39;none&#39;"><br>
</font></p><div id="mp7ex02" style="display:none"><font color="#000080">
                  <tt><font face="MS PGothic"><font face="ＭＳ ゴシック"><small>--------------------------------<br>
volatile int P0count=0; /*P0のカウンタ*/<br>
volatile int request=0; /*割り込みルーチンからの表示要求*/<br>
    <br>
main()の主要部分（割り込み<tt><font face="ＭＳ ゴシック">周期</font></tt>は1<tt><font face="ＭＳ ゴシック">msecに設定しておく</font></tt>）<br>&nbsp;&nbsp;&nbsp; while (1) {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if(request){<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SCI1_printf("SW0-&gt;[%3d]\n",P0count);<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; request=0;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; }<br>
<br>
void TimerIntFunc() /*タイマ割り込みルーチン*/<br>
{<br>
&nbsp;&nbsp;&nbsp; int sw;<br>
&nbsp;&nbsp;&nbsp; static int status=0; /*SW0の状態 0:押されていない 1:押されている*/<br>
&nbsp;&nbsp;&nbsp; /*<br>
&nbsp;&nbsp;&nbsp; statusは1になりやすく，0になりにくいようにする。（ヒステリシス）<br>
&nbsp;&nbsp;&nbsp; こうすることでチャタリング対策になる。<br>
&nbsp;&nbsp;&nbsp; スイッチが押されたら直ちに1にする<br>
&nbsp;&nbsp;&nbsp; スイッチが離された状態が10回（10mse<tt><font face="ＭＳ ゴシック">cになる</font></tt>）続いたら0にする<br>
&nbsp;&nbsp;&nbsp; */<br>
&nbsp;&nbsp;&nbsp; const int Nantichatter=10;<br>
&nbsp;&nbsp;&nbsp; static int statuscnt=0;&nbsp; /*スイッチが離された状態<tt><font face="ＭＳ ゴシック">を数える変数</font></tt>*/<br>
&nbsp;&nbsp;&nbsp; clearTimer1Flag();&nbsp; /*タイマステータスフラグのクリア 忘れないこと*/<br>
&nbsp;&nbsp;&nbsp; sw=getPushSW();<br>
&nbsp;&nbsp;&nbsp; if (status==0) {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if ((sw&amp;1)==1) {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; status=1;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; P0count++;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; request=1;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; } else { /*status==1*/<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if ((sw&amp;1)==1) {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; statuscnt=0;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } else {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; statuscnt++;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (Nantichatter&lt;statuscnt) {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; status=0;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; }<br>
}<br>
  </small><br>
</font></font></tt>
</font></div><p></p>
            </blockquote>

            
<p><font color="#000080"><font face="ＭＳ ゴシック">（２）アドレス0x00000から0x0001FFまでのメモリを十六進ダンプするプログラムを作りなさい。<br>
                  　　ヒント　long
                  int型変数ptrに0x1200が入っている時，アドレス0x1200の内容を表示するには<br>
                  　　次のように書くと良い。<br>
                  　　SCI1_printf(" %02x",*(unsigned char *)ptr);<br>
                  &nbsp;&nbsp;&nbsp;
                  また，メモリ空間は0から0xfffffまであるのでアドレスは16進表現で5ケタ必要となる。<br>
                </font></font><font color="#000080"><font face="ＭＳ ゴシック">　
                  　アドレスを表わす変数はunsigned long int型を使う。 表示のときの書式は%ld(%lx)になることに注意。<br>
&nbsp;&nbsp;&nbsp;&nbsp; 以下の実行例と同じ実行結果が得られたら正解。<br>
　　提出ファイルには実行結果を貼り付けること。 <a href="https://xythos.tokyo-ct.ac.jp/web/j/usr/kosaka/for_students/H8/H8-MB-Pro/memory.html">メモリについての補足</a><br>
                </font><font color="#000000" face="ＭＳ ゴシック">　　
                  (mp7ex03.txt)</font></font></p>


            <blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
              <p><font color="#000080">実行例<br>
                  <tt><font face="MS PGothic"><font face="ＭＳ ゴシック">memory
                        dump 0x00000-0x001ff<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +0 +1 +2 +3 +4 +5
                        +6 +7 +8 +9 +A +B +C +D +E +F<br>
                        00000 00 00 01 00 ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        00010 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        00020 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        00030 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        00040 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        00050 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        00060 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        00070 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        00080 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        00090 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        000a0 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        000b0 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        000c0 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        000d0 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        000e0 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        000f0 ff ff ff ff ff ff ff ff ff ff ff ff ff ff
                        ff ff<br>
                        00100 7a 07 00 0f ff 10 01 00 6b 20 00 00 0e 20
                        01 00<br>
                        00110 6b 21 00 00 0e 24 01 00 6b 22 00 00 0e 28
                        01 f0<br>
                        00120 64 22 5a 00 01 2e 6c 03 68 93 0b 71 1b 72
                        46 f6<br>
                        00130 01 00 6b 21 00 00 0e 2c 01 00 6b 22 00 00
                        0e 30<br>
                        00140 f3 00 01 f0 64 22 5a 00 01 50 68 93 0b 71
                        1b 72<br>
                        00150 46 f8 5e 00 0c f4 40 fe 06 7f 54 70 04 80
                        54 70<br>
                        00160 18 88 38 ba 38 b8 f8 13 38 b9 19 00 0b 50
                        79 20<br>
                        00170 03 e8 4d f8 f8 30 38 ba 54 70 29 bc 17 51
                        0d 10<br>
                        00180 79 60 00 38 47 16 7f bc 72 60 7f bc 72 50
                        7f bc<br>
                        00190 72 40 7f bc 72 30 79 00 ff fe 54 70 73 69
                        47 da<br>
                        001a0 7f bc 72 60 29 bd 17 51 0d 10 54 70 29 bc
                        17 51<br>
                        001b0 0d 10 79 60 00 38 47 16 7f bc 72 60 7f bc
                        72 50<br>
                        001c0 7f bc 72 40 7f bc 72 30 79 00 ff fe 54 70
                        73 69<br>
                        001d0 47 0c 29 bd 17 51 7f bc 72 60 0d 10 54 70
                        79 00<br>
                        001e0 ff ff 54 70 5e 00 0d e2 0f 86 0d 1d 19 55
                        1b 5d<br>
                        001f0 0d d4 40 26 55 84 0d 0d 68 e8 a8 0d 47 20
                        0d dd</font></font></tt></font></p>
            </blockquote>
            <p><font color="#000080"><font face="ＭＳ ゴシック">（３）指定したアドレスから
                  0x100byteをメモリダンプするプログラムを作りなさい。<br>
                  　　ただし指定アドレスは十六進の１の位は0とする。<br>
                  　　アドレスを表わす変数はunsigned long int型にし，キーボードからの先頭アド<br>
                  　　レスの入力は<br>
                  　　long int SCI1_getInt4(char prompt[])<br>
                  　　を使う。<br>
                  　　表示は，何回でも続けるものとする。</font></font><br>
<font color="#000080"><font face="ＭＳ ゴシック"><font color="#000080"><font face="ＭＳ ゴシック">　　提出ファイルには実行結果を貼り付けること。<br>
</font></font>
                </font><font color="#000000"><font face="ＭＳ ゴシック">　　
                    (mp7ex04.txt)</font></font></font></p>
            <blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
              <p><font color="#000080">実行例<br>
                  <tt>start address (0xnnnnnn) =0x400<br>
                    memory dump 0x00400-0x004ff<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +0 +1 +2 +3 +4 +5 +6
                    +7 +8 +9 +A +B +C +D +E +F<br>
                    00400 00 10 0f 86 5e 00 02 46 79 01 00 10 0f f0 5e
                    00<br>
                    00410 01 e4 0f f0 5e 00 03 28 7a 17 00 00 00 10 01
                    00<br>
                    00420 6d 76 54 70 01 00 6d f6 7a 37 00 00 00 10 0f
                    86<br>
                    00430 55 38 79 01 00 10 0f f0 5e 00 02 e2 0f f0 5e
                    00<br>
                    00440 03 28 7a 17 00 00 00 10 01 00 6d 76 54 70 6d
                    f6<br>
                    00450 0c 86 a6 0a 46 04 f8 0d 55 f4 28 b4 73 78 47
                    fa<br>
                    00460 36 b3 7f b4 72 70 6d 76 54 70 01 00 6d f6 0f
                    86<br>
                    00470 40 06 68 68 55 d8 0b 76 68 68 46 f6 01 00 6d
                    76<br>
                    00480 54 70 19 11 40 0a 79 08 10 68 1b 58 46 fc 0b
                    51<br>
                    00490 1d 01 45 f2 54 70 19 11 40 0a 79 08 00 04 1b
                    58<br>
                    004a0 46 fc 0b 51 1d 01 45 f2 54 70 0c 80 28 c6 e8
                    f0<br>
                    004b0 14 08 38 c6 7f c6 70 50 79 00 00 05 55 d8 7f
                    c6<br>
                    004c0 72 50 79 00 00 28 40 ce 6d f6 0c 8e 11 88 11
                    88<br>
                    004d0 11 88 11 88 e8 0f 55 d2 ee 0f 0c e8 55 cc 6d
                    76<br>
                    004e0 54 70 6d f6 0c 8e 7f c6 70 40 11 88 11 88 11
                    88<br>
                    004f0 11 88 e8 0f 55 b4 ee 0f 0c e8 55 ae 7f c6 72
                    40<br>
                    start address (0xnnnnnn) =0xffe00<br>
                    memory dump 0xffe00-0xffeff<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +0 +1 +2 +3 +4 +5 +6
                    +7 +8 +9 +A +B +C +D +E +F<br>
                    ffe00 df ff ff ff fb ff bb ff ff bf ff ef ff ff ff
                    ff<br>
                    ffe10 ff ff cf ef ff f7 fd ff ff f8 fd ff ff d7 be
                    fb<br>
                    ffe20 fb bb ff ff ff ff ff ff dd 7f ff ff ff ff ff
                    ff<br>
                    ffe30 fd bb ff bf fb f7 ff ff fd fd df fb ff ff 7f
                    ff<br>
                    ffe40 ff ff ff fe ff ff ff 7f cf ff ff ff ff e7 ff
                    ff<br>
                    ffe50 ff ff ff ff df ff df ef ff ae ff fb ff fb f7
                    fa<br>
                    ffe60 ff ff ff fa ff fd df ff ff ff ff ff ff fd ff
                    ff<br>
                    ffe70 ff fd ff ff fe fb ff 27 ff ff ff f8 7b 7f ff
                    ff<br>
                    ffe80 ff ff ff ff ff ef fd 7e ff ff fe bc 0a 0c fe
                    c0<br>
                    ffe90 00 c2 00 00 02 52 00 0f ff 0c 00 00 0a b4 00
                    0f<br>
                    ffea0 fe c1 ff df ff fd ff ff fe fd db df ff ff f7
                    ff<br>
                    ffeb0 ff fb fb ff 5e ff ff ff 66 66 65 66 66 66 65
                    62<br>
                    ffec0 30 33 33 00 00 0f ff 0a 00 0f fe c3 00 00 0f
                    0d<br>
                    ffed0 00 00 00 00 02 46 00 2b 00 10 00 00 02 2a 00
                    00<br>
                    ffee0 00 ee 00 00 00 00 00 00 0f 02 00 0f ff 00 00
                    0f<br>
                    ffef0 00 00 00 00 00 04 00 00 0b 6a 00 0f ff 0a 00
                    0f<br>
                    start address (0xnnnnnn) =0xfff00<br>
                    memory dump 0xfff00-0xfffff<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; +0 +1 +2 +3 +4 +5 +6
                    +7 +8 +9 +A +B +C +D +E +F<br>
                    fff00 00 00 00 00 0d 7a 00 00 0f 08 00 00 00 00 01
                    56<br>
                    fff10 ff ff ff ff ff ff ff ff ff ff ff ff 7f 00 00
                    00<br>
                    fff20 ff ff ff ff 21 ff ff 00 ff ff ff ff 77 ff ff
                    00<br>
                    fff30 ff ff ff ff ef ff ff 00 ff ff ff ff fb ff ff
                    00<br>
                    fff40 00 00 00 00 00 00 ff f0 00 ff ff 00 00 00 00
                    00<br>
                    fff50 ff 00 ff ff ff ff ff ff ff ff ff ff fe fc 40
                    0f<br>
                    fff60 e0 e0 80 c0 80 88 f8 f8 00 00 ff ff ff ff 80
                    88<br>
                    fff70 f8 f8 00 00 ff ff ff ff 80 88 f8 f8 00 00 ff
                    ff<br>
                    fff80 ff ff 80 88 f8 f8 00 00 ff ff ff ff ff ff ff
                    ff<br>
                    fff90 ff ff 80 88 f8 f8 00 00 ff ff ff ff ff ff ff
                    ff<br>
                    fffa0 f0 ff 00 00 00 00 ff ff 18 00 ff 3f 02 07 00
                    ff<br>
                    fffb0 00 ff 00 ff 84 00 f2 fb 00 13 30 30 40 0a f2
                    fc<br>
                    fffc0 ff ff ff ff ff ff ff ff ff ff f0 fb ff ff ff
                    ff<br>
                    fffd0 ff ff ff ff ff ff ff ff 00 ff 00 f0 00 00 1f
                    1f<br>
                    fffe0 00 00 00 00 00 00 00 00 00 7e ff ff ff ff f3
                    ff<br>
                    ffff0 ff c7 0b fe 00 00 0f ff 00 00 ff ff ff ff ff
                    ff<br>
                    start address (0xnnnnnn) =</tt></font></p>
            </blockquote>
          </td>
        </tr>
      </tbody>
    
</table>
    <br>
    <font color="#000080"><strong><font color="#000080"><br>
９．　「パソコンとのシリアル通信」，「タイマー割り込み」を用いた時計</font></strong></font>
    
<p>「パソコンとのシリアル通信」，「タイマー割り込み」を用いた時計を作る。</p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p>
        <table cellpadding="1" cellspacing="1" border="1">
          <tbody>
            <tr>
              <td>
                <p align="center">timer.c</p>
              </td>
            </tr>
            <tr>
              <td>
                <p><font color="#800080" face="ＭＳ ゴシック">/**********************************************************<br>
                    割り込みを用いた時計　起動時からの経過時間［秒］を<br>
                    SCI1へ出力，WINDOWSのHyperTerminalなどで受信できる。<br>
                    ただし，設定は<br>
                    38400baud, Async, 8bit , NoParity, stop1<br>
**********************************************************/<br>
                    #include &lt;3048fone.h&gt;<br>
                    #include "h8_3048fone.h"</font></p>
                <p><font color="#800080" face="ＭＳ ゴシック">volatile
                    unsigned int counter;/*0.1s単位でカウント*/</font></p>
                <p><font color="#800080" face="ＭＳ ゴシック">main()<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; unsigned int counter1;<br>
                    &nbsp;&nbsp;&nbsp; unsigned int t1,t2;<br>
                    &nbsp;&nbsp;&nbsp; initSCI1(); /*SCI-ch1の初期化*/<br>
                    &nbsp;&nbsp;&nbsp; initTimer1Int(10000);
                    /*ITUch1のインターバルタイマ初期化設定*/<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;









                    /*単位μsなので，時間割り込み10msec*/<br>
                    &nbsp;&nbsp;&nbsp;
                    E_INT();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    /*CPU割り込み許可*/<br>
                    &nbsp;&nbsp;&nbsp; startTimer1();&nbsp;
                    /*ITUch1タイマスタート*/<br>
                    &nbsp;&nbsp;&nbsp; counter=0;<br>
                    &nbsp;&nbsp;&nbsp; while(1) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    counter1=counter;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    t1=counter1/10;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    t2=counter1%10;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_printf("%10u.%1u\r",t1,t2); <br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</font></p>
                <font color="#800080" face="ＭＳ ゴシック">
                  <p>#pragma asm<br>
                    &nbsp;&nbsp;&nbsp; .SECTION&nbsp;&nbsp;&nbsp; MYVEC,
                    DATA, LOCATE=H'000070<br>
                    &nbsp;&nbsp;&nbsp;
                    .ORG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    H'000070&nbsp; ;IMIA1<br>
                    &nbsp;&nbsp;&nbsp; .DATA.L&nbsp;&nbsp;&nbsp;&nbsp;
                    _TimerIntFunc<br>
                    &nbsp;&nbsp;&nbsp; .SECTION&nbsp;&nbsp;&nbsp;
                    P,CODE,ALIGN=2 ;これを忘れてはいけない<br>
                    #pragma endasm</p>
                </font>
                <p><font color="#800080" face="ＭＳ ゴシック">#pragma
                    interrupt (TimerIntFunc)<br>
                    void TimerIntFunc() /*インターバルタイマ割り込みルーチン*/<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; static int cnt=0;<br>
                    &nbsp;&nbsp;&nbsp; if (++cnt==10) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    /*この割り込みルーチンは0.01秒ごとに起動するので /<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /
                    10回に1回の割合でcounter++をすれは，counterは&nbsp; /<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /
                    0.1秒にごとに1ずつ増えることにな
                    る&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    */<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    counter++;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cnt=0;<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; clearTimer1Flag();&nbsp;
                    /*ITUch1タイマフラグのクリア 忘れないこと*/<br>
                    }</font></p>
              </td>
            </tr>
          </tbody>
        </table>
      </p>
    </blockquote>
    
<table cellpadding="1" cellspacing="0" bgcolor="#ffff80" border="0">
      <tbody>
        <tr>
          <td>
            
<p><font face="ＭＳ ゴシック">練習問題　int2nd.c，sciout.c，timer.cを元にして次
                のプログラムを作りなさい。<br>
                （実行の様子を検察して，その結果，気付いた事を含め，別途指定された書式で括弧の<br>
                　中ファイル名で提出しなさい）<br>
                <br>
                （１）1msec（1000μsec）ごとの割り込みを用いて，ストップウォッチを作成せよ。<br>
                　　スタート・ストップボタンなどはキーボードのキーに割り当てる。<br>
                　　また割り込み関数内で表示を行なってはいけない。グローバル変数のカウンタ変数を<br>
                　　用いればよいだろう。<br>
                　　キーの割り当て<br>
                　　A：スタート（再開，ストップしても再開できる）　B：ストップ　C：クリア<br>
                　　SCI1_getChar()ではなくSCI1_chkgetChar()の使用を考えなさい。<br>
&nbsp;&nbsp;&nbsp; <a href="https://xythos.tokyo-ct.ac.jp/web/j/usr/kosaka/for_students/H8/H8-MB-Pro/stopwatchi.html">ヒント</a><br>
　　どうして割り込み関数内で表示していけないか考えなさい。<br>
                　　H8CPUからPCへのデータ転送は38400bit/secである。1バイト送信するのに１０ビット<br>
                　　の転送が必要である。<br>
                　　割り込み関数は，次の割り込み要求が生ずる前に作業を終了しなければならない。<br>
                　　1msecごとの割り込みなら，割り込み関数内で文字をH8からPCへ転送するとしたら，<br>
                　　何文字程度送信できるか考えなさい。<br>
                　　(mp8ex01.txt)<br>
                <br>
              </font></p>
            <p><font face="ＭＳ ゴシック">（２）シリアル通信速度は"h8_3048fone.hの中の関数
                initSCI1で設定されている。<br>
                　　この関数の中では通信速度が38400bit/secになるよう設定されている。<br>
                　　（テラタームも38400bit/secに設定されているので通信ができている。）<br>
                　　この部分を自分のファイルに取り込み，19200bit/secの通信速度にした例を示す。<br>
                &nbsp;&nbsp; 　</font><a href="https://xythos.tokyo-ct.ac.jp/web/j/usr/kosaka/for_students/H8/H8-MB-Pro/scioutbaudrate.html"><font face="ＭＳ ゴシック">sciout通信速度設定<br>
                </font></a><font face="ＭＳ ゴシック">　　このプログラムを改造し通信速度を
                1200bit/secに設定し，通信を検証しなさい。<br>
                　　ハードウェアマニュアルを読まないとできません。<br>
                　　（mp8ex02.txt)<br>
                　　「テラターム」側の通信速度を設定するには<br>
                　　　「設定」メニューから「シリアルポート...」を選び，ダイアログを開く<br>
                　　　「ボー・レート」項目の値を変更する<br>
                　　　「OK」でもどる。　</font></p></td></tr></tbody></table><br>
<p><strong><font color="#004080">１０．独立した複数の作業の書き方</font></strong><br>
      リアルタイムOSを使うと，もっと別な書き方になるが，ここではリアルタイムOSを使わない方法でプログラミングする</p>
    
<p>例題</p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p><font face="ＭＳ ゴシック">プッシュスイッチ0を押しした瞬間から２秒間LED0が点灯し、消灯する。<br>
        プッシュスイッチ1を押しした瞬間から２秒間LED1が点灯し、消灯する。<br>
        ただし、LED0が点灯中にプッシュスイッチ0が押されたら、残り点灯時間には無関係に、その時点から新たに２秒間点灯するものとする。<br>
        同様に、LED1が点灯中にプッシュスイッチ1が押されたら、残り点灯時間には無関係に、その時点から新たに２秒間点灯するものとする。<br>
        また、LED0が点灯中にプッシュスイッチ1が押されたら、LED0の動作には影響を与えず、LED1は、その時点から２秒間点灯するも
        のとする。<br>
        同様に、LED1が点灯中にプッシュスイッチ0が押されたら、LED1の動作には影響を与えず、LED2は、その時点から２秒間点灯する
        ものとする。<br>
        このような２つの動作を独立動作と呼ぶ。</font><br>
      </p>
      <p>
        <table cellpadding="1" cellspacing="1" border="1">
          <tbody>
            <tr>
              <td>
                <p align="center"><font face="ＭＳ ゴシック">独立した2つの作業を行う<br>
                    失敗作（プログラムはわかりやすいが失敗する）</font></p>
                <p align="left"><font face="ＭＳ ゴシック">LED0が動作中に，LED1の動作をさ
                    せようと思っても動作を開始しない。<br>
                    LED0の動作が終了すれば，LED1の動作を開始できる。</font></p>
              </td>
            </tr>
            <tr>
              <td>
                <p><font face="ＭＳ ゴシック">/**********************************************************<br>
                    PushSW1でLED0をPushSW2でLED0を1秒間点灯させる<br>
                    この２つの作業は独立に行われるはず？？<br>
**********************************************************/<br>
                    #include &lt;3048fone.h&gt;<br>
                    #include "h8_3048fone.h"<br>
                  </font></p>
                <p><font face="ＭＳ ゴシック">volatile int
                    count1=-1;/*LED0用カウンタ　-1の時は休止中*/<br>
                    volatile int count2=-1;/*LED1用カウンタ　-1の時は休止中*/<br>
                    main()<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; initLed();<br>
                    &nbsp;&nbsp;&nbsp; initPushSW();/*PushSWの初期化*/<br>
                    &nbsp;&nbsp;&nbsp; initTimer1Int(10000);
                    /*時間割り込み10000μsec=10msec ch1使用*/<br>
                    &nbsp;&nbsp;&nbsp;
                    E_INT();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    /*CPU割り込み許可*/<br>
                    &nbsp;&nbsp;&nbsp; startTimer1();&nbsp;
                    /*時間割り込みタイマスタートch1*/<br>
                    &nbsp;&nbsp;&nbsp; while(1) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (count1==-1 &amp;&amp; checkPushSW(0)==1) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    count1=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    turnOnLed(0);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    while (count1&lt;200); /*200カウントで2秒経過*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    count1=-1;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    turnOffLed(0);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (count2==-1 &amp;&amp; checkPushSW(1)==1) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    count2=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    turnOnLed(1);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    while (count2&lt;200); /*200カウントで2秒経過*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    count2=-1;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    turnOffLed(1);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</font></p>
                <p><font face="ＭＳ ゴシック">#pragma asm<br>
                    &nbsp;&nbsp;&nbsp; .SECTION&nbsp;&nbsp;&nbsp; MYVEC,
                    DATA, LOCATE=H'000070<br>
                    &nbsp;&nbsp;&nbsp;
                    .ORG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    H'000070&nbsp; ;IMIA1<br>
                    &nbsp;&nbsp;&nbsp; .DATA.L&nbsp;&nbsp;&nbsp;&nbsp;
                    _TimerIntFunc<br>
                    &nbsp;&nbsp;&nbsp; .SECTION&nbsp;&nbsp;&nbsp;
                    P,CODE,ALIGN=2 ;これを忘れてはいけない<br>
                    #pragma endasm</font></p>
                <p><font face="ＭＳ ゴシック">#pragma interrupt (TimerIntFunc)<br>
                    void TimerIntFunc() /*タイマ割り込みルーチン*/<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; static int tick=0;<br>
                    &nbsp;&nbsp;&nbsp; clearTimer1Flag();&nbsp;
                    /*タイマステータスフラグのクリア 忘れないこと*/<br>
                    &nbsp;&nbsp;&nbsp; if (count1!=-1) count1++;<br>
                    &nbsp;&nbsp;&nbsp; if (count2!=-1) count2++;<br>
                    }</font></p>
              </td>
            </tr>
          </tbody>
        </table>
      </p>
      <p>
        <table cellpadding="1" cellspacing="1" border="1">
          <tbody>
            <tr>
              <td>
                <p align="center"><font face="ＭＳ ゴシック">独立した2つの作業を行う</font></p>
              </td>
            </tr>
            <tr>
              <td>
                <p><font face="ＭＳ ゴシック">/**********************************************************<br>
                    PushSW1でLED0をPushSW2でLED0を2秒間点灯させる<br>
                    この２つの作業は独立に行われる<br>
**********************************************************/<br>
                    #include &lt;3048fone.h&gt;<br>
                    #include "h8_3048fone.h"</font></p>
                <p><font face="ＭＳ ゴシック">volatile int
                    count1=-1;/*LED0用カウンタ　-1の時は休止中*/<br>
                    volatile int count2=-1;/*LED1用カウンタ　-1の時は休止中*/<br>
                    main()<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; initLed();<br>
                    &nbsp;&nbsp;&nbsp; initPushSW();/*PushSWの初期化*/<br>
                    &nbsp;&nbsp;&nbsp; initTimer1Int(10000);
                    /*時間割り込み10000μsec=10msec ch1使用*/<br>
                    &nbsp;&nbsp;&nbsp;
                    E_INT();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    /*CPU割り込み許可*/<br>
                    &nbsp;&nbsp;&nbsp; startTimer1();&nbsp;
                    /*時間割り込みタイマスタートch1*/<br>
                    &nbsp;&nbsp;&nbsp; while(1) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    ((count1==-1 || 50&lt;count1) &amp;&amp;
                    checkPushSW(0)==1) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    count1=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    turnOnLed(0);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if
                    (200&lt;count1) { /*200カウントで2秒経過*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    count1=-1;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    turnOffLed(0);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    ((count2==-1 || 50&lt;count2) &amp;&amp;
                    checkPushSW(1)==1) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    count2=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    turnOnLed(1);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if
                    (200&lt;count2) { /*200カウントで2秒経過*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    count2=-1;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    turnOffLed(1);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</font></p>
                <p><font face="ＭＳ ゴシック">#pragma asm<br>
                    &nbsp;&nbsp;&nbsp; .SECTION&nbsp;&nbsp;&nbsp; MYVEC,
                    DATA, LOCATE=H'000070<br>
                    &nbsp;&nbsp;&nbsp;
                    .ORG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    H'000070&nbsp; ;IMIA1<br>
                    &nbsp;&nbsp;&nbsp; .DATA.L&nbsp;&nbsp;&nbsp;&nbsp;
                    _TimerIntFunc<br>
                    &nbsp;&nbsp;&nbsp; .SECTION&nbsp;&nbsp;&nbsp;
                    P,CODE,ALIGN=2 ;これを忘れてはいけない<br>
                    #pragma endasm</font></p>
                <p><font face="ＭＳ ゴシック">#pragma interrupt (TimerIntFunc)<br>
                    void TimerIntFunc() /*タイマ割り込みルーチン*/<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; static int tick=0;<br>
                    &nbsp;&nbsp;&nbsp; clearTimer1Flag();&nbsp;
                    /*タイマステータスフラグのクリア 忘れないこと*/<br>
                    &nbsp;&nbsp;&nbsp; if (count1!=-1) count1++;<br>
                    &nbsp;&nbsp;&nbsp; if (count2!=-1) count2++;<br>
                    }</font></p>
              </td>
            </tr>
          </tbody>
        </table>
      </p>
    </blockquote>
    
<p>
      <table cellpadding="1" cellspacing="1" bgcolor="#ffff80" border="0">
        <tbody>
          <tr>
            <td>
              <p><font face="ＭＳ ゴシック">練習問題(1)　（mp9ex01.txt）</font></p>
              <p><font face="ＭＳ ゴシック">プッシュスイッチ0を押した瞬間からLED0は１秒間点灯し、１秒間消灯
                  し、<br>
                  １秒間点灯して動作を終了する。（ON-OFF-ON-OFF）　このLED0の動作をLED0定型動作とする。<br>
                  プッシュスイッチ1を押した瞬間からLED1は１秒間点灯し、１秒間消灯し、<br>
                  １秒間点灯して動作を終了する。</font><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック">（ON-OFF-ON-OFF）</font>このLED1の動作をLED1定型動作とする。</font></p>
              <p><font face="ＭＳ ゴシック">ただし、LED0が定型動作中にプッシュスイッチ0が押されたら、残り定
                  型動作時間には無関係に、その時点か<br>
                  ら新たに定型動作を開始するものとする。<br>
                  同様に、LED1が定型動作中にプッシュスイッチ1が押されたら残り定型動作時間には無関係に、その時点から<br>
                  新たに定型動作を開始するものとする。<br>
                  また、LED0が定型動作中にプッシュスイッチ1が押されたら、LED0の定型動作には影響を与えず、LED1は、<br>
                  定型動作を開始するものとする。<br>
                  同様に、LED1が定型動作中にプッシュスイッチ0が押されたら、LED1の定型動作には影響を与えず、LED0
                  は、<br>
                  定型動作を開始するものとする。<br>
                  この動作も前例題と同様に独立動作である。<br>
                  なお，例題では失敗作と成功例があるが，どのように失敗していて，どのようにして成功させたかを考察で述べなさい。</font></p>
              <p><font face="ＭＳ ゴシック">練習問題(2)　（mp9ex02.txt）</font></p>
              <p><font face="ＭＳ ゴシック">前課題の２つプッシュスイッチにより起動する独立動作に加え、プッシュスイッチ２によって起動するも<br>
                  う１つの独立動作を行うようにする。<br>
                  シリアル通信とテラタームを用いて次の動作をおこなう。<br>
                  テラタームで電光掲示板のように「Hello,
                  everyone!」を右から左に流れるように表示する。表<br>
                  示中に再度プッシュスイッチが押されたら、表示動作は最初から再表示になる。<br>
                  また、LED0、LED1とこの表示はそれぞれ独立動作である。<br>
                  電光掲示板のように表示させるには次の文字列を0.1秒ごとに表示ればよい。<br>
                  最後まで表示したら、この定型動作は終了である。</font></p>
<blockquote>
  <p><font face="ＭＳ ゴシック">
                  "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  H\r"<br>
                  "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  He\r"<br>
                  "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  Hel\r"<br>
                  "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  Hell\r"<br>
                  "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  Hello\r"<br>
                  "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  Hello,\r"<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :<br>
                  "Hello, everyone!\r"<br>
                  "ello, everyone! \r"<br>
                  "llo, everyone!&nbsp; \r"<br>
                  "lo, everyone!&nbsp;&nbsp; \r"<br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :<br>
                  "e!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  \r"<br>
                  "!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  \r"<br>
                  "
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  \r"<br>
    </font></p>
</blockquote>
<p><font face="ＭＳ ゴシック">WindowsCプログラミングで，サンプルを作ると次のようになるので参考にするとよい。<br>
  </font></p>
<blockquote><font face="ＭＳ ゴシック"><small>#include &lt;stdio.h&gt;<br>
#include &lt;windows.h&gt;<br>
      <br>
char 
hello[]="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 Hello, 
everyone!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ";<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 012345678901234567890123456789012345678901234567890*/<br>
      <br>
main()<br>
{<br>
&nbsp;&nbsp;&nbsp; int i,j;<br>
&nbsp;&nbsp;&nbsp; i=0;<br>
&nbsp;&nbsp;&nbsp; while (1) {<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Sleep(300);//300msお休み windowsの関数<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; printf("&lt;");<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; for (j=0; j&lt;16; j++) putchar(hello[i+j]);//i番目から16個表示<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; printf("&gt;\r");<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; i++;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (i==34) i=0;<br>
&nbsp;&nbsp;&nbsp; }<br>
}</small></font><br>
</blockquote><font face="ＭＳ ゴシック">もしHello表示だけなら，次のようなプログラムになるであろう。</font><br>
<br>
<blockquote><small><font face="ＭＳ ゴシック">volatile int count=-1;/*カウンタ　-1の時は休止中*/</font></small><br>
  <small><font face="ＭＳ ゴシック">volatile int cmdstertptr=-1;/*文字列表示開始位置指令*/</font></small><br>
  <br>
  <small><font face="ＭＳ ゴシック">const char 
hello[]="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 Hello, 
everyone!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ";</font></small><br>
  <br>
  <small><font face="ＭＳ ゴシック">main()</font></small><br>
  <small><font face="ＭＳ ゴシック">{</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; int i, j;</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; i = 0;</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; </font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; initSCI1();</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; initLed();</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; initPushSW();/*PushSWの初期化*/</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; initTimer1Int(10000); /*時間割り込み10000μsec=10msec ch1使用*/</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; E_INT();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*CPU割り込み許可*/</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; startTimer1();&nbsp; /*時間割り込みタイマスタートch1*/</font></small><br>
  <br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; while(1) {</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if ( (count&lt;0 || 10&lt;count) &amp;&amp;checkPushSW(2)==1) {</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; count = 0;</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cmdstertptr = 0;</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if(0&lt;=cmdstertptr) {</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SCI1_printf("&lt;");</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; for(j = 0; j &lt; 16; j++) {</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SCI1_printf("%c", hello[cmdstertptr+j]);</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SCI1_printf("&gt;\r");</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (cmdstertptr==34) {</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; count=-1;</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cmdstertptr=-1;</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; }</font></small><br>
  <small><font face="ＭＳ ゴシック">}</font></small><br>
  <br>
  <small><font face="ＭＳ ゴシック">#pragma asm</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; .SECTION&nbsp;&nbsp;&nbsp; MYVEC, DATA, LOCATE=H'000070</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; .ORG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; H'000070&nbsp; ;IMIA1</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; .DATA.L&nbsp;&nbsp;&nbsp;&nbsp; _TimerIntFunc</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; .SECTION&nbsp;&nbsp;&nbsp; P,CODE,ALIGN=2 ;これを忘れてはいけない</font></small><br>
  <small><font face="ＭＳ ゴシック">#pragma endasm</font></small><br>
  <br>
  <small><font face="ＭＳ ゴシック">#pragma interrupt (TimerIntFunc)</font></small><br>
  <small><font face="ＭＳ ゴシック">void TimerIntFunc() /*タイマ割り込みルーチン*/</font></small><br>
  <small><font face="ＭＳ ゴシック">{</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; static int tick=0;</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; clearTimer1Flag();&nbsp; /*タイマステータスフラグのクリア 忘れないこと*/</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; if (count!=-1) count++;</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; if (count%10==0) {</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cmdstertptr=count/10;</font></small><br>
  <small><font face="ＭＳ ゴシック">&nbsp;&nbsp;&nbsp; }</font></small><br>
  <small><font face="ＭＳ ゴシック">}</font></small><br>
</blockquote>
</td></tr></tbody></table></p><p>&nbsp;</p>
    
<p><strong><font color="#000080">１１．　LCDへの出力</font></strong> </p>
    
<p><font face="ＭＳ ゴシック">h8_3048fone.hに定義されている関数を使って，LCDにpushSWの状態を表示する。<br>
      initLCD( ) LCDの初期化<br>
      LCD_gotoxy(y,x) 表示位置の設定 y:行，x:カラム<br>
      LCD_printf( ) LCD版printf</font></p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <p>
        <table cellpadding="1" cellspacing="1" border="1">
          <tbody>
            <tr>
              <td>
                <p align="center">LCDout.c</p>
              </td>
            </tr>
            <tr>
              <td>
                <p><font color="#800080" face="ＭＳ ゴシック">/**********************************************************<br>
                    LCDへ出力<br>
**********************************************************/<br>
                    #include &lt;3048fone.h&gt;<br>
                    #include "h8_3048fone.h"</font></p>
                <p><font color="#800080" face="ＭＳ ゴシック">main()<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; unsigned char sw,previous;<br>
                    &nbsp;&nbsp;&nbsp; initPushSW();<br>
                    &nbsp;&nbsp;&nbsp; initLCD(); /*LCDの初期化*/<br>
                    &nbsp;&nbsp;&nbsp; LCD_gotoxy(0,0);<br>
                    &nbsp;&nbsp;&nbsp; LCD_printf("pushSW status");<br>
                    &nbsp;&nbsp;&nbsp; previous=sw=getPushSW();<br>
                    &nbsp;&nbsp;&nbsp; LCD_gotoxy(0,1);<br>
                    &nbsp;&nbsp;&nbsp; LCD_printf("%02x[%08b]",sw,sw);<br>
                    &nbsp;&nbsp;&nbsp; while(1) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    sw=getPushSW();<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (sw!=previous) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    LCD_gotoxy(0,1);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    LCD_printf("%02x[%08b]",sw,sw);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    previous=sw;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</font></p>
              </td>
            </tr>
          </tbody>
        </table>
      </p>
    </blockquote>
    <br>
<div style="TEXT-ALIGN: left; mso-pagination: widow-orphan" class="MsoNormal" align="left">
      <table cellpadding="1" cellspacing="0" bgcolor="#ffff80" border="0">
        <tbody>
          <tr>
            <td>
              <p><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック">練習問題　（mp9ex03.txt）<br>
    </font></font></p>
<p dir="ltr"><font face="ＭＳ ゴシック"><font face="ＭＳ ゴシック">10の練習問題(2)（mp9ex02.txt）で提出した課題において，電光掲示板表示をLCDに表示するように変更しなさい。<br>
必要なら表示速度を遅くしなさい。<br>
&nbsp;
  </font>（実行の様子を検察して，その結果，気付いた事を含め，提出しなさい）<br>
                  　</font></p>

            </td>
          </tr>
        </tbody>
      </table>
      <br>
  <br>
    </div>
<hr align="left" size="3" width="100%"><br>
<br>
    
<p align="left"><font color="#0000ff"><strong>参考１ H8ピン配置と</strong></font><font color="#0000ff"><strong>ポート割当</strong></font></p>
    <font color="#0000ff">
      <p align="left"><a href="https://xythos.tokyo-ct.ac.jp/web/j/usr/kosaka/for_students/H8/H8-MB-Pro/TNCTBoard.pdf"><strong>TNCT3048FONE・3052用
            マザーボード回路図（pdf）</strong></a></p>
    </font>
    
<p align="left">
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td>
              <p align="center">コネクタ１（CN1）ピン割り当て</p>
            </td>
            <td>
              <p align="center">コネクタ２（CN2）ピン割り当て</p>
            </td>
            <td>
              <p align="center">コネクタ３（CN3）ピン割り当て</p>
            </td>
            <td>
              <p align="center">コネクタ４（CN4）ピン割り当て</p>
            </td>
            <td>
              <p align="center">コネクタ５（CN5）ピン割り当て</p>
            </td>
          </tr>
          <tr valign="top">
            <td valign="top">
              <table border="1">
                <tbody>
                  <tr>
                    <td>CN1 pin</td>
                    <td>H8 pin</td>
                    <td>name</td>
                  </tr>
                  <tr>
                    <td>1</td>
                    <td>GND</td>
                    <td>GND</td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>GND</td>
                    <td>GND</td>
                  </tr>
                  <tr>
                    <td>3</td>
                    <td>87</td>
                    <td>P8-0</td>
                  </tr>
                  <tr>
                    <td>4</td>
                    <td>88</td>
                    <td>P8-1</td>
                  </tr>
                  <tr>
                    <td>5</td>
                    <td>89</td>
                    <td>P8-2</td>
                  </tr>
                  <tr>
                    <td>6</td>
                    <td>90</td>
                    <td>P8-3</td>
                  </tr>
                  <tr>
                    <td>7</td>
                    <td>91</td>
                    <td>P8-4</td>
                  </tr>
                  <tr>
                    <td>8</td>
                    <td>93</td>
                    <td>PA-0</td>
                  </tr>
                  <tr>
                    <td>9</td>
                    <td>94</td>
                    <td>PA-1</td>
                  </tr>
                  <tr>
                    <td>10</td>
                    <td>95</td>
                    <td>PA-2</td>
                  </tr>
                  <tr>
                    <td>11</td>
                    <td>96</td>
                    <td>PA-3</td>
                  </tr>
                  <tr>
                    <td>12</td>
                    <td>97</td>
                    <td>PA-4</td>
                  </tr>
                  <tr>
                    <td>13</td>
                    <td>98</td>
                    <td>PA-5</td>
                  </tr>
                  <tr>
                    <td>14</td>
                    <td>99</td>
                    <td>PA-6</td>
                  </tr>
                  <tr>
                    <td>15</td>
                    <td>100</td>
                    <td>PA-7</td>
                  </tr>
                  <tr>
                    <td>16</td>
                    <td>2</td>
                    <td>PB-0</td>
                  </tr>
                  <tr>
                    <td>17</td>
                    <td>3</td>
                    <td>PB-1</td>
                  </tr>
                  <tr>
                    <td>18</td>
                    <td>4</td>
                    <td>PB-2</td>
                  </tr>
                  <tr>
                    <td>19</td>
                    <td>5</td>
                    <td>PB-3</td>
                  </tr>
                  <tr>
                    <td>20</td>
                    <td>6</td>
                    <td>PB-4</td>
                  </tr>
                  <tr>
                    <td>21</td>
                    <td>7</td>
                    <td>PB-5</td>
                  </tr>
                  <tr>
                    <td>22</td>
                    <td>8</td>
                    <td>PB-6</td>
                  </tr>
                  <tr>
                    <td>23</td>
                    <td>9</td>
                    <td>PB-7</td>
                  </tr>
                  <tr>
                    <td>24</td>
                    <td>10</td>
                    <td><font color="#ff0000">FWE</font></td>
                  </tr>
                  <tr>
                    <td>25</td>
                    <td>12</td>
                    <td>P9-0</td>
                  </tr>
                  <tr>
                    <td>26</td>
                    <td>13</td>
                    <td>P9-1</td>
                  </tr>
                  <tr>
                    <td>27</td>
                    <td>14</td>
                    <td>P9-2</td>
                  </tr>
                  <tr>
                    <td>28</td>
                    <td>15</td>
                    <td>P9-3</td>
                  </tr>
                  <tr>
                    <td>29</td>
                    <td>16</td>
                    <td>P9-4</td>
                  </tr>
                  <tr>
                    <td>30</td>
                    <td>17</td>
                    <td>P9-5</td>
                  </tr>
                  <tr>
                    <td>31</td>
                    <td>18</td>
                    <td>P4-0</td>
                  </tr>
                  <tr>
                    <td>32</td>
                    <td>19</td>
                    <td>P4-1</td>
                  </tr>
                  <tr>
                    <td>33</td>
                    <td>20</td>
                    <td>P4-2</td>
                  </tr>
                  <tr>
                    <td>34</td>
                    <td>21</td>
                    <td>P4-3</td>
                  </tr>
                  <tr>
                    <td>35</td>
                    <td>5V</td>
                    <td>5V</td>
                  </tr>
                  <tr>
                    <td>36</td>
                    <td>5V</td>
                    <td>5V</td>
                  </tr>
                  <tr>
                    <td>37</td>
                    <td>GND</td>
                    <td>GND</td>
                  </tr>
                  <tr>
                    <td>38</td>
                    <td>GND</td>
                    <td>GND</td>
                  </tr>
                  <tr>
                    <td>39</td>
                    <td><font color="#ff0000">-</font></td>
                    <td><font color="#ff0000">-</font></td>
                  </tr>
                  <tr>
                    <td>40</td>
                    <td><font color="#ff0000">-</font></td>
                    <td><font color="#ff0000">-</font></td>
                  </tr>
                </tbody>
              </table>
              TNCTマザーボードでは39，40は<br>
              使用していない。</td>
            <td>
              <table border="1">
                <tbody>
                  <tr>
                    <td>CN2 pin</td>
                    <td>H8 pin</td>
                    <td>name</td>
                  </tr>
                  <tr>
                    <td>1</td>
                    <td>GND</td>
                    <td>GND</td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>GND</td>
                    <td>GND</td>
                  </tr>
                  <tr>
                    <td>3</td>
                    <td>62</td>
                    <td>STBY</td>
                  </tr>
                  <tr>
                    <td>4</td>
                    <td>63</td>
                    <td>RES</td>
                  </tr>
                  <tr>
                    <td>5</td>
                    <td>64</td>
                    <td>NMI</td>
                  </tr>
                  <tr>
                    <td>6</td>
                    <td>69</td>
                    <td>P6-3</td>
                  </tr>
                  <tr>
                    <td>7</td>
                    <td>70</td>
                    <td>P6-4</td>
                  </tr>
                  <tr>
                    <td>8</td>
                    <td>71</td>
                    <td>P6-5</td>
                  </tr>
                  <tr>
                    <td>9</td>
                    <td>72</td>
                    <td>P6-6</td>
                  </tr>
                  <tr>
                    <td>10</td>
                    <td>76</td>
                    <td>AVCC</td>
                  </tr>
                  <tr>
                    <td>11</td>
                    <td>77</td>
                    <td>AREF</td>
                  </tr>
                  <tr>
                    <td>12</td>
                    <td>78</td>
                    <td>P7-0</td>
                  </tr>
                  <tr>
                    <td>13</td>
                    <td>79</td>
                    <td>P7-1</td>
                  </tr>
                  <tr>
                    <td>14</td>
                    <td>80</td>
                    <td>P7-2</td>
                  </tr>
                  <tr>
                    <td>15</td>
                    <td>81</td>
                    <td>P7-3</td>
                  </tr>
                  <tr>
                    <td>16</td>
                    <td>82</td>
                    <td>P7-4</td>
                  </tr>
                  <tr>
                    <td>17</td>
                    <td>83</td>
                    <td>P7-5</td>
                  </tr>
                  <tr>
                    <td>18</td>
                    <td>84</td>
                    <td>P7-6</td>
                  </tr>
                  <tr>
                    <td>19</td>
                    <td>85</td>
                    <td>P7-7</td>
                  </tr>
                  <tr>
                    <td>20</td>
                    <td>86</td>
                    <td>AVSS</td>
                  </tr>
                </tbody>
              </table>
            </td>
            <td>
              <table border="1">
                <tbody>
                  <tr>
                    <td>CN3 pin</td>
                    <td>H8 pin</td>
                    <td>name</td>
                  </tr>
                  <tr>
                    <td>1</td>
                    <td>GND</td>
                    <td>GND</td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>GND</td>
                    <td>GND</td>
                  </tr>
                  <tr>
                    <td>3</td>
                    <td>23</td>
                    <td>P4-4</td>
                  </tr>
                  <tr>
                    <td>4</td>
                    <td>24</td>
                    <td>P4-5</td>
                  </tr>
                  <tr>
                    <td>5</td>
                    <td>25</td>
                    <td>P4-6</td>
                  </tr>
                  <tr>
                    <td>6</td>
                    <td>26</td>
                    <td>P4-7</td>
                  </tr>
                  <tr>
                    <td>7</td>
                    <td>27</td>
                    <td>P3-0</td>
                  </tr>
                  <tr>
                    <td>8</td>
                    <td>28</td>
                    <td>P3-1</td>
                  </tr>
                  <tr>
                    <td>9</td>
                    <td>29</td>
                    <td>P3-2</td>
                  </tr>
                  <tr>
                    <td>10</td>
                    <td>30</td>
                    <td>P3-3</td>
                  </tr>
                  <tr>
                    <td>11</td>
                    <td>31</td>
                    <td>P3-4</td>
                  </tr>
                  <tr>
                    <td>12</td>
                    <td>32</td>
                    <td>P3-5</td>
                  </tr>
                  <tr>
                    <td>13</td>
                    <td>33</td>
                    <td>P3-6</td>
                  </tr>
                  <tr>
                    <td>14</td>
                    <td>34</td>
                    <td>P3-7</td>
                  </tr>
                  <tr>
                    <td>15</td>
                    <td>36</td>
                    <td>P1-0</td>
                  </tr>
                  <tr>
                    <td>16</td>
                    <td>37</td>
                    <td>P1-1</td>
                  </tr>
                  <tr>
                    <td>17</td>
                    <td>38</td>
                    <td>P1-2</td>
                  </tr>
                  <tr>
                    <td>18</td>
                    <td>39</td>
                    <td>P1-3</td>
                  </tr>
                  <tr>
                    <td>19</td>
                    <td>40</td>
                    <td>P1-4</td>
                  </tr>
                  <tr>
                    <td>20</td>
                    <td>41</td>
                    <td>P1-5</td>
                  </tr>
                  <tr>
                    <td>21</td>
                    <td>42</td>
                    <td>P1-6</td>
                  </tr>
                  <tr>
                    <td>22</td>
                    <td>43</td>
                    <td>P1-7</td>
                  </tr>
                  <tr>
                    <td>23</td>
                    <td>45</td>
                    <td>P2-0</td>
                  </tr>
                  <tr>
                    <td>24</td>
                    <td>46</td>
                    <td>P2-1</td>
                  </tr>
                  <tr>
                    <td>25</td>
                    <td>47</td>
                    <td>P2-2</td>
                  </tr>
                  <tr>
                    <td>26</td>
                    <td>48</td>
                    <td>P2-3</td>
                  </tr>
                  <tr>
                    <td>27</td>
                    <td>49</td>
                    <td>P2-4</td>
                  </tr>
                  <tr>
                    <td>28</td>
                    <td>50</td>
                    <td>P2-5</td>
                  </tr>
                  <tr>
                    <td>29</td>
                    <td>51</td>
                    <td>P2-6</td>
                  </tr>
                  <tr>
                    <td>30</td>
                    <td>52</td>
                    <td>P2-7</td>
                  </tr>
                  <tr>
                    <td>31</td>
                    <td>53</td>
                    <td>P5-0</td>
                  </tr>
                  <tr>
                    <td>32</td>
                    <td>54</td>
                    <td>P5-1</td>
                  </tr>
                  <tr>
                    <td>33</td>
                    <td>55</td>
                    <td>P5-2</td>
                  </tr>
                  <tr>
                    <td>34</td>
                    <td>56</td>
                    <td>P5-3</td>
                  </tr>
                  <tr>
                    <td>35</td>
                    <td>58</td>
                    <td>P6-0</td>
                  </tr>
                  <tr>
                    <td>36</td>
                    <td>59</td>
                    <td>P6-1</td>
                  </tr>
                  <tr>
                    <td>37</td>
                    <td>60</td>
                    <td>P6-2</td>
                  </tr>
                  <tr>
                    <td>38</td>
                    <td>61</td>
                    <td>CK</td>
                  </tr>
                  <tr>
                    <td>39</td>
                    <td>GND</td>
                    <td>GND</td>
                  </tr>
                  <tr>
                    <td>40</td>
                    <td>GND</td>
                    <td>GND</td>
                  </tr>
                </tbody>
              </table>
            </td>
            <td>
              <table border="1">
                <tbody>
                  <tr>
                    <td>CN4 pin</td>
                    <td>H8 pin</td>
                    <td>name</td>
                  </tr>
                  <tr>
                    <td>1</td>
                    <td><font color="#ff0000">-</font></td>
                    <td><font color="#ff0000">-</font></td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>GND</td>
                    <td>GND</td>
                  </tr>
                  <tr>
                    <td>3</td>
                    <td>5V</td>
                    <td>5V</td>
                  </tr>
                  <tr>
                    <td>4</td>
                    <td>U2-8</td>
                    <td>RXD1</td>
                  </tr>
                  <tr>
                    <td>5</td>
                    <td>U2-13</td>
                    <td>RXD0</td>
                  </tr>
                  <tr>
                    <td>6</td>
                    <td>U2-7</td>
                    <td>TXD1</td>
                  </tr>
                  <tr>
                    <td>7</td>
                    <td>U2-14</td>
                    <td>TXD0</td>
                  </tr>
                  <tr>
                    <td>8</td>
                    <td>10</td>
                    <td><font color="#ff0000">FWE</font></td>
                  </tr>
                  <tr>
                    <td>9</td>
                    <td>75</td>
                    <td>MD2</td>
                  </tr>
                  <tr>
                    <td>10</td>
                    <td>63</td>
                    <td>RES</td>
                  </tr>
                </tbody>
              </table>
              TNCTマザーボードでは1は<br>
              使用していない。</td>
            <td>
              <table border="1">
                <tbody>
                  <tr>
                    <td>CN5 pin</td>
                    <td>H8 pin</td>
                    <td>name</td>
                  </tr>
                  <tr>
                    <td>1</td>
                    <td>GND</td>
                    <td>GND</td>
                  </tr>
                  <tr>
                    <td>2</td>
                    <td>73</td>
                    <td>MD-0</td>
                  </tr>
                  <tr>
                    <td>3</td>
                    <td>GND</td>
                    <td>GND</td>
                  </tr>
                  <tr>
                    <td>4</td>
                    <td>74</td>
                    <td>MD-1</td>
                  </tr>
                  <tr>
                    <td>5</td>
                    <td>GND</td>
                    <td>GND</td>
                  </tr>
                  <tr>
                    <td>6</td>
                    <td>75</td>
                    <td>MD-2</td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>
        </tbody>
      </table>
    </p>
    
<p align="center"> </p>
    <font color="#0000ff"><strong>ポート割当</strong></font><br>
    <br>
    TNCT仕様基板で，新しくIOを設置したい場合，ポートを割り当てる必要がある。<br>
    どのポートが使えるのかまとめておく<br>
    
<ul>
      <li>P1：8ビット入力，出力ポートとして利用可能</li>
      <li>P2：8bitDIPSWが設置されているので利用不可能だが，この8bitDIPSWを外せば8ビット入力，出力ポートとして利用
        可能<br>
        プルアップコントロールがついている</li>
      <li>P3：LCD（液晶表示器）が設置されているので利用不可能だが，このLCDを外せば8ビット入力，出力ポートとして利用可能</li>
      <li>P4：上位4ビットにpushSWがついている。もともとは8ビット入力，出力ポートとして利用可能<br>
        プルアップコントロールがついている</li>
      <li>P5：下位2ビット（B0,B1）にLEDがついている。B2,B3にもLEDが付けられるようになっている。<br>
        もともとは下位4ビットのみ入力，出力ポートとして利用可能<br>
        プルアップコントロールがついている</li>
      <li>P6：8ビット入力，出力ポートとして利用可能</li>
      <li>P7：AD変換入力なのでその用途につかう</li>
      <li>P8：IRQ用なのでその用途につかう</li>
      <li>P9：SCI通信用なのでその用途につかう</li>
      <li>PA：PWM波形出力，周期・デューティ測定用入力用(ITU)なのでその用途につかう<br>
        8ビット入力，出力ポートとしても利用可能</li>
      <li>PB：PWM波形出力，周期・デューティ測定用入力用(ITU)なのでその用途につかう<br>
        8ビット入力，出力ポートとしても利用可能<br>
        <br>
      </li>
    
</ul>
    
<hr align="left" size="3" width="100%">
    
<p align="left"><font color="#0000ff"><strong>参考２　h8_3048fone.h</strong></font></p>
    
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
      <table cellpadding="1" cellspacing="1" border="1">
        <tbody>
          <tr>
            <td>
              <p align="center"><strong><font color="#0000ff">h8_3048fone.h</font></strong></p>
            </td>
          </tr>
          <tr>
            <td>
              <p><font color="#0000ff"><font color="#800080" face="ＭＳ ゴシック">/****************************************************************<br>
                    h8_3048fone.h<br>
                    Copyright (c) Kosaka Lab CS TNCT</font></font></p>
              <p><font color="#0000ff"><font color="#800080" face="ＭＳ ゴシック">このインクルードファイルは小坂研究室の代々の研究生が開発した<br>
                    h8/3048用の有用な関数群を改良して小坂がまとめたものである。<br>
                    06 Mar 2013 h8_3048fone.h&nbsp; 小坂 教材用にリファイン<br>
                    01 Jun 2009 h8-3048.h&nbsp; 小坂 教材用にリファイン<br>
                    28 Jun 2006 h8-3048.h&nbsp; 小坂 chkgetSCI1のタイミング修正<br>
                    &nbsp;4 Dec 2003 h8-3048.h&nbsp; 小坂
                    printf更新,initLed更新,initDDR削除<br>
                    08 Oct 2003 h8-3048.h&nbsp; 小坂
                    stopTimer追加,getIntSCI1でBS使用可<br>
                    &nbsp;6 Jan 2003 h8_3048.h&nbsp; 小坂
                    getIntSCIバックスペイスに対応。<br>
                    17 Apr 2002 h8-01.h&nbsp; 小坂 %uの使い方をansiにあわせた。<br>
                    14 Dec 2001 h8-01.h&nbsp; 小坂，越智<br>
                    15 Jly 2000 h8-00.h&nbsp; 小坂，藤原<br>
                    22 Dec 1999 h8-99.h&nbsp; 小坂，高沢<br>
                    29 Oct 1999 h8-99.h&nbsp; 小坂<br>
                    05 Feb 1999 lib.h&nbsp;&nbsp;&nbsp; 笠井</font></font></p>
              <font color="#0000ff"><font color="#800080" face="ＭＳ ゴシック">
                  <p><br>
                    【１】SCI<br>
                    【１．１】 ch1 関係<br>
                    void initSCI1()<br>
                    &nbsp;SCI-ch1の初期化　38400baud, Async, 8bit , NoParity,
                    stop1</p>
                  <p>short int SCI1_getChar()<br>
                    &nbsp;SCI-ch1から1byte入力コード。エラーがあると-2が戻る。<br>
                    short int SCI1_chkgetChar()<br>
                    &nbsp;SCI-ch1を検査し，受信データがあれば1byte入力コード。なければ-1が，失敗すると
                    -2が戻る。<br>
                    int SCI1_getString(char *buff,int max)<br>
                    &nbsp;SCI1から最大max-1文字の文字列を受け取る。（buffのサイズはmaxでよい）<br>
                    short int SCI1_getInt(char prompt[])<br>
                    &nbsp;SCI-ch1からプロンプト付で，short intの値を受け取る。<br>
                    &nbsp;正負の10進数または16進数を受け付ける。16進数は0xで始まる<br>
                    long int SCI1_getInt4(char prompt[])<br>
                    &nbsp;SCI-ch1からプロンプト付で，long intの値を受け取る。<br>
                    &nbsp;正負の10進数または16進数を受け付ける。16進数は0xで始まる</p>
                  <p>void SCI1_putChar(char c)<br>
                    &nbsp;SCI-ch1に1バイト出力する。<br>
                    void SCI1_putString(char *str)<br>
                    &nbsp;SCI-ch1に文字列を出力する。<br>
                    void SCI1_printf(char *format,...)<br>
                    &nbsp; 関数printfのSCI1版<br>
                    &nbsp; 軽量化のためエラー処理はないので桁数指定の場合は注意<br>
                    &nbsp; 対応書式<br>
                    &nbsp; %d&nbsp;&nbsp; : [int] integer with sign.
                    '%d','%4d','%-4d', and '%04d' are available<br>
                    &nbsp; %ld&nbsp; : explicit [long int]&nbsp;
                    '%ld','%9ld','%-9ld', and '%09ld' are available<br>
                    &nbsp; %u&nbsp;&nbsp; : [unsigbed int] unsigned
                    integer.<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    '%u','%4u','%-4u', and '%04u' are available<br>
                    &nbsp; %lu&nbsp; : explicit [unsigned long int]<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    '%lu','%9lu','%-9lu', and '%09lu' are available<br>
                    &nbsp; %x&nbsp;&nbsp; : [unsigned int] in Hex&nbsp;
                    '%x','%4x','%-4x', and '%04x' are available<br>
                    &nbsp; %lx&nbsp; : explicit [unsigned long int] in
                    Hex&nbsp; <br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    '%lx','%8lx','%-8lx', and '%08lx' are available<br>
                    &nbsp; %o&nbsp;&nbsp; : [unsigned int] in Oct&nbsp;
                    '%o','%4o','%-4o', and '%04o' are available<br>
                    &nbsp; %lo&nbsp; : explicit [unsigned long int] in
                    Oct&nbsp; <br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    '%lo','%8lo','%-8lo', and '%08lo' are available<br>
                    &nbsp; %b&nbsp;&nbsp; : [unsigned int] in Bin&nbsp;
                    '%b','%8b','%-8b', and '%08b' are available<br>
                    &nbsp; %lb&nbsp; : explicit [unsigned long int] in
                    Bin&nbsp; <br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    '%lb','%8lb','%-8lb', and '%08lb' are available<br>
                    &nbsp; %c&nbsp;&nbsp; : char<br>
                    &nbsp; %s&nbsp;&nbsp; : string %20s %-20s are
                    available</p>
                  <p>【１．２】SCI ch0 関係<br>
                    void initSCI0()<br>
                    &nbsp;SCI-ch0の初期化　38400baud, Async, 8bit , NoParity,
                    stop1</p>
                  <p>short int SCI0_getChar()<br>
                    &nbsp;SCI-ch0から1byte入力コード。エラーがあると-2が戻る。<br>
                    short int SCI0_chkgetChar()<br>
                    &nbsp;SCI-ch0を検査し，受信データがあれば1byte入力コード。なければ-1が，失敗すると
                    -2が戻る。<br>
                    int SCI0_getString(char *buff,int max)<br>
                    &nbsp;SCI0から最大max-1文字の文字列を受け取る。（buffのサイズはmaxでよい）<br>
                    short int SCI0_getInt(char prompt[])<br>
                    &nbsp;SCI-ch0からプロンプト付で，short intの値を受け取る。<br>
                    &nbsp;正負の10進数または16進数を受け付ける。16進数は0xで始まる<br>
                    long int SCI0_getInt4(char prompt[])<br>
                    &nbsp;SCI-ch0からプロンプト付で，long intの値を受け取る。<br>
                    &nbsp;正負の10進数または16進数を受け付ける。16進数は0xで始まる</p>
                  <p>void SCI0_putChar(char c)<br>
                    &nbsp;SCI-ch0に1バイト出力する。<br>
                    void SCI0_putString(char *str)<br>
                    &nbsp;SCI-ch0に文字列を出力する。<br>
                    void SCI0_printf(char *format,...)<br>
                    &nbsp; 関数printfのSCI0版<br>
                    &nbsp; 仕様はvoid SCI1_printf(char *format,...)参照</p>
                  <p>【２】LCD関係<br>
                    void LCD_putchar(char data)<br>
                    &nbsp; LCDに向けた putchar()<br>
                    void LCD_puts(char *str)<br>
                    &nbsp; LCDに向けた puts()<br>
                    void initLCD( void )<br>
                    &nbsp; LCDの初期化<br>
                    void LCD_gotoxy(unsigned x,unsigned y)<br>
                    &nbsp; LCDに向けた gotoxy()<br>
                    void LCD_clrscr(void)<br>
                    &nbsp; LCDに向けた clrscr()&nbsp;&nbsp; clear screen<br>
                    void LCD_printf(char *format,...)<br>
                    &nbsp; 関数printfのLCD版<br>
                    &nbsp; 仕様はvoid SCI1_printf(char *format,...)参照</p>
                  <p>【３】文字列操作<br>
                    void sprintf(char *buff,char *format,...)<br>
                    &nbsp; 仕様はvoid SCI1_printf(char *format,...)参照<br>
                    &nbsp; buffのあふれは呼び出し側で起こらないようにしておく必要がある<br>
                    long int atoi(char *buff)<br>
                    &nbsp; 文字列を整数型の値に変換する<br>
                    &nbsp; 正負の10進数または16進数の文字列を受け付ける。16進数は0xまたは-0xで始まる<br>
                    &nbsp;例 "123"<br>
                    &nbsp;&nbsp;&nbsp; "-123"<br>
                    &nbsp;&nbsp;&nbsp; "0x1a"<br>
                    &nbsp;&nbsp;&nbsp; "-0x100"</p>
                  <p>【４】AKI-H8マザーボード関係<br>
                    void initLed()<br>
                    &nbsp;LEDの初期化<br>
                    void turnOnLed(short int number)<br>
                    &nbsp;LEDの点灯　numberはLED番号で0または1を指定する<br>
                    void turnOffLed(short int number)<br>
                    &nbsp;LEDの消灯　numberはLED番号で0または1を指定する</p>
                  <p>void initPushSW(void)<br>
                    &nbsp;押しボタンスイッチの初期化<br>
                    unsigned char getPushSW(void)<br>
                    &nbsp;押しボタンスイッチの取得　ビット反転し，ONは1，OFFは0で取得される。<br>
                    &nbsp;押しボタンスイッチの状況は第0-第3ビットに現れる。<br>
                    &nbsp;これはマクロ定義で実現されている<br>
                    short int checkPushSW(short int number)<br>
                    &nbsp;push sw 0,1,2,3の状態を調べる　number:0,1,2,or 3<br>
                    &nbsp;押されていたら1、そうでなかったら0を返す</p>
                  <p>void init8BitSW(void)<br>
                    &nbsp;8ビットスイッチの初期化<br>
                    unsigned char get8BitSW(void)<br>
                    &nbsp;8ビットスイッチの取得　ビット反転し，ONは1，OFFは0で取得される。<br>
                    &nbsp;8ビットスイッチの状況は第0-第7ビットに現れる。<br>
                    &nbsp;これはマクロ定義で実現されている<br>
                    short int check8BitSW(short int number)<br>
                    &nbsp;8bitsw
                    0,1,2,3,4,5,6,7の状態を調べる　number:0,1,2,3,4,5,6,or 7<br>
                    &nbsp;ONなら1、そうでなかったら0を返す</p>
                  <p>【５】インターバルタイマ割り込み<br>
                    void initTimer1Int(unsigned short int period)<br>
                    &nbsp;ITU1による割り込みタイマーの設定<br>
                    &nbsp;割り込み間隔は引数peiodで単位はμsecである<br>
                    &nbsp;値は20971以下でなければならない。20.971msecまで設定可能</p>
                  <p>void startTimer1(void)<br>
                    &nbsp;Timer CH1 スタート<br>
                    &nbsp;これはマクロ定義で実現されている<br>
                    void stopTimer1(void)<br>
                    &nbsp;Timer CH1 ストップ<br>
                    &nbsp;これはマクロ定義で実現されている<br>
                    void clearTimer1Flag(void)<br>
                    &nbsp;Timer CH1 割り込みフラグのクリア<br>
                    &nbsp;これはマクロ定義で実現されている</p>
                  <p><br>
****************************************************************/</p>
                  <p>#include&lt;stdarg.h&gt;</p>
                  <p>extern void E_INT();<br>
                    extern void D_INT();</p>
                  <p>/*次の1行はMicrosoftHyperTerminal使用時に有効にする*/<br>
                    /*有効な場合H8からシリアル送信時に\nを\r\nに自動変換する*/<br>
                    #define HYPERTERMINAL</p>
                  <p>/*システムクロック関係*/<br>
                    #define SYS_CLOCK 25 /*MHz 16,20,25 程度を想定*/</p>
                  <p>const int SCI0device=0;<br>
                    const int SCI1device=1;<br>
                    const int LCDdevice=2;<br>
                    const int STRdevice= 3;</p>
                  <p>/*SCI関係の基本部分は笠井君(1998年度)藤原君(2000)の開発です*/<br>
                    /* -------------------------------------------------
                    */<br>
                    /* SCI1 INITIALIZATION fixed baud at
                    38400&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    */<br>
                    /* -------------------------------------------------
                    */<br>
                    void initSCI1()<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; short int i;<br>
                    &nbsp;&nbsp;&nbsp; SCI1.SCR.BYTE =
                    0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* clear all
                    flags */<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    /* 2400-38400baud are available at
                    n=0(cks1=0,cks2=0) */<br>
                    &nbsp;&nbsp;&nbsp; SCI1.SMR.BYTE =
                    0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* Async,
                    8bit , NoParity, stop1, 1/1 */<br>
                    &nbsp;&nbsp;&nbsp; SCI1.BRR = (unsigned
                    char)((8138L*SYS_CLOCK+5000L)/10000L-1);<br>
                    &nbsp;&nbsp;&nbsp;
                    for(i=0;i&lt;1000;i++);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    /* wait more than 1bit time */<br>
                    &nbsp;&nbsp;&nbsp; SCI1.SCR.BYTE =
                    0x30;&nbsp;&nbsp;&nbsp; /* scr = 0011 0000
                    (TE=1,RE=1) */<br>
                    &nbsp;&nbsp;&nbsp; return;<br>
                    }</p>
                  <p>/*
                    ------------------------------------------------- */<br>
                    /* GET BYTE FROM SCI1 */<br>
                    /* -------------------------------------------------
                    */<br>
                    short int SCI1_getChar()<br>
                    /* return value 0x00-0xFF:received data */<br>
                    /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    -2(0xFFFE):error */<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; short int flags,recdata;<br>
                    &nbsp;&nbsp;&nbsp; do {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; flags =
                    SCI1.SSR.BYTE;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (flags&amp;0x38) {/* error */<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1.SSR.BIT.RDRF = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1.SSR.BIT.ORER = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1.SSR.BIT.FER = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1.SSR.BIT.PER = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    return -2;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (flags&amp;0x40) {/* normally received one data */<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1.SSR.BIT.RDRF = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    recdata=SCI1.RDR;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    return recdata;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; } while (1);<br>
                    }</p>
                  <p>/*
                    ------------------------------------------------- */<br>
                    /* CHECK SCI BUFFER AND GET DATA */<br>
                    /* -------------------------------------------------
                    */<br>
                    short int SCI1_chkgetChar()<br>
                    /* return value -1(0xFFFF):no received data&nbsp; */<br>
                    /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    0x00-0xFF:received data */<br>
                    /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    -2(0xFFFE):error */<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; short int flags,recdata;<br>
                    &nbsp;&nbsp;&nbsp; flags = SCI1.SSR.BYTE;<br>
                    &nbsp;&nbsp;&nbsp; if (flags&amp;0x38) {/* error */<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1.SSR.BIT.RDRF = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1.SSR.BIT.ORER = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1.SSR.BIT.FER = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1.SSR.BIT.PER = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return
                    -2;<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; if (flags&amp;0x40) {/* normally
                    received one data */<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    recdata=SCI1.RDR;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1.SSR.BIT.RDRF = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return
                    recdata;<br>
                    &nbsp;&nbsp;&nbsp; } else {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return
                    -1;<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</p>
                  <p>void SCI1_putString(char *str);</p>
                  <p>/*SCI1より文字列入力[return]が終端だが，'\n'は取得されない*/<br>
                    /*^Hでバックスペイス*/<br>
                    int SCI1_getString(char *buff,int max)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; int i,ch;<br>
                    &nbsp;&nbsp;&nbsp; for (i=0;i&lt;max-1;i++) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    ch=SCI1_getChar(); /*1文字取得*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    *buff=(char)ch; /*1文字取得*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (*buff=='\r'||ch&lt;0) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    *buff=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    return i+1;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (*buff==0x8) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    buff-=2;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    i-=2;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (*buff!='\n') buff++;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else i--;<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; *buff=0;<br>
                    &nbsp;&nbsp;&nbsp; return i+1;<br>
                    }</p>
                  <p>/*
                    ------------------------------------------------- */<br>
                    /* PUT BYTE TO SCI1 */<br>
                    /* -------------------------------------------------
                    */<br>
                    void SCI1_putChar(char c)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; unsigned char tmp;<br>
                    #ifdef HYPERTERMINAL<br>
                    &nbsp;&nbsp;&nbsp; if (c=='\n') SCI1_putChar('\r');<br>
                    #endif<br>
                    &nbsp;&nbsp;&nbsp; do{<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmp =
                    SCI1.SSR.BYTE;<br>
                    &nbsp;&nbsp;&nbsp; } while((tmp &amp; 0x80)==0);<br>
                    &nbsp;&nbsp;&nbsp; SCI1.TDR = c;<br>
                    &nbsp;&nbsp;&nbsp; SCI1.SSR.BIT.TDRE = 0;<br>
                    &nbsp;&nbsp;&nbsp; return;<br>
                    }</p>
                  <p>void SCI1_putString(char *str)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; while(*str){<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI1_putChar(*str);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str++;<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</p>
                  <p><br>
                    /* -------------------------------------------------
                    */<br>
                    /* SCI0 INITIALIZATION fixed baud at
                    38400&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    */<br>
                    /* -------------------------------------------------
                    */<br>
                    void initSCI0()<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; short int i;<br>
                    &nbsp;&nbsp;&nbsp; SCI0.SCR.BYTE =
                    0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* clear all
                    flags */<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    /* 2400-38400baud are available at
                    n=0(cks1=0,cks2=0) */<br>
                    &nbsp;&nbsp;&nbsp; SCI0.SMR.BYTE =
                    0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* Async,
                    8bit , NoParity, stop1, 1/1 */<br>
                    &nbsp;&nbsp;&nbsp; SCI0.BRR = (unsigned
                    char)((8138L*SYS_CLOCK+5000L)/10000L-1);<br>
                    &nbsp;&nbsp;&nbsp;
                    for(i=0;i&lt;1000;i++);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    /* wait more than 1bit time */<br>
                    &nbsp;&nbsp;&nbsp; SCI0.SCR.BYTE =
                    0x30;&nbsp;&nbsp;&nbsp; /* scr = 0011 0000
                    (TE=1,RE=1) */<br>
                    &nbsp;&nbsp;&nbsp; return;<br>
                    }</p>
                  <p>/*
                    ------------------------------------------------- */<br>
                    /* GET BYTE FROM SCI0 */<br>
                    /* -------------------------------------------------
                    */<br>
                    short int SCI0_getChar()<br>
                    /* return value 0x00-0xFF:received data */<br>
                    /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    -2(0xFFFE):error */<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; short int flags,recdata;<br>
                    &nbsp;&nbsp;&nbsp; do {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; flags =
                    SCI0.SSR.BYTE;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (flags&amp;0x38) {/* error */<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI0.SSR.BIT.RDRF = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI0.SSR.BIT.ORER = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI0.SSR.BIT.FER = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI0.SSR.BIT.PER = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    return -2;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (flags&amp;0x40) {/* normally received one data */<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI0.SSR.BIT.RDRF = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    recdata=SCI0.RDR;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    return recdata;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; } while (1);<br>
                    }</p>
                  <p>/*
                    ------------------------------------------------- */<br>
                    /* CHECK SCI BUFFER AND GET DATA */<br>
                    /* -------------------------------------------------
                    */<br>
                    short int SCI0_chkgetChar()<br>
                    /* return value -1(0xFFFF):no received data&nbsp; */<br>
                    /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    0x00-0xFF:received data */<br>
                    /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    -2(0xFFFE):error */<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; short int flags,recdata;<br>
                    &nbsp;&nbsp;&nbsp; flags = SCI0.SSR.BYTE;<br>
                    &nbsp;&nbsp;&nbsp; if (flags&amp;0x38) {/* error */<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI0.SSR.BIT.RDRF = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI0.SSR.BIT.ORER = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI0.SSR.BIT.FER = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI0.SSR.BIT.PER = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return
                    -2;<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; if (flags&amp;0x40) {/* normally
                    received one data */<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    recdata=SCI0.RDR;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI0.SSR.BIT.RDRF = 0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return
                    recdata;<br>
                    &nbsp;&nbsp;&nbsp; } else {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return
                    -1;<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</p>
                  <p>void SCI0_putString(char *str);<br>
                    /*SCI0より文字列入力[return]が終端だが，'\n'は取得されない*/<br>
                    /*^Hでバックスペイス*/<br>
                    int SCI0_getString(char *buff,int max)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; int i,ch;<br>
                    &nbsp;&nbsp;&nbsp; for (i=0;i&lt;max-1;i++) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    ch=SCI0_getChar(); /*1文字取得*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    *buff=(char)ch; /*1文字取得*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (*buff=='\r'||ch&lt;0) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    *buff=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    return i+1;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (*buff==0x8) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    buff-=2;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    i-=2;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (*buff!='\n') buff++;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else i--;<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; *buff=0;<br>
                    &nbsp;&nbsp;&nbsp; return i+1;<br>
                    }</p>
                  <p>/*拡張atoi*/<br>
                    /* 123,-123,0x1a,-0x1a の形の文字列をlong intに変換する*/<br>
                    long int atoi(char *buff)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; long int x=0;<br>
                    &nbsp;&nbsp;&nbsp; int y,m=0,n=0,v=0,i=0;<br>
                    &nbsp;&nbsp;&nbsp; y=buff[i];<br>
                    &nbsp;&nbsp;&nbsp; while(y!=0){<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if(y=='-') m=1;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if('a'&lt;=y&amp;&amp;y&lt;='z') y=y-'a'+'A';<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if(y=='0') n=1;</p>
                  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if(v==1){<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if('0'&lt;=y&amp;&amp;y&lt;='9'){<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    y=y-'0';<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    else if('A'&lt;=y&amp;&amp;y&lt;='F'){<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    y=y-'A'+10;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    x=16*x+y;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
                  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if(n==1&amp;&amp;y=='X'){<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    v=1;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if(v==0&amp;&amp;'0'&lt;=y&amp;&amp;y&lt;='9'){<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    y=y-'0';<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    x=10*x+y;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
                  <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    y=buff[++i];<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; if(m==1) x=-x;<br>
                    &nbsp;&nbsp;&nbsp; return x;<br>
                    }</p>
                  <p>#define SCI1_getInt(prompt) ((short
                    int)SCI1_getInt4(prompt))</p>
                  <p>/*SCI1へプロンプトを表示して，SCI1より整数値を入力*/<br>
                    long int SCI1_getInt4(char prompt[])<br>
                    /*getting integer from serial port*/<br>
                    /* format 123[ret] */<br>
                    /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    -123[ret] */<br>
                    /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    0x1a[ret] */<br>
                    /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    -0x100[ret] */<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; char buff[16];<br>
                    &nbsp;&nbsp;&nbsp; SCI1_putString(prompt);<br>
                    &nbsp;&nbsp;&nbsp; SCI1_getString(buff,16);<br>
                    &nbsp;&nbsp;&nbsp; return atoi(buff);<br>
                    }</p>
                  <p>#define SCI0_getInt(prompt) ((short
                    int)SCI0_getInt4(prompt))</p>
                  <p>/*SCI0へプロンプトを表示して，SCI0より整数値を入力*/<br>
                    long int SCI0_getInt4(char prompt[])<br>
                    /*getting integer from serial port*/<br>
                    /* format 123[ret] */<br>
                    /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    -123[ret] */<br>
                    /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    0x1a[ret] */<br>
                    /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    -0x100[ret] */<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; char buff[16];<br>
                    &nbsp;&nbsp;&nbsp; SCI0_putString(prompt);<br>
                    &nbsp;&nbsp;&nbsp; SCI0_getString(buff,16);<br>
                    &nbsp;&nbsp;&nbsp; return atoi(buff);<br>
                    }</p>
                  <p><br>
                    /* -------------------------------------------------
                    */<br>
                    /* PUT BYTE TO SCI0 */<br>
                    /* -------------------------------------------------
                    */<br>
                    void SCI0_putChar(char c)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; unsigned char tmp;<br>
                    #ifdef HYPERTERMINAL<br>
                    &nbsp;&nbsp;&nbsp; if (c=='\n') SCI0_putChar('\r');<br>
                    #endif<br>
                    &nbsp;&nbsp;&nbsp; do{<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmp =
                    SCI0.SSR.BYTE;<br>
                    &nbsp;&nbsp;&nbsp; } while((tmp &amp; 0x80)==0);<br>
                    &nbsp;&nbsp;&nbsp; SCI0.TDR = c;<br>
                    &nbsp;&nbsp;&nbsp; SCI0.SSR.BIT.TDRE = 0;<br>
                    &nbsp;&nbsp;&nbsp; return;<br>
                    }</p>
                  <p>void SCI0_putString(char *str)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; while(*str){<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    SCI0_putChar(*str);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str++;<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</p>
                  <p>&nbsp;</p>
                  <p>/* Port3 -&gt; LCD */<br>
                    /* 7&nbsp;&nbsp;&nbsp; 6&nbsp;&nbsp;&nbsp;
                    5&nbsp;&nbsp;&nbsp; 4&nbsp;&nbsp;&nbsp;
                    3&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;
                    1&nbsp;&nbsp;&nbsp; 0&nbsp; */<br>
                    /*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    ES&nbsp;&nbsp; RS&nbsp; DB7&nbsp; DB6&nbsp;
                    DB5&nbsp; DB4&nbsp; */</p>
                  <p>/* i/o */<br>
                    #define init_LCD_Port()&nbsp;&nbsp;&nbsp;&nbsp;
                    P3.DDR = 0x3f<br>
                    #define
                    LCD_Port&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    P3.DR.BYTE<br>
                    #define LCD_RegisterSelect&nbsp; P3.DR.BIT.B4<br>
                    #define LCD_EnableSignal&nbsp;&nbsp;&nbsp;
                    P3.DR.BIT.B5</p>
                  <p>static void LCD_waitmsec(unsigned int msec)<br>
                    /*mesc間なにもしない時間稼ぎ関数*/<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; int i,j;<br>
                    &nbsp;&nbsp;&nbsp; for (i=0;i&lt;msec;i++) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for
                    (j=0;j&lt;168*SYS_CLOCK;j++);<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</p>
                  <p>static void LCD_waitmicrosec(unsigned int microsec)<br>
                    {/*だいたいmicrosec間なにもしない時間稼ぎ関数*/<br>
                    &nbsp;&nbsp;&nbsp; int i,j;<br>
                    &nbsp;&nbsp;&nbsp; for (i=0;i&lt;microsec;i++) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for
                    (j=0;j&lt;168*SYS_CLOCK/1000;j++);<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    }</p>
                  <p>static void LCD_putCommand(char command) /*command
                    width must be 4bits*/<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp;
                    LCD_Port=(LCD_Port&amp;0xf0)|command;<br>
                    &nbsp;&nbsp;&nbsp; LCD_EnableSignal=1;<br>
                    &nbsp;&nbsp;&nbsp; LCD_waitmicrosec(5);<br>
                    &nbsp;&nbsp;&nbsp; LCD_EnableSignal=0;<br>
                    &nbsp;&nbsp;&nbsp; LCD_waitmicrosec(40);<br>
                    }</p>
                  <p>static void LCD_putCommand2(char command2)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp;
                    LCD_putCommand((command2&gt;&gt;4)&amp;0xf);<br>
                    &nbsp;&nbsp;&nbsp; LCD_putCommand(command2&amp;0xf);<br>
                    }</p>
                  <p>/************************************************************<br>
                    LCDに向けた putchar()<br>
************************************************************/<br>
                    void LCD_putchar(char data)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; LCD_RegisterSelect=1;<br>
                    &nbsp;&nbsp;&nbsp;
                    LCD_putCommand((data&gt;&gt;4)&amp;0xf);<br>
                    &nbsp;&nbsp;&nbsp; LCD_putCommand(data&amp;0xf);<br>
                    &nbsp;&nbsp;&nbsp; LCD_RegisterSelect=0;<br>
                    }</p>
                  <p>/************************************************************<br>
                    LCDに向けた puts()<br>
************************************************************/<br>
                    void LCD_puts(char *str)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; while(*str) LCD_putchar(*str++);<br>
                    }</p>
                  <p>/************************************************************<br>
                    LCDの初期化<br>
************************************************************/<br>
                    void initLCD( void )<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp;
                    init_LCD_Port();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    /* output */<br>
                    &nbsp;&nbsp;&nbsp; LCD_Port&amp;=0xc0;<br>
                    &nbsp;&nbsp;&nbsp;
                    LCD_waitmsec(30);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    /* wait 30ms */<br>
                    &nbsp;&nbsp;&nbsp;
                    LCD_putCommand(0x3);&nbsp;&nbsp;&nbsp;&nbsp; /*
                    function set */<br>
                    &nbsp;&nbsp;&nbsp; LCD_waitmicrosec(4100);<br>
                    &nbsp;&nbsp;&nbsp;
                    LCD_putCommand(0x3);&nbsp;&nbsp;&nbsp;&nbsp; /*
                    function set */<br>
                    &nbsp;&nbsp;&nbsp; LCD_waitmicrosec(100);<br>
                    &nbsp;&nbsp;&nbsp;
                    LCD_putCommand(0x3);&nbsp;&nbsp;&nbsp;&nbsp; /*
                    function set */<br>
                    &nbsp;&nbsp;&nbsp; LCD_waitmicrosec(100);<br>
                    &nbsp;&nbsp;&nbsp;
                    LCD_putCommand(0x2);&nbsp;&nbsp;&nbsp;&nbsp; /*
                    function set data width=4bit*/<br>
                    &nbsp;&nbsp;&nbsp;
                    LCD_putCommand2(0x28);&nbsp;&nbsp; /* function set
                    4bit duty:1/16,size:5*7 */<br>
                    &nbsp;&nbsp;&nbsp;
                    LCD_putCommand2(0x0c);&nbsp;&nbsp; /* display
                    on,cursor off,blink off */<br>
                    &nbsp;&nbsp;&nbsp;
                    LCD_putCommand2(0x06);&nbsp;&nbsp; /* address:auto
                    increment,cursor shift:right */<br>
                    &nbsp;&nbsp;&nbsp;
                    LCD_putCommand2(0x01);&nbsp;&nbsp; /* clear display
                    */<br>
                    &nbsp;&nbsp;&nbsp; LCD_waitmicrosec(1640);<br>
                    }</p>
                  <p>/************************************************************<br>
                    LCDに向けた gotoxy()<br>
************************************************************/</p>
                  <p>void LCD_gotoxy(unsigned x,unsigned y)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; unsigned char point;<br>
                    &nbsp;&nbsp;&nbsp; point=0x80+x+0x40*y;<br>
                    &nbsp;&nbsp;&nbsp; LCD_putCommand2(point);<br>
                    }</p>
                  <p>/************************************************************<br>
                    LCDに向けた clrscr()&nbsp;&nbsp; clear screen<br>
************************************************************/<br>
                    void LCD_clrscr(void)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp;
                    LCD_putCommand2(0x01);&nbsp;&nbsp;&nbsp; /* clear
                    display */<br>
                    &nbsp;&nbsp;&nbsp; LCD_waitmicrosec(1640);<br>
                    }</p>
                  <p>static char *currentstrptr;<br>
                    static void STR_putChar(char ch)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; *currentstrptr++=ch;<br>
                    &nbsp;&nbsp;&nbsp; *currentstrptr=0;<br>
                    }</p>
                  <p>static void STR_putString(char *ptr)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; while(*ptr) STR_putChar(*ptr++);<br>
                    }</p>
                  <p><br>
                    const char
                    hexstring[]="0123456789abcdef0123456789ABCDEF";<br>
                    #define MAXDIGIT 34</p>
                  <p>void Device_printf(int device, char *format,
                    va_list arg_ptr)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; void (*device_putchar)(char ch);<br>
                    &nbsp;&nbsp;&nbsp; void (*device_puts)(char *ptr);<br>
                    &nbsp;&nbsp;&nbsp; char buf[MAXDIGIT];<br>
                    &nbsp;&nbsp;&nbsp; unsigned char flag=0;&nbsp;
                    /*%d:bit2 l:bit1 %:bit0 */<br>
                    &nbsp;&nbsp;&nbsp; unsigned char digit=0; /* 桁数 */<br>
                    &nbsp;&nbsp;&nbsp; unsigned char minus=0;<br>
                    &nbsp;&nbsp;&nbsp; char fill=' ',format1=' ';<br>
                    &nbsp;&nbsp;&nbsp; unsigned char radix=10; /*N進基数*/<br>
                    &nbsp;&nbsp;&nbsp; char sign=' ';<br>
                    &nbsp;&nbsp;&nbsp; char *ptr=buf; /*出力文字ポインタ*/<br>
                    &nbsp;&nbsp;&nbsp; unsigned char cntr=0;
                    /*出力文字数カウンタ*/<br>
                    &nbsp;&nbsp;&nbsp; unsigned char shift=0; /*16進シフト 0
                    or 6*/<br>
                    &nbsp;&nbsp;&nbsp; unsigned char i;<br>
                    &nbsp;&nbsp;&nbsp; unsigned long int value=0;<br>
                    &nbsp;&nbsp;&nbsp; if (device==SCI0device) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_putchar=SCI0_putChar;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_puts=SCI0_putString;<br>
                    &nbsp;&nbsp;&nbsp; } else if (device==SCI1device) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_putchar=SCI1_putChar;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_puts=SCI1_putString;<br>
                    &nbsp;&nbsp;&nbsp; } else if (device==LCDdevice) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_putchar=LCD_putchar;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_puts=LCD_puts;<br>
                    &nbsp;&nbsp;&nbsp; } else { /*device==STRdevice*/<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_putchar=STR_putChar;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_puts=STR_putString;<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; /*va_start(arg_ptr,format);*/<br>
                    &nbsp;&nbsp;&nbsp; while (*format) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    format1=*format;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
                    (flag==0) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if (format1=='%') {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    flag=1;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    digit=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    fill=' ';<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    minus=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    radix=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    ptr=&amp;buf[MAXDIGIT-1];<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    *ptr--='\0';<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    cntr=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    shift=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    sign='+';<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_putchar(format1);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if (format1=='l') {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    flag|=2;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else if
                    ('0'&lt;=(format1)&amp;&amp;(format1)&lt;='9') {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if (digit==0 &amp;&amp; format1=='0') {<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    fill='0';<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else {<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    digit=digit*10+((format1)-'0');<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if (MAXDIGIT-2&lt;digit) digit=MAXDIGIT-2;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else if (format1=='-') {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    minus=1;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else if (format1=='d') {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    flag|=4;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    radix=10;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else if (format1=='u') {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    radix=10;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else if (format1=='x') {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    radix=16;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else if (format1=='X') {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    radix=16;shift=16;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else if (format1=='o') {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    radix=8;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else if (format1=='b') {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    radix=2;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else if (format1=='p') {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    radix=16;shift=16;digit=8;fill='0';flag|=2;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else if (format1=='c') {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_putchar((unsigned
                    char)(va_arg(arg_ptr,int)));<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    flag=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else if (format1=='s') {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if (digit) {<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    cntr=0;ptr=va_arg(arg_ptr,char *);<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    while (ptr[cntr]) cntr++; /*cntrは文字数*/<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if (!minus) for (i=cntr;i&lt;digit;i++)
                    device_putchar(' ');<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_puts(ptr);<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if (minus) for (i=cntr;i&lt;digit;i++)
                    device_putchar(' ');<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else {<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_puts(va_arg(arg_ptr,char *));<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    flag=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_putchar(format1);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    flag=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if (radix) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    switch (flag&amp;6) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    case 0: /* unsig int */<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    value=(unsigned int)va_arg(arg_ptr,int);<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    break;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    case 2: /* unsig long int */<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    value=va_arg(arg_ptr,long int);<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    break;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    case 4: /* sig int */<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    value=(long int)va_arg(arg_ptr,int);<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if ((long int)value&lt;0) {<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;









                    value=-(long int)value;<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;









                    sign='-';<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    }<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    break;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    case 6: /* sig long int */<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    value=va_arg(arg_ptr,long int);<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if ((long int)value&lt;0) {<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;









                    value=-(long int)value;<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;









                    sign='-';<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    }<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    break;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    default:<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    break;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    while (value) {<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    *ptr--=hexstring[value%radix+shift];<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    cntr++;<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    value/=radix;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if (cntr==0) {<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    *ptr--='0';<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    cntr++;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if (fill==' ') {<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if (sign=='-') {<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;









                    *ptr--='-';<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;









                    cntr++;<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    }<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if (!minus) for (i=cntr;i&lt;digit;i++)
                    device_putchar(' ');<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_puts(++ptr);<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if (minus) for (i=cntr;i&lt;digit;i++)
                    device_putchar(' ');<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    } else {<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    for (;cntr&lt;digit-1;cntr++) *ptr--='0';<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    if (sign!='-'&amp;&amp;cntr&lt;digit) *ptr--='0';<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    else if (sign=='-') *ptr--='-';<br>
                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    device_puts(++ptr);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    flag=0;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; format++;<br>
                    &nbsp;&nbsp;&nbsp; }<br>
                    &nbsp;&nbsp;&nbsp; /*va_end(arg_ptr);*/<br>
                    }</p>
                  <p>void SCI0_printf(char *format,...)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; va_list arg;<br>
                    &nbsp;&nbsp;&nbsp; va_start(arg, format);<br>
                    &nbsp;&nbsp;&nbsp; Device_printf(SCI0device, format,
                    arg);<br>
                    &nbsp;&nbsp;&nbsp; va_end(arg);<br>
                    }</p>
                  <p>void SCI1_printf(char *format,...)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; va_list arg;<br>
                    &nbsp;&nbsp;&nbsp; va_start(arg, format);<br>
                    &nbsp;&nbsp;&nbsp; Device_printf(SCI1device, format,
                    arg);<br>
                    &nbsp;&nbsp;&nbsp; va_end(arg);<br>
                    }</p>
                  <p>void LCD_printf(char *format,...)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; va_list arg;<br>
                    &nbsp;&nbsp;&nbsp; va_start(arg, format);<br>
                    &nbsp;&nbsp;&nbsp; Device_printf(LCDdevice, format,
                    arg);<br>
                    &nbsp;&nbsp;&nbsp; va_end(arg);<br>
                    }</p>
                  <p>void sprintf(char *buff,char *format,...)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; va_list arg;<br>
                    &nbsp;&nbsp;&nbsp; va_start(arg, format);<br>
                    &nbsp;&nbsp;&nbsp; currentstrptr=buff;<br>
                    &nbsp;&nbsp;&nbsp; Device_printf(STRdevice, format,
                    arg);<br>
                    &nbsp;&nbsp;&nbsp; va_end(arg);<br>
                    }</p>
                  <p>/*
                    ------------------------------------------------- */<br>
                    /* LED INITIALIZATION */<br>
                    /* -------------------------------------------------
                    */<br>
/**********************************************************<br>
                    LED 0:P5-0<br>
                    LED 1:P5-1<br>
                    LED 2:P5-2<br>
                    LED 3:P5-3<br>
                    下位4ビットを出力にする<br>
**********************************************************/<br>
                    void initLed()<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; P5.DDR = 0xf;<br>
                    }</p>
                  <p>/*
                    ------------------------------------------------- */<br>
                    /* LET LED ON */<br>
                    /* -------------------------------------------------
                    */<br>
                    /*numberは0または1*/<br>
                    void turnOnLed(short int number)<br>
                    { <br>
                    &nbsp;&nbsp;&nbsp; static const unsigned char
                    mask[]={1,2,4,8};<br>
                    &nbsp;&nbsp;&nbsp; P5.DR.BYTE |= mask[number];<br>
                    }</p>
                  <p>/*
                    ------------------------------------------------- */<br>
                    /* LET LED OFF */<br>
                    /* -------------------------------------------------
                    */<br>
                    /*numberは0または1*/<br>
                    void turnOffLed(short int number)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; static const unsigned char
                    mask[]={0xfe,0xfd,0xfb,0xf7};<br>
                    &nbsp;&nbsp;&nbsp; P5.DR.BYTE &amp;= mask[number];<br>
                    }</p>
                  <p>/*
                    ------------------------------------------------- */<br>
                    /* PUSH SW INITIALIZATION */<br>
                    /* -------------------------------------------------
                    */<br>
/**********************************************************<br>
                    押しボタンスイッチS0：P4-4<br>
                    押しボタンスイッチS1：P4-5<br>
                    押しボタンスイッチS2：P4-6<br>
                    押しボタンスイッチS3：P4-7<br>
                    上位4ビットを入力にする．下位4ビットも一応入力にする<br>
                    上位4ビットのプルアップコントロールをONにする<br>
**********************************************************/<br>
                    void initPushSW(void)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; P4.DDR = 0;<br>
                    &nbsp;&nbsp;&nbsp; P4.PCR.BYTE = 0xf0;
                    /*P4-4,5,6,7はプルアップ */<br>
                    }</p>
                  <p>/*
                    ------------------------------------------------- */<br>
                    /* GET PUSH SW&nbsp; */<br>
                    /* -------------------------------------------------
                    */<br>
                    /*push swのポートを取得し，反転し，右4シフトして返す<br>
                    unsigned char getPushSW(void)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; return ((((unsigned
                    char)(~P4.DR.BYTE))&amp;0xf0)&gt;&gt;4);<br>
                    }<br>
                    */<br>
                    #define getPushSW() ((((unsigned
                    char)(~P4.DR.BYTE))&amp;0xf0)&gt;&gt;4)</p>
                  <p>short int checkPushSW(short int number)<br>
                    /*push sw 0,1,2,3の状態を調べる　number:0,1,2,or 3*/<br>
                    /*押されていたら1、そうでなかったら0を返す*/<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; short int ret;<br>
                    &nbsp;&nbsp;&nbsp; static const unsigned char
                    mask[]={0x10,0x20,0x40,0x80};<br>
                    &nbsp;&nbsp;&nbsp; if (P4.DR.BYTE&amp;mask[number])
                    ret=0;<br>
                    &nbsp;&nbsp;&nbsp; else ret=1;<br>
                    &nbsp;&nbsp;&nbsp; return ret;<br>
                    }</p>
                  <p>/*
                    ------------------------------------------------- */<br>
                    /* PUSH 8 BIT SW INITIALIZATION */<br>
                    /* -------------------------------------------------
                    */<br>
/**********************************************************<br>
                    8ビットスイッチS0：P2-0<br>
                    8ビットスイッチS1：P2-1<br>
                    8ビットスイッチS2：P2-2<br>
                    8ビットスイッチS3：P2-3<br>
                    8ビットスイッチS4：P2-4<br>
                    8ビットスイッチS5：P2-5<br>
                    8ビットスイッチS6：P2-6<br>
                    8ビットスイッチS7：P2-7<br>
                    全8ビットを入力にする．<br>
                    全8ビットのプルアップコントロールをONにする<br>
**********************************************************/<br>
                    void init8BitSW(void)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; P2.DDR = 0;<br>
                    &nbsp;&nbsp;&nbsp; P2.PCR.BYTE =
                    0xff;/*8bitSWのプルアップ設定*/<br>
                    }</p>
                  <p>/*8bitswのポートを取得し，反転して返す<br>
                    unsigned char get8BitSW(void)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; return (unsigned
                    char)(~P2.DR.BYTE);<br>
                    }<br>
                    */<br>
                    #define get8BitSW() (unsigned char)(~P2.DR.BYTE)</p>
                  <p>short int check8BitSW(short int number)<br>
                    /*8bitsw
                    0,1,2,3,4,5,6,7の状態を調べる　number:0,1,2,3,4,5,6,or 7*/<br>
                    /*ONなら1、そうでなかったら0を返す*/<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; short int ret;<br>
                    &nbsp;&nbsp;&nbsp; static const unsigned char
                    mask[]={1,2,4,8,0x10,0x20,0x40,0x80};<br>
                    &nbsp;&nbsp;&nbsp; if (P2.DR.BYTE&amp;mask[number])
                    ret=0;<br>
                    &nbsp;&nbsp;&nbsp; else ret=1;<br>
                    &nbsp;&nbsp;&nbsp; return ret;<br>
                    }</p>
                  <p>/*インターバルタイマ割り込みオリジナルは笠井君(1998)，越智君(2001)による開発です*/<br>
                    /* -------------------------------------------------
                    */<br>
                    /* TIMER INITIALIZATION */<br>
                    /* -------------------------------------------------
                    */<br>
                    void initTimer1Int(unsigned short int period)<br>
                    /*ITU1による割り込みタイマーの設定(越智君2001による)*/<br>
                    /*割り込み間隔は引数peiodで単位はμsecである*/<br>
                    /*値は20971以下でなければならない*/<br>
                    /*20.971msecまで*/<br>
                    /*割り込みベクトル　H'000070&nbsp; ;IMIA1*/<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; unsigned int periodGRA=(unsigned
                    int)((SYS_CLOCK*(long int)period+4)&gt;&gt;3);<br>
                    &nbsp;&nbsp;&nbsp; ITU1.TCR.BIT.CCLR=1;&nbsp;
                    /*GRAのコンペアマッチでTCNTをクリア*/<br>
                    &nbsp;&nbsp;&nbsp; ITU1.TCR.BIT.CKEG=0;&nbsp;
                    /*立ち上がりエッジでカウント*/<br>
                    &nbsp;&nbsp;&nbsp; ITU1.TCR.BIT.TPSC=3;&nbsp;
                    /*内部クロックφ/8でカウント*/<br>
                    &nbsp;&nbsp;&nbsp; ITU1.GRA=periodGRA-1;&nbsp;
                    /*割り込みの周期をperiod[μs]に指定*/<br>
                    &nbsp;&nbsp;&nbsp; ITU1.TIER.BIT.IMIEA=1;
                    /*TCNT=GRAとなったときの割り込み要求を許可*/<br>
                    &nbsp;&nbsp;&nbsp; ITU1.TIER.BIT.OVIE=0;&nbsp;
                    /*オーバー・アンダーフロー発生時の割り込みを禁止*/<br>
                    &nbsp;&nbsp;&nbsp; ITU1.TIER.BIT.IMIEB=0;&nbsp;
                    /*TCNT=GRBとなったときの割り込みを禁止*/<br>
                    }</p>
                  <p>/*
                    ------------------------------------------------- */<br>
                    /* TIMER START */<br>
                    /* -------------------------------------------------
                    */<br>
                    /*<br>
                    Timer CH1 スタート<br>
                    void startTimer1(void)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; ITU.TSTR.BYTE |= 0x02;<br>
                    }</p>
                  <p>Timer CH1 ストップ<br>
                    void stopTimer1(void)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; ITU.TSTR.BYTE &amp;= ~0x02;<br>
                    }</p>
                  <p>Timer CH1 割り込みフラグのクリア<br>
                    void clearTimer1Flag(void)<br>
                    {<br>
                    &nbsp;&nbsp;&nbsp; ITU1.TSR.BIT.IMFA=0;<br>
                    }</p>
                </font></font>
              <p><font color="#0000ff"><font color="#800080" face="ＭＳ ゴシック">*/<br>
                    #define startTimer1()&nbsp; (ITU.TSTR.BYTE |=
                    0x02)&nbsp; /* Timer CH1 スタート&nbsp;&nbsp; */<br>
                    #define stopTimer1()&nbsp;&nbsp; (ITU.TSTR.BYTE
                    &amp;= ~0x02) /* Timer CH1 ストップ&nbsp;&nbsp; */<br>
                    #define clearTimer1Flag() (ITU1.TSR.BIT.IMFA=0) /*
                    Timer CH1 flagクリア */</font></font></p>
            </td>
          </tr>
        </tbody>
      </table>
    </blockquote>
    <br>
  
</body></html>